var S=Object.defineProperty;var d=(s,e,t)=>e in s?S(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var o=(s,e,t)=>d(s,typeof e!="symbol"?e+"":e,t);const a=class a{constructor(){o(this,"statusCallbacks",[])}static getInstance(){return a.instance||(a.instance=new a),a.instance}loadScript(e){return new Promise((t,i)=>{if(document.querySelector(`script[src="${e}"]`)){t();return}const r=document.createElement("script");r.src=e,r.onload=()=>t(),r.onerror=()=>i(new Error(`Failed to load script: ${e}`)),document.head.appendChild(r)})}async loadRequiredScripts(){try{this.notifyStatusChange("Loading print libraries..."),await this.loadScript("/js/bluebird.min.js"),await this.loadScript("/js/jquery-3.2.1.slim.min.js"),await this.loadScript("/js/jsmanager/JSPrintManager.js"),this.notifyStatusChange("Print libraries loaded successfully")}catch(e){throw console.error("Failed to load scripts:",e),this.notifyStatusChange("Failed to load print libraries"),e}}async initializeJSPrintManager(){return typeof window.JSPM>"u"&&(await this.loadRequiredScripts(),await new Promise(e=>setTimeout(e,500))),new Promise((e,t)=>{if(typeof window.JSPM<"u"){window.JSPM.JSPrintManager.auto_reconnect=!0,window.JSPM.JSPrintManager.start();const i=setTimeout(()=>{this.notifyStatusChange("JSPrintManager connection timeout",[],!1),t(new Error("JSPrintManager connection timeout"))},1e4);window.JSPM.JSPrintManager.WS.onStatusChanged=()=>{this.jspmWSStatus()?(clearTimeout(i),this.notifyStatusChange("Connected to JSPrintManager",[],!0),setTimeout(()=>{window.JSPM.JSPrintManager.getPrinters().then(n=>{console.log("PrintService: Retrieved printers:",n),this.notifyStatusChange("Connected to JSPrintManager",n,!0),e()}).catch(n=>{console.error("PrintService: Failed to get printers:",n),this.notifyStatusChange("Failed to get printers",[],!1),t(n)})},1e3)):(clearTimeout(i),this.notifyStatusChange("JSPrintManager connection failed",[],!1),t(new Error("JSPrintManager connection failed")))}}else{const i="JSPrintManager not loaded";this.notifyStatusChange(i,[],!1),t(new Error(i))}})}jspmWSStatus(){return window.JSPM.JSPrintManager.websocket_status==window.JSPM.WSStatus.Open?!0:window.JSPM.JSPrintManager.websocket_status==window.JSPM.WSStatus.Closed?(this.notifyStatusChange("JSPrintManager is not installed or not running! Download JSPM Client App from https://neodynamic.com/downloads/jspm",[],!1),!1):(window.JSPM.JSPrintManager.websocket_status==window.JSPM.WSStatus.Blocked&&this.notifyStatusChange("JSPM has blocked this website!",[],!1),!1)}async getAvailablePrinters(){return typeof window.JSPM<"u"&&this.jspmWSStatus()?await window.JSPM.JSPrintManager.getPrinters():[]}generateAssetLabelZPL(e){let t="^XA";return t+="^PW406",t+="^LL203",t+="^MD30",t+="^SD15",t+="^FO10,50^GFA,329,329,7,,,,,,K0F1C,J01E3E,I039F1C4,I079E10F,I07BF03E,I073E17E,00213E7FC,00607CFF8,00F87CFF,00F8F9F800C,00FCF8J08,007EF,003E6,03BEK03F,039FK07F,039FK07F,07CFK03F8,008F,I0F8I018,I07J03C,03DK03E68,07FCJ01C7,03FFJ01E7,03FF8I01F3,017FEI09F,I0FE0018F8,0043E003CF8,00F1I03C7C,00F80807C3C,0070700F838,0020F00F008,I03E00F3,I07E01F38,I07C01E78,I03801E3,L01E,L01C,L01,,,,,^FS",t+="^FO70,30^A0N,18,18^FDFAHAD NAWAF ALZEER HOLDING CO.^FS",t+=`^FO70,65^A0N,24,24^FD${e.asset_tag}^FS`,t+="^FO70,100^BY2,2,35",t+="^BCN,35,Y,N,N",t+=`^FD${e.serial_number||e.asset_tag}^FS`,t+="^FO320,50^BQN,2,4",t+=`^FDMM,${e.asset_tag}^FS`,t+=`^FO70,175^A0N,18,18^FD${new Date().toISOString().split("T")[0]}^FS`,t+="^XZ",t}async printAssetLabel(e,t=!1,i=""){if(!this.jspmWSStatus())throw new Error("JSPrintManager is not connected");if(!t&&!i)throw new Error("No printer selected");try{const n=new window.JSPM.ClientPrintJob;t?n.clientPrinter=new window.JSPM.DefaultPrinter:n.clientPrinter=new window.JSPM.InstalledPrinter(i);const r=this.generateAssetLabelZPL(e);n.printerCommands=r,n.sendToClient(),console.log(`Printed label for asset ${e.asset_tag}`)}catch(n){throw console.error("Print error:",n),n}}async printMultipleAssetLabels(e,t=!1,i=""){if(!this.jspmWSStatus())throw new Error("JSPrintManager is not connected");if(!t&&!i)throw new Error("No printer selected");try{const n=new window.JSPM.ClientPrintJob;t?n.clientPrinter=new window.JSPM.DefaultPrinter:n.clientPrinter=new window.JSPM.InstalledPrinter(i);let r="";e.forEach(c=>{r+=this.generateAssetLabelZPL(c)}),n.printerCommands=r,n.sendToClient(),console.log(`Printed ${e.length} labels`)}catch(n){throw console.error("Print error:",n),n}}onStatusChange(e){this.statusCallbacks.push(e)}offStatusChange(e){const t=this.statusCallbacks.indexOf(e);t>-1&&this.statusCallbacks.splice(t,1)}notifyStatusChange(e,t=[],i=!1){this.statusCallbacks.forEach(n=>{n({status:e,availablePrinters:t,isConnected:i})})}};o(a,"instance");let l=a;export{l as P};
