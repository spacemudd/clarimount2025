import{d as Z,u as Q,p as v,c as D,C as Y,G as ee,i as te,o as c,w as r,f as t,b as n,e as a,t as i,h,a as _,F as C,r as J,l as X,n as q,m as se,v as ne}from"./app-dLrzKn0F.js";import{_ as ae}from"./AppLayout.vue_vue_type_script_setup_true_lang-CC2lz0RT.js";import{_ as y}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DKT4rCoS.js";import{_ as x,a as w}from"./CardContent.vue_vue_type_script_setup_true_lang-CMRhP0rd.js";import{_ as F,a as z}from"./CardTitle.vue_vue_type_script_setup_true_lang-DyG_DfBm.js";import{_ as I}from"./Badge.vue_vue_type_script_setup_true_lang-DqZRI9z8.js";import{_ as u}from"./Icon.vue_vue_type_script_setup_true_lang-8QAoSVp1.js";import{P as ie}from"./PrintService-B0MGNNQ7.js";import"./useForwardExpose-BFVmn8q-.js";import"./RovingFocusGroup-n8bBNkc1.js";import"./building-cRr6cHnB.js";import"./users-DPgfeWw6.js";import"./activity-B-e9Y-EX.js";import"./arrow-left-BS4zfNci.js";import"./calendar-CeWKwItp.js";import"./check-vJjWrwjt.js";import"./chevron-down-Gm_v2yhr.js";import"./search-BCwAPWjy.js";import"./eye-sw0O8Wbi.js";import"./user-D-J4KGKy.js";import"./loader-circle-B25GR8gg.js";import"./sun-CI8pab6l.js";import"./play-D-Y2MDjS.js";import"./plus-DeWJrU-0.js";import"./square-pen-DVrvQtUP.js";import"./trash-2-DFt3QDPc.js";import"./triangle-alert-DQA7Yhdu.js";const oe={class:"flex items-center justify-between"},re={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},le={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},ce={class:"flex items-center gap-4"},de={class:"flex items-center gap-2"},_e={class:"flex items-center gap-1"},ue=["title"],me=["disabled"],pe={value:""},fe=["value"],ge={class:"py-6"},ve={class:"mx-auto max-w-7xl px-6 lg:px-8"},he={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},ye={class:"flex items-center"},xe={class:"flex-shrink-0"},we={class:"flex h-8 w-8 items-center justify-center rounded-md bg-yellow-100 text-yellow-600"},be={class:"ml-4"},Pe={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},ke={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Se={class:"flex items-center"},Ce={class:"flex-shrink-0"},Je={class:"flex h-8 w-8 items-center justify-center rounded-md bg-blue-100 text-blue-600"},Me={class:"ml-4"},$e={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Te={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Ae={class:"flex items-center"},Ne={class:"flex-shrink-0"},Fe={class:"flex h-8 w-8 items-center justify-center rounded-md bg-green-100 text-green-600"},ze={class:"ml-4"},Ie={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Ee={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Oe={class:"flex items-center"},De={class:"flex-shrink-0"},Xe={class:"flex h-8 w-8 items-center justify-center rounded-md bg-red-100 text-red-600"},qe={class:"ml-4"},Le={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Re={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Ve={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},je={key:0,class:"text-center py-8"},Be={class:"text-gray-500"},Ke={key:1,class:"space-y-4"},He={class:"flex items-center justify-between"},Ue={class:"flex-1"},Ge={class:"flex items-center gap-2"},We={class:"text-sm font-medium"},Ze={class:"mt-2"},Qe={class:"font-semibold"},Ye={class:"text-sm text-gray-600 dark:text-gray-400"},et={class:"text-xs text-gray-500 dark:text-gray-500"},tt={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},st={class:"flex gap-2"},nt={key:0,class:"text-center py-8"},at={class:"text-gray-500"},it={key:1,class:"space-y-4"},ot={class:"flex items-center justify-between"},rt={class:"flex-1"},lt={class:"flex items-center gap-2"},ct={class:"text-sm font-medium"},dt={class:"mt-2"},_t={class:"font-semibold"},ut={class:"text-sm text-gray-600 dark:text-gray-400"},mt={class:"flex items-center gap-2 mt-1"},pt={class:"text-xs text-blue-600"},ft={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},gt={class:"flex gap-2"},vt={class:"mt-6"},ht={key:0,class:"text-center py-4"},yt={class:"text-gray-500"},xt={key:1,class:"space-y-2"},wt={class:"flex items-center gap-3"},bt={class:"font-medium"},Pt={class:"text-sm text-gray-500"},Qt=Z({__name:"Index",setup(kt){const{t:d}=Q(),f=v([]),M=v([]),b=v({pending:0,processing:0,completed_today:0,failed_today:0}),$=v(!1),S=v(!1),m=v(""),T=v([]),p=v("loading"),P=ie.getInstance(),A=D(()=>f.value.filter(s=>s.status==="pending").sort((s,o)=>{const e={urgent:4,high:3,normal:2,low:1},l=e[s.priority]||0,g=e[o.priority]||0;return l!==g?g-l:new Date(s.created_at).getTime()-new Date(o.created_at).getTime()})),N=D(()=>f.value.filter(s=>s.status==="processing")),L=s=>{switch(s){case"urgent":return"destructive";case"high":return"secondary";case"normal":return"outline";case"low":return"secondary";default:return"outline"}},R=s=>new Date(s).toLocaleTimeString(),k=async()=>{$.value=!0;try{const[s,o,e]=await Promise.all([fetch("/api/print-jobs/pending"),fetch("/api/print-jobs/history?limit=10"),fetch("/api/print-jobs/statistics")]);s.ok&&(f.value=await s.json()),o.ok&&(M.value=await o.json()),e.ok&&(b.value=await e.json())}catch(s){console.error("Failed to refresh jobs:",s)}finally{$.value=!1}},V=async s=>{var o;if(!m.value){alert("Please select a printer first");return}try{if((await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"processing",print_station_id:"MANUAL_STATION_"+Date.now(),printer_name:m.value})})).ok){const l=f.value.findIndex(g=>g.id===s.id);l!==-1&&(f.value[l].status="processing"),await j(s)}}catch(e){console.error("Failed to process print job:",e),alert("Failed to process print job: "+e)}},j=async s=>{try{await P.printAssetLabel(s.asset,!1,m.value),console.log(`Printed label for asset ${s.asset.asset_tag} on printer ${m.value}`)}catch(o){throw console.error("Failed to print label:",o),o}},B=async s=>{var o;try{(await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"completed"})})).ok&&(f.value=f.value.filter(l=>l.id!==s.id),b.value.completed_today++,k())}catch(e){console.error("Failed to complete print job:",e)}},K=async s=>{var o;try{(await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"failed",error_message:"Print job failed"})})).ok&&(f.value=f.value.filter(l=>l.id!==s.id),b.value.failed_today++,k())}catch(e){console.error("Failed to fail print job:",e)}},H=async s=>{var o;try{(await fetch(`/api/print-jobs/${s.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}})).ok&&(f.value=f.value.filter(l=>l.id!==s.id))}catch(e){console.error("Failed to cancel print job:",e)}},E=async(s=3,o=2e3)=>{S.value=!0;for(let e=1;e<=s;e++)try{console.log(`PrintStation: Printer initialization attempt ${e}/${s}...`),p.value="loading",e>1&&await new Promise(g=>setTimeout(g,o)),await P.initializeJSPrintManager();const l=await P.getAvailablePrinters();if(console.log(`PrintStation: Attempt ${e}: Found ${l.length} printers:`,l),l.length>0){T.value=l,p.value="connected";const g=l.find(W=>W.toLowerCase().includes("zdesigner"));g&&!m.value?(m.value=g,console.log("Auto-selected ZDesigner printer:",g)):l.length>0&&!m.value&&(m.value=l[0],console.log("Auto-selected first available printer:",l[0])),console.log("PrintStation: Printer initialization successful!"),S.value=!1;return}else e<s?console.log(`PrintStation: Attempt ${e}: No printers found, retrying...`):(console.log("PrintStation: No printers found after all attempts"),p.value="connected")}catch(l){console.error(`PrintStation: Printer initialization attempt ${e} failed:`,l),e<s?console.log(`PrintStation: Retrying in ${o/1e3} seconds... (${e}/${s})`):(p.value="error",alert("Failed to connect to JSPrintManager: "+(l instanceof Error?l.message:String(l))))}S.value=!1},U=()=>{console.log("Selected printer:",m.value),m.value&&localStorage.setItem("printStation_selectedPrinter",m.value)},G=()=>{var s,o,e;console.log("=== JSPrintManager Test ==="),console.log("Window object:",typeof window),console.log("window.JSPM:",window.JSPM),console.log("window.JSPM.JSPrintManager:",(s=window.JSPM)==null?void 0:s.JSPrintManager),console.log("window.JSPM.ClientPrintJob:",(o=window.JSPM)==null?void 0:o.ClientPrintJob),console.log("window.JSPM.InstalledPrinter:",(e=window.JSPM)==null?void 0:e.InstalledPrinter),typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager?alert("JSPrintManager is available! âœ…"):alert(`JSPrintManager is NOT available! âŒ

Please check:
1. JSPrintManager is installed
2. JSPrintManager service is running
3. Scripts are loaded properly`)},O=s=>{console.log("Print service status:",s),s.isConnected?(p.value="connected",T.value=s.availablePrinters):p.value="error"};return Y(()=>{const s=localStorage.getItem("printStation_selectedPrinter");s&&(m.value=s),P.onStatusChange(O),k(),setTimeout(()=>{E()},2e3),setInterval(k,1e4)}),ee(()=>{P.offStatusChange(O)}),(s,o)=>(c(),te(ae,null,{header:r(()=>[t("div",oe,[t("div",null,[t("h2",re,i(a(d)("print_station.title")),1),t("p",le,i(a(d)("print_station.description")),1)]),t("div",ce,[t("div",de,[t("div",_e,[n(u,{name:"Printer",class:"h-4 w-4 text-gray-500"}),t("div",{class:q({"h-2 w-2 rounded-full":!0,"bg-green-500":p.value==="connected","bg-red-500":p.value==="error"||p.value==="not-available","bg-yellow-500":p.value==="loading"}),title:p.value==="connected"?"JSPrintManager Connected":p.value==="error"?"JSPrintManager Error":p.value==="not-available"?"JSPrintManager Not Available":"Connecting to JSPrintManager..."},null,10,ue)]),se(t("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>m.value=e),class:"text-sm border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1 bg-white dark:bg-gray-800",onChange:U,disabled:p.value!=="connected"},[t("option",pe,i(a(d)("print_station.select_printer")),1),(c(!0),_(C,null,J(T.value,e=>(c(),_("option",{key:e,value:e},i(e),9,fe))),128))],40,me),[[ne,m.value]]),n(a(y),{size:"sm",variant:"outline",onClick:E,disabled:S.value},{default:r(()=>[n(u,{name:"RefreshCw",class:"h-3 w-3"})]),_:1},8,["disabled"]),n(a(y),{size:"sm",variant:"outline",onClick:G},{default:r(()=>o[1]||(o[1]=[h(" Test ")])),_:1,__:[1]})]),n(a(y),{onClick:k,disabled:$.value},{default:r(()=>[n(u,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),h(" "+i(a(d)("print_station.refresh")),1)]),_:1},8,["disabled"])])])]),default:r(()=>[t("div",ge,[t("div",ve,[t("div",he,[n(a(x),null,{default:r(()=>[n(a(w),{class:"p-6"},{default:r(()=>[t("div",ye,[t("div",xe,[t("div",we,[n(u,{name:"Clock",class:"h-5 w-5"})])]),t("div",be,[t("dt",Pe,i(a(d)("print_station.pending_jobs")),1),t("dd",ke,i(A.value.length),1)])])]),_:1})]),_:1}),n(a(x),null,{default:r(()=>[n(a(w),{class:"p-6"},{default:r(()=>[t("div",Se,[t("div",Ce,[t("div",Je,[n(u,{name:"Printer",class:"h-5 w-5"})])]),t("div",Me,[t("dt",$e,i(a(d)("print_station.processing_jobs")),1),t("dd",Te,i(N.value.length),1)])])]),_:1})]),_:1}),n(a(x),null,{default:r(()=>[n(a(w),{class:"p-6"},{default:r(()=>[t("div",Ae,[t("div",Ne,[t("div",Fe,[n(u,{name:"CheckCircle",class:"h-5 w-5"})])]),t("div",ze,[t("dt",Ie,i(a(d)("print_station.completed_today")),1),t("dd",Ee,i(b.value.completed_today||0),1)])])]),_:1})]),_:1}),n(a(x),null,{default:r(()=>[n(a(w),{class:"p-6"},{default:r(()=>[t("div",Oe,[t("div",De,[t("div",Xe,[n(u,{name:"XCircle",class:"h-5 w-5"})])]),t("div",qe,[t("dt",Le,i(a(d)("print_station.failed_today")),1),t("dd",Re,i(b.value.failed_today||0),1)])])]),_:1})]),_:1})]),t("div",Ve,[n(a(x),null,{default:r(()=>[n(a(F),null,{default:r(()=>[n(a(z),{class:"flex items-center gap-2"},{default:r(()=>[n(u,{name:"Clock",class:"h-5 w-5 text-yellow-600"}),h(" "+i(a(d)("print_station.pending_queue")),1)]),_:1})]),_:1}),n(a(w),null,{default:r(()=>[A.value.length===0?(c(),_("div",je,[n(u,{name:"Inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",Be,i(a(d)("print_station.no_pending_jobs")),1)])):(c(),_("div",Ke,[(c(!0),_(C,null,J(A.value,e=>(c(),_("div",{key:e.id,class:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800"},[t("div",He,[t("div",Ue,[t("div",Ge,[n(a(I),{variant:L(e.priority)},{default:r(()=>[h(i(e.priority),1)]),_:2},1032,["variant"]),t("span",We,i(e.job_id),1)]),t("div",Ze,[t("p",Qe,i(e.asset.asset_tag),1),t("p",Ye,i(e.asset.model_name)+" - "+i(e.company.name),1),t("p",et,i(a(d)("print_station.requested_by"))+" "+i(e.user.name),1),e.comment?(c(),_("p",tt," ðŸ’¬ "+i(e.comment),1)):X("",!0)])]),t("div",st,[n(a(y),{size:"sm",onClick:l=>V(e)},{default:r(()=>[n(u,{name:"Play",class:"h-4 w-4"})]),_:2},1032,["onClick"]),n(a(y),{size:"sm",variant:"outline",onClick:l=>H(e)},{default:r(()=>[n(u,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1}),n(a(x),null,{default:r(()=>[n(a(F),null,{default:r(()=>[n(a(z),{class:"flex items-center gap-2"},{default:r(()=>[n(u,{name:"Printer",class:"h-5 w-5 text-blue-600"}),h(" "+i(a(d)("print_station.processing_queue")),1)]),_:1})]),_:1}),n(a(w),null,{default:r(()=>[N.value.length===0?(c(),_("div",nt,[n(u,{name:"Printer",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",at,i(a(d)("print_station.no_processing_jobs")),1)])):(c(),_("div",it,[(c(!0),_(C,null,J(N.value,e=>(c(),_("div",{key:e.id,class:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800"},[t("div",ot,[t("div",rt,[t("div",lt,[n(a(I),{variant:"secondary"},{default:r(()=>[h(i(e.priority),1)]),_:2},1024),t("span",ct,i(e.job_id),1)]),t("div",dt,[t("p",_t,i(e.asset.asset_tag),1),t("p",ut,i(e.asset.model_name)+" - "+i(e.company.name),1),t("div",mt,[o[2]||(o[2]=t("div",{class:"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full"},null,-1)),t("span",pt,i(a(d)("print_station.printing")),1)]),e.comment?(c(),_("p",ft," ðŸ’¬ "+i(e.comment),1)):X("",!0)])]),t("div",gt,[n(a(y),{size:"sm",variant:"outline",onClick:l=>B(e)},{default:r(()=>[n(u,{name:"Check",class:"h-4 w-4"})]),_:2},1032,["onClick"]),n(a(y),{size:"sm",variant:"destructive",onClick:l=>K(e)},{default:r(()=>[n(u,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1})]),t("div",vt,[n(a(x),null,{default:r(()=>[n(a(F),null,{default:r(()=>[n(a(z),null,{default:r(()=>[h(i(a(d)("print_station.recent_activity")),1)]),_:1})]),_:1}),n(a(w),null,{default:r(()=>[M.value.length===0?(c(),_("div",ht,[t("p",yt,i(a(d)("print_station.no_recent_activity")),1)])):(c(),_("div",xt,[(c(!0),_(C,null,J(M.value,e=>(c(),_("div",{key:e.id,class:"flex items-center justify-between p-2 rounded border"},[t("div",wt,[n(u,{name:e.status==="completed"?"CheckCircle":"XCircle",class:q([e.status==="completed"?"text-green-600":"text-red-600","h-4 w-4"])},null,8,["name","class"]),t("span",bt,i(e.asset.asset_tag),1),n(a(I),{variant:e.status==="completed"?"default":"destructive",size:"sm"},{default:r(()=>[h(i(e.status),1)]),_:2},1032,["variant"])]),t("span",Pt,i(R(e.completed_at||e.updated_at)),1)]))),128))]))]),_:1})]),_:1})])])])]),_:1}))}});export{Qt as default};
