import{d as R,u as U,p as y,c as I,C as Z,i as G,o as c,w as l,f as t,t as i,e as a,b as s,m as Q,a as d,l as F,F as C,r as J,v as Y,h as x,n as ee}from"./app-CJffrqdV.js";import{_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-5vt20ptj.js";import{_ as w}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DrQLdXeo.js";import{_ as b,a as P}from"./CardContent.vue_vue_type_script_setup_true_lang-DigiMmlI.js";import{_ as z,a as D}from"./CardTitle.vue_vue_type_script_setup_true_lang-CzL--qB9.js";import{_ as O}from"./Badge.vue_vue_type_script_setup_true_lang-CJ9JwjkH.js";import{_ as u}from"./Icon.vue_vue_type_script_setup_true_lang-Cv-ioAkc.js";import{P as se}from"./PrintService-B0MGNNQ7.js";import"./useForwardExpose-B9gdC_q2.js";import"./RovingFocusGroup-BA6EIVQl.js";import"./building-CblTbnnb.js";import"./users-DQRMWujI.js";import"./activity-DzZrpenA.js";import"./arrow-left-CGZxZgTF.js";import"./calendar-CbJRlKTW.js";import"./check-BKgTjahH.js";import"./chevron-down-C8Jp2T0w.js";import"./search--N-Ea8KF.js";import"./eye-BAMA9JEN.js";import"./user-_tlMvyWo.js";import"./loader-circle-DxJzJvID.js";import"./sun-BWmVfV5d.js";import"./play-DatPUGEY.js";import"./plus-mCZeNmPI.js";import"./square-pen-BvrK1lto.js";import"./trash-2-EM0gzN0u.js";import"./triangle-alert-Dftsguiz.js";const ne={class:"space-y-6"},ae={class:"flex items-center justify-between my-2"},ie={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},oe={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},re={class:"flex items-center gap-4"},le={class:"flex items-center gap-2"},ce={class:"flex flex-col"},de=["disabled"],ue={value:""},_e=["value"],pe={key:0,class:"text-xs text-gray-500 mt-1"},me={class:"mx-auto max-w-7xl px-6 lg:px-8"},ge={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},fe={class:"flex items-center"},ve={class:"flex-shrink-0"},he={class:"flex h-8 w-8 items-center justify-center rounded-md bg-yellow-100 text-yellow-600"},ye={class:"ml-4"},xe={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},we={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},be={class:"flex items-center"},Pe={class:"flex-shrink-0"},Se={class:"flex h-8 w-8 items-center justify-center rounded-md bg-blue-100 text-blue-600"},ke={class:"ml-4"},Ce={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Je={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},$e={class:"flex items-center"},Me={class:"flex-shrink-0"},Te={class:"flex h-8 w-8 items-center justify-center rounded-md bg-green-100 text-green-600"},Ae={class:"ml-4"},Ne={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Fe={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},ze={class:"flex items-center"},De={class:"flex-shrink-0"},Oe={class:"flex h-8 w-8 items-center justify-center rounded-md bg-red-100 text-red-600"},Le={class:"ml-4"},Ie={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Ee={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Xe={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},qe={key:0,class:"text-center py-8"},We={class:"text-gray-500"},Be={key:1,class:"space-y-4"},Ve={class:"flex items-center justify-between"},Ke={class:"flex-1"},je={class:"flex items-center gap-2"},He={class:"text-sm font-medium"},Re={class:"mt-2"},Ue={class:"font-semibold"},Ze={class:"text-sm text-gray-600 dark:text-gray-400"},Ge={class:"text-xs text-gray-500 dark:text-gray-500"},Qe={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},Ye={class:"flex gap-2"},et={key:0,class:"text-center py-8"},tt={class:"text-gray-500"},st={key:1,class:"space-y-4"},nt={class:"flex items-center justify-between"},at={class:"flex-1"},it={class:"flex items-center gap-2"},ot={class:"text-sm font-medium"},rt={class:"mt-2"},lt={class:"font-semibold"},ct={class:"text-sm text-gray-600 dark:text-gray-400"},dt={class:"flex items-center gap-2 mt-1"},ut={class:"text-xs text-blue-600"},_t={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},pt={class:"flex gap-2"},mt={class:"mt-6"},gt={key:0,class:"text-center py-4"},ft={class:"text-gray-500"},vt={key:1,class:"space-y-2"},ht={class:"flex items-center gap-3"},yt={class:"font-medium"},xt={class:"text-sm text-gray-500"},Ut=R({__name:"Index",setup(wt){const{t:_}=U(),m=y([]),$=y([]),S=y({pending:0,processing:0,completed_today:0,failed_today:0}),M=y(!1),h=y(!1),g=y("Initializing..."),p=y(""),f=y([]),T=se.getInstance(),A=I(()=>m.value.filter(n=>n.status==="pending").sort((n,o)=>{const e={urgent:4,high:3,normal:2,low:1},r=e[n.priority]||0,v=e[o.priority]||0;return r!==v?v-r:new Date(n.created_at).getTime()-new Date(o.created_at).getTime()})),N=I(()=>m.value.filter(n=>n.status==="processing")),E=n=>{switch(n){case"urgent":return"destructive";case"high":return"secondary";case"normal":return"outline";case"low":return"secondary";default:return"outline"}},X=n=>new Date(n).toLocaleTimeString(),k=async()=>{M.value=!0;try{const[n,o,e]=await Promise.all([fetch("/api/print-jobs/pending"),fetch("/api/print-jobs/history?limit=10"),fetch("/api/print-jobs/statistics")]);n.ok&&(m.value=await n.json()),o.ok&&($.value=await o.json()),e.ok&&(S.value=await e.json())}catch(n){console.error("Failed to refresh jobs:",n)}finally{M.value=!1}},q=async n=>{var o;if(f.value.length===0){alert("No printers available. Please click the refresh button to load printers.");return}if(!p.value){const e=f.value.find(r=>r.toLowerCase().includes("zdesigner"));if(e)p.value=e,console.log("PrintStation: Auto-selected ZDesigner printer for printing:",e);else if(f.value.length>0)p.value=f.value[0],console.log("PrintStation: Auto-selected first available printer for printing:",f.value[0]);else{alert("Please select a printer first");return}}try{if((await fetch(`/api/print-jobs/${n.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"processing",print_station_id:"MANUAL_STATION_"+Date.now(),printer_name:p.value})})).ok){const r=m.value.findIndex(v=>v.id===n.id);r!==-1&&(m.value[r].status="processing"),await W(n)}}catch(e){console.error("Failed to process print job:",e),alert("Failed to process print job: "+e)}},W=async n=>{try{console.log(`PrintStation: Printing label for asset ${n.asset.asset_tag} on printer ${p.value}`),await T.printAssetLabel(n.asset,!1,p.value),console.log(`PrintStation: Successfully printed label for asset ${n.asset.asset_tag}`)}catch(o){throw console.error("PrintStation: Failed to print label:",o),o}},B=async n=>{var o;try{(await fetch(`/api/print-jobs/${n.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"completed"})})).ok&&(m.value=m.value.filter(r=>r.id!==n.id),S.value.completed_today++,k())}catch(e){console.error("Failed to complete print job:",e)}},V=async n=>{var o;try{(await fetch(`/api/print-jobs/${n.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"failed",error_message:"Print job failed"})})).ok&&(m.value=m.value.filter(r=>r.id!==n.id),S.value.failed_today++,k())}catch(e){console.error("Failed to fail print job:",e)}},K=async n=>{var o;try{(await fetch(`/api/print-jobs/${n.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}})).ok&&(m.value=m.value.filter(r=>r.id!==n.id))}catch(e){console.error("Failed to cancel print job:",e)}},L=async(n=3,o=1500)=>{h.value=!0,f.value=[],g.value="Connecting to JSPrintManager...";for(let e=1;e<=n;e++)try{console.log(`PrintStation: Loading printers attempt ${e}/${n}...`),g.value=`Connecting... (attempt ${e}/${n})`,e>1&&await new Promise(v=>setTimeout(v,o)),await T.initializeJSPrintManager(),g.value="Getting available printers...";const r=await T.getAvailablePrinters();if(console.log(`PrintStation: Attempt ${e}: Found ${r.length} printers:`,r),r&&r.length>0){if(f.value=r,g.value=`Found ${r.length} printer(s)`,!p.value){const v=r.find(H=>H.toLowerCase().includes("zdesigner"));v?(p.value=v,console.log("PrintStation: Auto-selected ZDesigner printer:",v)):r.length>0&&(p.value=r[0],console.log("PrintStation: Auto-selected first available printer:",r[0]))}console.log("PrintStation: Printer loading successful!"),h.value=!1;return}else e<n?(console.log(`PrintStation: Attempt ${e}: No printers found, retrying...`),g.value=`No printers found, retrying in ${o/1e3}s...`):(console.log("PrintStation: No printers found after all attempts"),g.value="No printers found")}catch(r){console.error(`PrintStation: Printer loading attempt ${e} failed:`,r),e<n?(console.log(`PrintStation: Retrying in ${o/1e3} seconds... (${e}/${n})`),g.value=`Connection failed, retrying in ${o/1e3}s... (${e}/${n})`):(console.error("PrintStation: Failed to load printers after all attempts:",r),g.value="JSPrintManager connection failed",e===n&&console.error("PrintStation: JSPrintManager connection failed. Please ensure JSPrintManager is installed and running."))}h.value=!1},j=()=>{var n,o,e,r;console.log("=== PrintStation JSPrintManager Debug ==="),console.log("Window object:",typeof window),console.log("window.JSPM:",window.JSPM),console.log("window.JSPM.JSPrintManager:",(n=window.JSPM)==null?void 0:n.JSPrintManager),console.log("Available printers:",f.value),console.log("Selected printer:",p.value),console.log("Loading printers:",h.value),typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager?(console.log("JSPrintManager websocket status:",window.JSPM.JSPrintManager.websocket_status),console.log("WSStatus.Open:",(o=window.JSPM.WSStatus)==null?void 0:o.Open),console.log("WSStatus.Closed:",(e=window.JSPM.WSStatus)==null?void 0:e.Closed),console.log("WSStatus.Blocked:",(r=window.JSPM.WSStatus)==null?void 0:r.Blocked),alert("JSPrintManager is available! Check console for details.")):alert(`JSPrintManager is NOT available!

Please check:
1. JSPrintManager is installed
2. JSPrintManager service is running
3. Scripts are loaded properly`)};return Z(()=>{k(),setTimeout(()=>{L()},1e3),setInterval(k,1e4)}),(n,o)=>(c(),G(te,null,{default:l(()=>[t("div",ne,[t("div",ae,[t("div",null,[t("h2",ie,i(a(_)("print_station.title")),1),t("p",oe,i(a(_)("print_station.description")),1)]),t("div",re,[t("div",le,[s(u,{name:"Printer",class:"h-4 w-4 text-gray-500"}),t("div",ce,[Q(t("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>p.value=e),class:"text-sm border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1 bg-white dark:bg-gray-800",disabled:h.value},[t("option",ue,i(h.value?"Loading printers...":f.value.length===0?"No printers found":"Select Printer"),1),(c(!0),d(C,null,J(f.value,e=>(c(),d("option",{key:e,value:e},i(e),9,_e))),128))],8,de),[[Y,p.value]]),h.value||g.value!=="Initializing..."?(c(),d("span",pe,i(g.value),1)):F("",!0)]),s(a(w),{size:"sm",variant:"outline",onClick:L,disabled:h.value},{default:l(()=>[s(u,{name:"RefreshCw",class:"h-3 w-3"})]),_:1},8,["disabled"]),s(a(w),{size:"sm",variant:"outline",onClick:j},{default:l(()=>o[1]||(o[1]=[x(" Debug ")])),_:1,__:[1]})]),s(a(w),{onClick:k,disabled:M.value},{default:l(()=>[s(u,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),x(" "+i(a(_)("print_station.refresh")),1)]),_:1},8,["disabled"])])]),t("div",me,[t("div",ge,[s(a(b),null,{default:l(()=>[s(a(P),{class:"p-6"},{default:l(()=>[t("div",fe,[t("div",ve,[t("div",he,[s(u,{name:"Clock",class:"h-5 w-5"})])]),t("div",ye,[t("dt",xe,i(a(_)("print_station.pending_jobs")),1),t("dd",we,i(A.value.length),1)])])]),_:1})]),_:1}),s(a(b),null,{default:l(()=>[s(a(P),{class:"p-6"},{default:l(()=>[t("div",be,[t("div",Pe,[t("div",Se,[s(u,{name:"Printer",class:"h-5 w-5"})])]),t("div",ke,[t("dt",Ce,i(a(_)("print_station.processing_jobs")),1),t("dd",Je,i(N.value.length),1)])])]),_:1})]),_:1}),s(a(b),null,{default:l(()=>[s(a(P),{class:"p-6"},{default:l(()=>[t("div",$e,[t("div",Me,[t("div",Te,[s(u,{name:"CheckCircle",class:"h-5 w-5"})])]),t("div",Ae,[t("dt",Ne,i(a(_)("print_station.completed_today")),1),t("dd",Fe,i(S.value.completed_today||0),1)])])]),_:1})]),_:1}),s(a(b),null,{default:l(()=>[s(a(P),{class:"p-6"},{default:l(()=>[t("div",ze,[t("div",De,[t("div",Oe,[s(u,{name:"XCircle",class:"h-5 w-5"})])]),t("div",Le,[t("dt",Ie,i(a(_)("print_station.failed_today")),1),t("dd",Ee,i(S.value.failed_today||0),1)])])]),_:1})]),_:1})]),t("div",Xe,[s(a(b),null,{default:l(()=>[s(a(z),null,{default:l(()=>[s(a(D),{class:"flex items-center gap-2"},{default:l(()=>[s(u,{name:"Clock",class:"h-5 w-5 text-yellow-600"}),x(" "+i(a(_)("print_station.pending_queue")),1)]),_:1})]),_:1}),s(a(P),null,{default:l(()=>[A.value.length===0?(c(),d("div",qe,[s(u,{name:"Inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",We,i(a(_)("print_station.no_pending_jobs")),1)])):(c(),d("div",Be,[(c(!0),d(C,null,J(A.value,e=>(c(),d("div",{key:e.id,class:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800"},[t("div",Ve,[t("div",Ke,[t("div",je,[s(a(O),{variant:E(e.priority)},{default:l(()=>[x(i(e.priority),1)]),_:2},1032,["variant"]),t("span",He,i(e.job_id),1)]),t("div",Re,[t("p",Ue,i(e.asset.asset_tag),1),t("p",Ze,i(e.asset.model_name)+" - "+i(e.company.name),1),t("p",Ge,i(a(_)("print_station.requested_by"))+" "+i(e.user.name),1),e.comment?(c(),d("p",Qe," ðŸ’¬ "+i(e.comment),1)):F("",!0)])]),t("div",Ye,[s(a(w),{size:"sm",onClick:r=>q(e)},{default:l(()=>[s(u,{name:"Play",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(a(w),{size:"sm",variant:"outline",onClick:r=>K(e)},{default:l(()=>[s(u,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1}),s(a(b),null,{default:l(()=>[s(a(z),null,{default:l(()=>[s(a(D),{class:"flex items-center gap-2"},{default:l(()=>[s(u,{name:"Printer",class:"h-5 w-5 text-blue-600"}),x(" "+i(a(_)("print_station.processing_queue")),1)]),_:1})]),_:1}),s(a(P),null,{default:l(()=>[N.value.length===0?(c(),d("div",et,[s(u,{name:"Printer",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",tt,i(a(_)("print_station.no_processing_jobs")),1)])):(c(),d("div",st,[(c(!0),d(C,null,J(N.value,e=>(c(),d("div",{key:e.id,class:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800"},[t("div",nt,[t("div",at,[t("div",it,[s(a(O),{variant:"secondary"},{default:l(()=>[x(i(e.priority),1)]),_:2},1024),t("span",ot,i(e.job_id),1)]),t("div",rt,[t("p",lt,i(e.asset.asset_tag),1),t("p",ct,i(e.asset.model_name)+" - "+i(e.company.name),1),t("div",dt,[o[2]||(o[2]=t("div",{class:"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full"},null,-1)),t("span",ut,i(a(_)("print_station.printing")),1)]),e.comment?(c(),d("p",_t," ðŸ’¬ "+i(e.comment),1)):F("",!0)])]),t("div",pt,[s(a(w),{size:"sm",variant:"outline",onClick:r=>B(e)},{default:l(()=>[s(u,{name:"Check",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(a(w),{size:"sm",variant:"destructive",onClick:r=>V(e)},{default:l(()=>[s(u,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1})]),t("div",mt,[s(a(b),null,{default:l(()=>[s(a(z),null,{default:l(()=>[s(a(D),null,{default:l(()=>[x(i(a(_)("print_station.recent_activity")),1)]),_:1})]),_:1}),s(a(P),null,{default:l(()=>[$.value.length===0?(c(),d("div",gt,[t("p",ft,i(a(_)("print_station.no_recent_activity")),1)])):(c(),d("div",vt,[(c(!0),d(C,null,J($.value,e=>(c(),d("div",{key:e.id,class:"flex items-center justify-between p-2 rounded border"},[t("div",ht,[s(u,{name:e.status==="completed"?"CheckCircle":"XCircle",class:ee([e.status==="completed"?"text-green-600":"text-red-600","h-4 w-4"])},null,8,["name","class"]),t("span",yt,i(e.asset.asset_tag),1),s(a(O),{variant:e.status==="completed"?"default":"destructive",size:"sm"},{default:l(()=>[x(i(e.status),1)]),_:2},1032,["variant"])]),t("span",xt,i(X(e.completed_at||e.updated_at)),1)]))),128))]))]),_:1})]),_:1})])])])]),_:1}))}});export{Ut as default};
