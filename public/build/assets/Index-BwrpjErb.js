import{d as K,u as H,p as f,c as O,C as j,i as U,o as l,w as o,f as t,b as a,e as n,t as i,h as g,a as c,F as P,r as C,l as R,n as Z,m as G,v as Q}from"./app-C9yJXUcl.js";import{_ as W}from"./AppLayout.vue_vue_type_script_setup_true_lang-BX8lbWHD.js";import{_ as v}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Dv-adUPV.js";import{_ as h,a as y}from"./CardContent.vue_vue_type_script_setup_true_lang-DNJK7MjS.js";import{_ as N,a as z}from"./CardTitle.vue_vue_type_script_setup_true_lang-D42b2M62.js";import{_ as D}from"./Badge.vue_vue_type_script_setup_true_lang-CvfmVMiZ.js";import{_ as d}from"./Icon.vue_vue_type_script_setup_true_lang-CP3lHlyo.js";import{P as Y}from"./PrintService-B0MGNNQ7.js";import"./useForwardExpose-OHNwOu3q.js";import"./RovingFocusGroup-ChgwhCUe.js";import"./building-DuXq3TPF.js";import"./users-B8wZ3es_.js";import"./activity-BYI53YNf.js";import"./arrow-left-Ou5Inv-U.js";import"./calendar-C2ewyKqJ.js";import"./check-7-6UYUUL.js";import"./chevron-down-Lq0fg_-o.js";import"./search-Rz05zmS7.js";import"./eye-B02RmjrA.js";import"./user-dNLylYrD.js";import"./loader-circle-BwCSK46v.js";import"./sun-DvSG25oE.js";import"./play-BWm6_k0X.js";import"./plus-DtzTvquC.js";import"./square-pen-Cf8DLohM.js";import"./trash-2-Bjv8HIhf.js";import"./triangle-alert-DYnvYbZG.js";const tt={class:"flex items-center justify-between"},et={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},st={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},at={class:"flex items-center gap-4"},nt={class:"flex items-center gap-2"},it={value:""},ot=["value"],rt={class:"py-6"},lt={class:"mx-auto max-w-7xl px-6 lg:px-8"},ct={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},dt={class:"flex items-center"},_t={class:"flex-shrink-0"},ut={class:"flex h-8 w-8 items-center justify-center rounded-md bg-yellow-100 text-yellow-600"},mt={class:"ml-4"},pt={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},ft={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},gt={class:"flex items-center"},ht={class:"flex-shrink-0"},yt={class:"flex h-8 w-8 items-center justify-center rounded-md bg-blue-100 text-blue-600"},vt={class:"ml-4"},xt={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},bt={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},kt={class:"flex items-center"},wt={class:"flex-shrink-0"},Pt={class:"flex h-8 w-8 items-center justify-center rounded-md bg-green-100 text-green-600"},Ct={class:"ml-4"},St={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},$t={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Tt={class:"flex items-center"},Ft={class:"flex-shrink-0"},At={class:"flex h-8 w-8 items-center justify-center rounded-md bg-red-100 text-red-600"},Jt={class:"ml-4"},Nt={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},zt={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Dt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Lt={key:0,class:"text-center py-8"},Ot={class:"text-gray-500"},Rt={key:1,class:"space-y-4"},Et={class:"flex items-center justify-between"},It={class:"flex-1"},Xt={class:"flex items-center gap-2"},qt={class:"text-sm font-medium"},Mt={class:"mt-2"},Vt={class:"font-semibold"},Bt={class:"text-sm text-gray-600 dark:text-gray-400"},Kt={class:"text-xs text-gray-500 dark:text-gray-500"},Ht={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},jt={class:"flex gap-2"},Ut={key:0,class:"text-center py-8"},Zt={class:"text-gray-500"},Gt={key:1,class:"space-y-4"},Qt={class:"flex items-center justify-between"},Wt={class:"flex-1"},Yt={class:"flex items-center gap-2"},te={class:"text-sm font-medium"},ee={class:"mt-2"},se={class:"font-semibold"},ae={class:"text-sm text-gray-600 dark:text-gray-400"},ne={class:"flex items-center gap-2 mt-1"},ie={class:"text-xs text-blue-600"},oe={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},re={class:"flex gap-2"},le={class:"mt-6"},ce={key:0,class:"text-center py-4"},de={class:"text-gray-500"},_e={key:1,class:"space-y-2"},ue={class:"flex items-center gap-3"},me={class:"font-medium"},pe={class:"text-sm text-gray-500"},Ve=K({__name:"Index",setup(fe){const{t:_}=H(),m=f([]),S=f([]),x=f({pending:0,processing:0,completed_today:0,failed_today:0}),$=f(!1),k=f(!1),p=f(""),T=f([]),F=Y.getInstance(),A=O(()=>m.value.filter(s=>s.status==="pending").sort((s,r)=>{const e={urgent:4,high:3,normal:2,low:1},u=e[s.priority]||0,w=e[r.priority]||0;return u!==w?w-u:new Date(s.created_at).getTime()-new Date(r.created_at).getTime()})),J=O(()=>m.value.filter(s=>s.status==="processing")),E=s=>{switch(s){case"urgent":return"destructive";case"high":return"secondary";case"normal":return"outline";case"low":return"secondary";default:return"outline"}},I=s=>new Date(s).toLocaleTimeString(),b=async()=>{$.value=!0;try{const[s,r,e]=await Promise.all([fetch("/api/print-jobs/pending"),fetch("/api/print-jobs/history?limit=10"),fetch("/api/print-jobs/statistics")]);s.ok&&(m.value=await s.json()),r.ok&&(S.value=await r.json()),e.ok&&(x.value=await e.json())}catch(s){console.error("Failed to refresh jobs:",s)}finally{$.value=!1}},X=async s=>{var r;if(!p.value){alert("Please select a printer first");return}try{if((await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},body:JSON.stringify({status:"processing",print_station_id:"MANUAL_STATION_"+Date.now(),printer_name:p.value})})).ok){const u=m.value.findIndex(w=>w.id===s.id);u!==-1&&(m.value[u].status="processing"),await q(s)}}catch(e){console.error("Failed to process print job:",e),alert("Failed to process print job: "+e)}},q=async s=>{try{console.log(`PrintStation: Printing label for asset ${s.asset.asset_tag} on printer ${p.value}`),await F.printAssetLabel(s.asset,!1,p.value),console.log(`PrintStation: Successfully printed label for asset ${s.asset.asset_tag}`)}catch(r){throw console.error("PrintStation: Failed to print label:",r),r}},M=async s=>{var r;try{(await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},body:JSON.stringify({status:"completed"})})).ok&&(m.value=m.value.filter(u=>u.id!==s.id),x.value.completed_today++,b())}catch(e){console.error("Failed to complete print job:",e)}},V=async s=>{var r;try{(await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},body:JSON.stringify({status:"failed",error_message:"Print job failed"})})).ok&&(m.value=m.value.filter(u=>u.id!==s.id),x.value.failed_today++,b())}catch(e){console.error("Failed to fail print job:",e)}},B=async s=>{var r;try{(await fetch(`/api/print-jobs/${s.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""}})).ok&&(m.value=m.value.filter(u=>u.id!==s.id))}catch(e){console.error("Failed to cancel print job:",e)}},L=async()=>{k.value=!0,T.value=[];try{console.log("PrintStation: Loading printers from JSPrintManager..."),await F.initializeJSPrintManager();const s=await F.getAvailablePrinters();if(console.log("PrintStation: Found printers:",s),s&&s.length>0){if(T.value=s,!p.value){const r=s.find(e=>e.toLowerCase().includes("zdesigner"));r?(p.value=r,console.log("PrintStation: Auto-selected ZDesigner printer:",r)):s.length>0&&(p.value=s[0],console.log("PrintStation: Auto-selected first available printer:",s[0]))}}else console.warn("PrintStation: No printers found")}catch(s){console.error("PrintStation: Failed to load printers:",s),alert("Failed to load printers: "+s)}finally{k.value=!1}};return j(()=>{b(),L(),setInterval(b,1e4)}),(s,r)=>(l(),U(W,null,{header:o(()=>[t("div",tt,[t("div",null,[t("h2",et,i(n(_)("print_station.title")),1),t("p",st,i(n(_)("print_station.description")),1)]),t("div",at,[t("div",nt,[a(d,{name:"Printer",class:"h-4 w-4 text-gray-500"}),G(t("select",{"onUpdate:modelValue":r[0]||(r[0]=e=>p.value=e),class:"text-sm border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1 bg-white dark:bg-gray-800"},[t("option",it,i(k.value?"Loading printers...":"Select Printer"),1),(l(!0),c(P,null,C(T.value,e=>(l(),c("option",{key:e,value:e},i(e),9,ot))),128))],512),[[Q,p.value]]),a(n(v),{size:"sm",variant:"outline",onClick:L,disabled:k.value},{default:o(()=>[a(d,{name:"RefreshCw",class:"h-3 w-3"})]),_:1},8,["disabled"])]),a(n(v),{onClick:b,disabled:$.value},{default:o(()=>[a(d,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),g(" "+i(n(_)("print_station.refresh")),1)]),_:1},8,["disabled"])])])]),default:o(()=>[t("div",rt,[t("div",lt,[t("div",ct,[a(n(h),null,{default:o(()=>[a(n(y),{class:"p-6"},{default:o(()=>[t("div",dt,[t("div",_t,[t("div",ut,[a(d,{name:"Clock",class:"h-5 w-5"})])]),t("div",mt,[t("dt",pt,i(n(_)("print_station.pending_jobs")),1),t("dd",ft,i(A.value.length),1)])])]),_:1})]),_:1}),a(n(h),null,{default:o(()=>[a(n(y),{class:"p-6"},{default:o(()=>[t("div",gt,[t("div",ht,[t("div",yt,[a(d,{name:"Printer",class:"h-5 w-5"})])]),t("div",vt,[t("dt",xt,i(n(_)("print_station.processing_jobs")),1),t("dd",bt,i(J.value.length),1)])])]),_:1})]),_:1}),a(n(h),null,{default:o(()=>[a(n(y),{class:"p-6"},{default:o(()=>[t("div",kt,[t("div",wt,[t("div",Pt,[a(d,{name:"CheckCircle",class:"h-5 w-5"})])]),t("div",Ct,[t("dt",St,i(n(_)("print_station.completed_today")),1),t("dd",$t,i(x.value.completed_today||0),1)])])]),_:1})]),_:1}),a(n(h),null,{default:o(()=>[a(n(y),{class:"p-6"},{default:o(()=>[t("div",Tt,[t("div",Ft,[t("div",At,[a(d,{name:"XCircle",class:"h-5 w-5"})])]),t("div",Jt,[t("dt",Nt,i(n(_)("print_station.failed_today")),1),t("dd",zt,i(x.value.failed_today||0),1)])])]),_:1})]),_:1})]),t("div",Dt,[a(n(h),null,{default:o(()=>[a(n(N),null,{default:o(()=>[a(n(z),{class:"flex items-center gap-2"},{default:o(()=>[a(d,{name:"Clock",class:"h-5 w-5 text-yellow-600"}),g(" "+i(n(_)("print_station.pending_queue")),1)]),_:1})]),_:1}),a(n(y),null,{default:o(()=>[A.value.length===0?(l(),c("div",Lt,[a(d,{name:"Inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",Ot,i(n(_)("print_station.no_pending_jobs")),1)])):(l(),c("div",Rt,[(l(!0),c(P,null,C(A.value,e=>(l(),c("div",{key:e.id,class:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800"},[t("div",Et,[t("div",It,[t("div",Xt,[a(n(D),{variant:E(e.priority)},{default:o(()=>[g(i(e.priority),1)]),_:2},1032,["variant"]),t("span",qt,i(e.job_id),1)]),t("div",Mt,[t("p",Vt,i(e.asset.asset_tag),1),t("p",Bt,i(e.asset.model_name)+" - "+i(e.company.name),1),t("p",Kt,i(n(_)("print_station.requested_by"))+" "+i(e.user.name),1),e.comment?(l(),c("p",Ht," ğŸ’¬ "+i(e.comment),1)):R("",!0)])]),t("div",jt,[a(n(v),{size:"sm",onClick:u=>X(e)},{default:o(()=>[a(d,{name:"Play",class:"h-4 w-4"})]),_:2},1032,["onClick"]),a(n(v),{size:"sm",variant:"outline",onClick:u=>B(e)},{default:o(()=>[a(d,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1}),a(n(h),null,{default:o(()=>[a(n(N),null,{default:o(()=>[a(n(z),{class:"flex items-center gap-2"},{default:o(()=>[a(d,{name:"Printer",class:"h-5 w-5 text-blue-600"}),g(" "+i(n(_)("print_station.processing_queue")),1)]),_:1})]),_:1}),a(n(y),null,{default:o(()=>[J.value.length===0?(l(),c("div",Ut,[a(d,{name:"Printer",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",Zt,i(n(_)("print_station.no_processing_jobs")),1)])):(l(),c("div",Gt,[(l(!0),c(P,null,C(J.value,e=>(l(),c("div",{key:e.id,class:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800"},[t("div",Qt,[t("div",Wt,[t("div",Yt,[a(n(D),{variant:"secondary"},{default:o(()=>[g(i(e.priority),1)]),_:2},1024),t("span",te,i(e.job_id),1)]),t("div",ee,[t("p",se,i(e.asset.asset_tag),1),t("p",ae,i(e.asset.model_name)+" - "+i(e.company.name),1),t("div",ne,[r[1]||(r[1]=t("div",{class:"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full"},null,-1)),t("span",ie,i(n(_)("print_station.printing")),1)]),e.comment?(l(),c("p",oe," ğŸ’¬ "+i(e.comment),1)):R("",!0)])]),t("div",re,[a(n(v),{size:"sm",variant:"outline",onClick:u=>M(e)},{default:o(()=>[a(d,{name:"Check",class:"h-4 w-4"})]),_:2},1032,["onClick"]),a(n(v),{size:"sm",variant:"destructive",onClick:u=>V(e)},{default:o(()=>[a(d,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1})]),t("div",le,[a(n(h),null,{default:o(()=>[a(n(N),null,{default:o(()=>[a(n(z),null,{default:o(()=>[g(i(n(_)("print_station.recent_activity")),1)]),_:1})]),_:1}),a(n(y),null,{default:o(()=>[S.value.length===0?(l(),c("div",ce,[t("p",de,i(n(_)("print_station.no_recent_activity")),1)])):(l(),c("div",_e,[(l(!0),c(P,null,C(S.value,e=>(l(),c("div",{key:e.id,class:"flex items-center justify-between p-2 rounded border"},[t("div",ue,[a(d,{name:e.status==="completed"?"CheckCircle":"XCircle",class:Z([e.status==="completed"?"text-green-600":"text-red-600","h-4 w-4"])},null,8,["name","class"]),t("span",me,i(e.asset.asset_tag),1),a(n(D),{variant:e.status==="completed"?"default":"destructive",size:"sm"},{default:o(()=>[g(i(e.status),1)]),_:2},1032,["variant"])]),t("span",pe,i(I(e.completed_at||e.updated_at)),1)]))),128))]))]),_:1})]),_:1})])])])]),_:1}))}});export{Ve as default};
