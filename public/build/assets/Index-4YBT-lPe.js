import{d as Z,u as U,p as y,c as I,C as G,i as Q,o as d,w as l,f as t,t as i,e as a,b as s,m as Y,a as u,l as N,F as C,r as M,v as ee,h as x,n as te}from"./app-da29zlVu.js";import{_ as se}from"./AppLayout.vue_vue_type_script_setup_true_lang-XaYnSxX8.js";import{_ as w}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Cxrqxcqh.js";import{_ as P,a as b}from"./CardContent.vue_vue_type_script_setup_true_lang-CTMHyHzT.js";import{_ as z,a as L}from"./CardTitle.vue_vue_type_script_setup_true_lang-w6l-M4gb.js";import{_ as O}from"./Badge.vue_vue_type_script_setup_true_lang-LLDWIvTg.js";import{_ as p}from"./Icon.vue_vue_type_script_setup_true_lang-DH5-DDgx.js";import{P as ne}from"./PrintService-B0MGNNQ7.js";import"./useForwardExpose-OFpsDUJ4.js";import"./RovingFocusGroup-AViK30Za.js";import"./building-DtjmKMiL.js";import"./users-CsVeAfoR.js";import"./activity-DoxAeuhf.js";import"./arrow-left-Cj_tH3p7.js";import"./calendar-DfU2HxAB.js";import"./check-Dan-S5dK.js";import"./chevron-down-BrkJ-Gq7.js";import"./search-CdeI1_Yc.js";import"./eye-CeTDMxKi.js";import"./user-BdEP1w75.js";import"./loader-circle-CNe2GDl5.js";import"./sun-DlxVVccj.js";import"./play-BI3U31xE.js";import"./plus-BwW_UH3-.js";import"./square-pen-D-Qh5RuP.js";import"./trash-2-CJ3t9zDj.js";import"./triangle-alert-CKj9MmXc.js";const ae={class:"space-y-6"},ie={class:"flex items-center justify-between my-2"},oe={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},re={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},le={class:"flex items-center gap-4"},ce={class:"flex items-center gap-2"},de={class:"flex flex-col"},ue=["disabled"],_e={value:""},pe=["value"],ge={key:0,class:"text-xs text-gray-500 mt-1"},me={class:"mx-auto max-w-7xl px-6 lg:px-8"},fe={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},ve={class:"flex items-center"},he={class:"flex-shrink-0"},ye={class:"flex h-8 w-8 items-center justify-center rounded-md bg-yellow-100 text-yellow-600"},xe={class:"ml-4"},we={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Pe={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},be={class:"flex items-center"},Se={class:"flex-shrink-0"},ke={class:"flex h-8 w-8 items-center justify-center rounded-md bg-blue-100 text-blue-600"},Je={class:"ml-4"},Ce={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Me={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},$e={class:"flex items-center"},Ae={class:"flex-shrink-0"},Fe={class:"flex h-8 w-8 items-center justify-center rounded-md bg-green-100 text-green-600"},Te={class:"ml-4"},De={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Ne={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},ze={class:"flex items-center"},Le={class:"flex-shrink-0"},Oe={class:"flex h-8 w-8 items-center justify-center rounded-md bg-red-100 text-red-600"},qe={class:"ml-4"},Ie={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Ee={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},We={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Xe={key:0,class:"text-center py-8"},Be={class:"text-gray-500"},Ve={key:1,class:"space-y-4"},Ke={class:"flex items-center justify-between"},je={class:"flex-1"},He={class:"flex items-center gap-2"},Re={class:"text-sm font-medium"},Ze={class:"mt-2"},Ue={class:"font-semibold"},Ge={class:"text-sm text-gray-600 dark:text-gray-400"},Qe={class:"text-xs text-gray-500 dark:text-gray-500"},Ye={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},et={class:"flex gap-2"},tt={key:0,class:"text-center py-8"},st={class:"text-gray-500"},nt={key:1,class:"space-y-4"},at={class:"flex items-center justify-between"},it={class:"flex-1"},ot={class:"flex items-center gap-2"},rt={class:"text-sm font-medium"},lt={class:"mt-2"},ct={class:"font-semibold"},dt={class:"text-sm text-gray-600 dark:text-gray-400"},ut={class:"flex items-center gap-2 mt-1"},_t={class:"text-xs text-blue-600"},pt={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},gt={class:"flex gap-2"},mt={class:"mt-6"},ft={key:0,class:"text-center py-4"},vt={class:"text-gray-500"},ht={key:1,class:"space-y-2"},yt={class:"flex items-center gap-3"},xt={class:"font-medium"},wt={class:"text-sm text-gray-500"},Ut=Z({__name:"Index",setup(Pt){const{t:g}=U(),v=y([]),$=y([]),S=y({pending:0,processing:0,completed_today:0,failed_today:0}),A=y(!1),h=y(!1),m=y("Initializing..."),_=y(""),f=y([]),F=ne.getInstance(),T=I(()=>v.value.filter(n=>n.status==="pending").sort((n,o)=>{const e={urgent:4,high:3,normal:2,low:1},r=e[n.priority]||0,c=e[o.priority]||0;return r!==c?c-r:new Date(n.created_at).getTime()-new Date(o.created_at).getTime()})),D=I(()=>v.value.filter(n=>n.status==="processing")),E=n=>{switch(n){case"urgent":return"destructive";case"high":return"secondary";case"normal":return"outline";case"low":return"secondary";default:return"outline"}},W=n=>new Date(n).toLocaleTimeString(),k=async()=>{A.value=!0;try{const[n,o,e]=await Promise.all([fetch("/api/print-jobs/pending"),fetch("/api/print-jobs/history?limit=10"),fetch("/api/print-jobs/statistics")]);n.ok&&(v.value=await n.json()),o.ok&&($.value=await o.json()),e.ok&&(S.value=await e.json())}catch(n){console.error("Failed to refresh jobs:",n)}finally{A.value=!1}},X=async n=>{var o;if(f.value.length===0){alert("No printers available. Please click the refresh button to load printers.");return}if(!_.value){const e=f.value.find(r=>r.toLowerCase().includes("zdesigner"));if(e)_.value=e,console.log("PrintStation: Auto-selected ZDesigner printer for printing:",e);else if(f.value.length>0)_.value=f.value[0],console.log("PrintStation: Auto-selected first available printer for printing:",f.value[0]);else{alert("Please select a printer first");return}}try{if((await fetch(`/api/print-jobs/${n.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"processing",print_station_id:"MANUAL_STATION_"+Date.now(),printer_name:_.value})})).ok){const r=v.value.findIndex(c=>c.id===n.id);r!==-1&&(v.value[r].status="processing"),await B(n)}}catch(e){console.error("Failed to process print job:",e),alert("Failed to process print job: "+e)}},B=async n=>{try{console.log(`PrintStation: Printing label for asset ${n.asset.asset_tag} on printer ${_.value}`),await F.printAssetLabel(n.asset,!1,_.value),console.log(`PrintStation: Successfully printed label for asset ${n.asset.asset_tag}`)}catch(o){throw console.error("PrintStation: Failed to print label:",o),o}},V=async n=>{var o;try{(await fetch(`/api/print-jobs/${n.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"completed"})})).ok&&(v.value=v.value.filter(r=>r.id!==n.id),S.value.completed_today++,k())}catch(e){console.error("Failed to complete print job:",e)}},K=async n=>{var o;try{(await fetch(`/api/print-jobs/${n.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"failed",error_message:"Print job failed"})})).ok&&(v.value=v.value.filter(r=>r.id!==n.id),S.value.failed_today++,k())}catch(e){console.error("Failed to fail print job:",e)}},j=async n=>{var o;try{(await fetch(`/api/print-jobs/${n.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}})).ok&&(v.value=v.value.filter(r=>r.id!==n.id))}catch(e){console.error("Failed to cancel print job:",e)}},q=async(n=3,o=1500)=>{h.value=!0,f.value=[],m.value="Connecting to JSPrintManager...";for(let e=1;e<=n;e++)try{console.log(`PrintStation: Loading printers attempt ${e}/${n}...`),m.value=`Connecting... (attempt ${e}/${n})`,e>1&&await new Promise(c=>setTimeout(c,o)),await F.initializeJSPrintManager(),m.value="Getting available printers...";const r=await F.getAvailablePrinters();if(console.log(`PrintStation: Attempt ${e}: Found ${r.length} printers:`,r),r&&r.length>0){if(f.value=r,m.value=`Found ${r.length} printer(s)`,!_.value){const c=r.find(J=>J.toLowerCase().includes("zdesigner"));c?(_.value=c,console.log("PrintStation: Auto-selected ZDesigner printer:",c),m.value=`Auto-selected: ${c}`):r.length>0&&(_.value=r[0],console.log("PrintStation: Auto-selected first available printer:",r[0]),m.value=`Auto-selected: ${r[0]}`)}console.log("PrintStation: Printer loading successful!"),console.log("PrintStation: Final state - availablePrinters:",f.value),console.log("PrintStation: Final state - selectedPrinter:",_.value),console.log("PrintStation: Final state - loadingPrinters:",h.value),h.value=!1;return}else e<n?(console.log(`PrintStation: Attempt ${e}: No printers found, retrying...`),m.value=`No printers found, retrying in ${o/1e3}s...`):(console.log("PrintStation: No printers found after all attempts"),m.value="No printers found")}catch(r){console.error(`PrintStation: Printer loading attempt ${e} failed:`,r),e<n?(console.log(`PrintStation: Retrying in ${o/1e3} seconds... (${e}/${n})`),m.value=`Connection failed, retrying in ${o/1e3}s... (${e}/${n})`):(console.error("PrintStation: Failed to load printers after all attempts:",r),m.value="JSPrintManager connection failed",e===n&&console.error("PrintStation: JSPrintManager connection failed. Please ensure JSPrintManager is installed and running."))}h.value=!1},H=async()=>{var n,o,e,r;if(console.log("=== PrintStation JSPrintManager Debug ==="),console.log("Window object:",typeof window),console.log("window.JSPM:",window.JSPM),console.log("window.JSPM.JSPrintManager:",(n=window.JSPM)==null?void 0:n.JSPrintManager),console.log("Available printers:",f.value),console.log("Selected printer:",_.value),console.log("Loading printers:",h.value),console.log("Printer status:",m.value),typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager)if(console.log("JSPrintManager websocket status:",window.JSPM.JSPrintManager.websocket_status),console.log("WSStatus.Open:",(o=window.JSPM.WSStatus)==null?void 0:o.Open),console.log("WSStatus.Closed:",(e=window.JSPM.WSStatus)==null?void 0:e.Closed),console.log("WSStatus.Blocked:",(r=window.JSPM.WSStatus)==null?void 0:r.Blocked),window.JSPM.JSPrintManager.websocket_status===0){console.log("JSPrintManager is connected! Trying to get printers directly...");try{const c=await window.JSPM.JSPrintManager.getPrinters();if(console.log("Direct printer query result:",c),c&&c.length>0){if(f.value=c,h.value=!1,m.value=`Direct query: Found ${c.length} printer(s)`,!_.value){const J=c.find(R=>R.toLowerCase().includes("zdesigner"));J?(_.value=J,console.log("Debug: Auto-selected ZDesigner printer:",J)):c.length>0&&(_.value=c[0],console.log("Debug: Auto-selected first available printer:",c[0]))}alert(`JSPrintManager is connected and working!
Found ${c.length} printers.
Check console for details.`)}else alert(`JSPrintManager is connected but no printers found.
Check console for details.`)}catch(c){console.error("Direct printer query failed:",c),alert(`JSPrintManager is connected but failed to get printers.
Error: `+c)}}else alert(`JSPrintManager is available but not connected!
WebSocket status: `+window.JSPM.JSPrintManager.websocket_status);else alert(`JSPrintManager is NOT available!

Please check:
1. JSPrintManager is installed
2. JSPrintManager service is running
3. Scripts are loaded properly`)};return G(()=>{k(),setTimeout(()=>{q()},1e3),setInterval(k,1e4)}),(n,o)=>(d(),Q(se,null,{default:l(()=>[t("div",ae,[t("div",ie,[t("div",null,[t("h2",oe,i(a(g)("print_station.title")),1),t("p",re,i(a(g)("print_station.description")),1)]),t("div",le,[t("div",ce,[s(p,{name:"Printer",class:"h-4 w-4 text-gray-500"}),t("div",de,[Y(t("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>_.value=e),class:"text-sm border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1 bg-white dark:bg-gray-800",disabled:h.value},[t("option",_e,i(h.value?"Loading printers...":f.value.length===0?"No printers found":"Select Printer"),1),(d(!0),u(C,null,M(f.value,e=>(d(),u("option",{key:e,value:e},i(e),9,pe))),128))],8,ue),[[ee,_.value]]),h.value||m.value!=="Initializing..."?(d(),u("span",ge,i(m.value),1)):N("",!0)]),s(a(w),{size:"sm",variant:"outline",onClick:q,disabled:h.value},{default:l(()=>[s(p,{name:"RefreshCw",class:"h-3 w-3"})]),_:1},8,["disabled"]),s(a(w),{size:"sm",variant:"outline",onClick:H},{default:l(()=>o[1]||(o[1]=[x(" Debug ")])),_:1,__:[1]})]),s(a(w),{onClick:k,disabled:A.value},{default:l(()=>[s(p,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),x(" "+i(a(g)("print_station.refresh")),1)]),_:1},8,["disabled"])])]),t("div",me,[t("div",fe,[s(a(P),null,{default:l(()=>[s(a(b),{class:"p-6"},{default:l(()=>[t("div",ve,[t("div",he,[t("div",ye,[s(p,{name:"Clock",class:"h-5 w-5"})])]),t("div",xe,[t("dt",we,i(a(g)("print_station.pending_jobs")),1),t("dd",Pe,i(T.value.length),1)])])]),_:1})]),_:1}),s(a(P),null,{default:l(()=>[s(a(b),{class:"p-6"},{default:l(()=>[t("div",be,[t("div",Se,[t("div",ke,[s(p,{name:"Printer",class:"h-5 w-5"})])]),t("div",Je,[t("dt",Ce,i(a(g)("print_station.processing_jobs")),1),t("dd",Me,i(D.value.length),1)])])]),_:1})]),_:1}),s(a(P),null,{default:l(()=>[s(a(b),{class:"p-6"},{default:l(()=>[t("div",$e,[t("div",Ae,[t("div",Fe,[s(p,{name:"CheckCircle",class:"h-5 w-5"})])]),t("div",Te,[t("dt",De,i(a(g)("print_station.completed_today")),1),t("dd",Ne,i(S.value.completed_today||0),1)])])]),_:1})]),_:1}),s(a(P),null,{default:l(()=>[s(a(b),{class:"p-6"},{default:l(()=>[t("div",ze,[t("div",Le,[t("div",Oe,[s(p,{name:"XCircle",class:"h-5 w-5"})])]),t("div",qe,[t("dt",Ie,i(a(g)("print_station.failed_today")),1),t("dd",Ee,i(S.value.failed_today||0),1)])])]),_:1})]),_:1})]),t("div",We,[s(a(P),null,{default:l(()=>[s(a(z),null,{default:l(()=>[s(a(L),{class:"flex items-center gap-2"},{default:l(()=>[s(p,{name:"Clock",class:"h-5 w-5 text-yellow-600"}),x(" "+i(a(g)("print_station.pending_queue")),1)]),_:1})]),_:1}),s(a(b),null,{default:l(()=>[T.value.length===0?(d(),u("div",Xe,[s(p,{name:"Inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",Be,i(a(g)("print_station.no_pending_jobs")),1)])):(d(),u("div",Ve,[(d(!0),u(C,null,M(T.value,e=>(d(),u("div",{key:e.id,class:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800"},[t("div",Ke,[t("div",je,[t("div",He,[s(a(O),{variant:E(e.priority)},{default:l(()=>[x(i(e.priority),1)]),_:2},1032,["variant"]),t("span",Re,i(e.job_id),1)]),t("div",Ze,[t("p",Ue,i(e.asset.asset_tag),1),t("p",Ge,i(e.asset.model_name)+" - "+i(e.company.name),1),t("p",Qe,i(a(g)("print_station.requested_by"))+" "+i(e.user.name),1),e.comment?(d(),u("p",Ye," ðŸ’¬ "+i(e.comment),1)):N("",!0)])]),t("div",et,[s(a(w),{size:"sm",onClick:r=>X(e)},{default:l(()=>[s(p,{name:"Play",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(a(w),{size:"sm",variant:"outline",onClick:r=>j(e)},{default:l(()=>[s(p,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1}),s(a(P),null,{default:l(()=>[s(a(z),null,{default:l(()=>[s(a(L),{class:"flex items-center gap-2"},{default:l(()=>[s(p,{name:"Printer",class:"h-5 w-5 text-blue-600"}),x(" "+i(a(g)("print_station.processing_queue")),1)]),_:1})]),_:1}),s(a(b),null,{default:l(()=>[D.value.length===0?(d(),u("div",tt,[s(p,{name:"Printer",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",st,i(a(g)("print_station.no_processing_jobs")),1)])):(d(),u("div",nt,[(d(!0),u(C,null,M(D.value,e=>(d(),u("div",{key:e.id,class:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800"},[t("div",at,[t("div",it,[t("div",ot,[s(a(O),{variant:"secondary"},{default:l(()=>[x(i(e.priority),1)]),_:2},1024),t("span",rt,i(e.job_id),1)]),t("div",lt,[t("p",ct,i(e.asset.asset_tag),1),t("p",dt,i(e.asset.model_name)+" - "+i(e.company.name),1),t("div",ut,[o[2]||(o[2]=t("div",{class:"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full"},null,-1)),t("span",_t,i(a(g)("print_station.printing")),1)]),e.comment?(d(),u("p",pt," ðŸ’¬ "+i(e.comment),1)):N("",!0)])]),t("div",gt,[s(a(w),{size:"sm",variant:"outline",onClick:r=>V(e)},{default:l(()=>[s(p,{name:"Check",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(a(w),{size:"sm",variant:"destructive",onClick:r=>K(e)},{default:l(()=>[s(p,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1})]),t("div",mt,[s(a(P),null,{default:l(()=>[s(a(z),null,{default:l(()=>[s(a(L),null,{default:l(()=>[x(i(a(g)("print_station.recent_activity")),1)]),_:1})]),_:1}),s(a(b),null,{default:l(()=>[$.value.length===0?(d(),u("div",ft,[t("p",vt,i(a(g)("print_station.no_recent_activity")),1)])):(d(),u("div",ht,[(d(!0),u(C,null,M($.value,e=>(d(),u("div",{key:e.id,class:"flex items-center justify-between p-2 rounded border"},[t("div",yt,[s(p,{name:e.status==="completed"?"CheckCircle":"XCircle",class:te([e.status==="completed"?"text-green-600":"text-red-600","h-4 w-4"])},null,8,["name","class"]),t("span",xt,i(e.asset.asset_tag),1),s(a(O),{variant:e.status==="completed"?"default":"destructive",size:"sm"},{default:l(()=>[x(i(e.status),1)]),_:2},1032,["variant"])]),t("span",wt,i(W(e.completed_at||e.updated_at)),1)]))),128))]))]),_:1})]),_:1})])])])]),_:1}))}});export{Ut as default};
