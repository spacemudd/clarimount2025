import{d as B,u as K,p as f,c as O,C as j,i as H,o as l,w as r,f as t,b as s,e as a,t as o,h,a as c,F as C,r as P,l as R,n as U,m as G,v as Q}from"./app-C1ajIOIx.js";import{_ as W}from"./AppLayout.vue_vue_type_script_setup_true_lang-DSZfOVQm.js";import{_ as x}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-xGxGLg1r.js";import{_ as g,a as y}from"./CardContent.vue_vue_type_script_setup_true_lang-CzB0cTNZ.js";import{_ as N,a as A}from"./CardTitle.vue_vue_type_script_setup_true_lang-BKnTA0PU.js";import{_ as M}from"./Badge.vue_vue_type_script_setup_true_lang-CQPIiAtF.js";import{_ as d}from"./Icon.vue_vue_type_script_setup_true_lang-CkQJgVoU.js";import"./useForwardExpose-jQsK7vkr.js";import"./RovingFocusGroup-BgLB_s_9.js";import"./building-BC9kqbER.js";import"./users-zX5iXsFg.js";import"./activity-CLQGn_AD.js";import"./arrow-left-BU-Og8S9.js";import"./calendar-HuEcaHlf.js";import"./check-D71wznA2.js";import"./chevron-down-BFKTdCdr.js";import"./search-D7C0k0pB.js";import"./eye-BWI9tXxJ.js";import"./user-CifG18rI.js";import"./loader-circle-CdTNpziz.js";import"./sun-bfNpwdER.js";import"./play-izocaJMj.js";import"./plus-CGC8TfUu.js";import"./square-pen-cS4Lw6T5.js";import"./trash-2-By3aiWf-.js";import"./triangle-alert-Bc7TFo5p.js";const Y={class:"flex items-center justify-between"},Z={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},tt={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},et={class:"flex items-center gap-4"},st={class:"flex items-center gap-2"},at={value:""},nt=["value"],ot={class:"py-6"},it={class:"mx-auto max-w-7xl px-6 lg:px-8"},rt={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},lt={class:"flex items-center"},ct={class:"flex-shrink-0"},dt={class:"flex h-8 w-8 items-center justify-center rounded-md bg-yellow-100 text-yellow-600"},_t={class:"ml-4"},ut={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},mt={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},pt={class:"flex items-center"},ft={class:"flex-shrink-0"},ht={class:"flex h-8 w-8 items-center justify-center rounded-md bg-blue-100 text-blue-600"},gt={class:"ml-4"},yt={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},xt={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},vt={class:"flex items-center"},bt={class:"flex-shrink-0"},wt={class:"flex h-8 w-8 items-center justify-center rounded-md bg-green-100 text-green-600"},kt={class:"ml-4"},Ct={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Pt={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},St={class:"flex items-center"},Jt={class:"flex-shrink-0"},Tt={class:"flex h-8 w-8 items-center justify-center rounded-md bg-red-100 text-red-600"},$t={class:"ml-4"},Ft={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Nt={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},At={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Mt={key:0,class:"text-center py-8"},Et={class:"text-gray-500"},Ot={key:1,class:"space-y-4"},Rt={class:"flex items-center justify-between"},Xt={class:"flex-1"},qt={class:"flex items-center gap-2"},zt={class:"text-sm font-medium"},Dt={class:"mt-2"},It={class:"font-semibold"},Lt={class:"text-sm text-gray-600 dark:text-gray-400"},Vt={class:"text-xs text-gray-500 dark:text-gray-500"},Bt={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},Kt={class:"flex gap-2"},jt={key:0,class:"text-center py-8"},Ht={class:"text-gray-500"},Ut={key:1,class:"space-y-4"},Gt={class:"flex items-center justify-between"},Qt={class:"flex-1"},Wt={class:"flex items-center gap-2"},Yt={class:"text-sm font-medium"},Zt={class:"mt-2"},te={class:"font-semibold"},ee={class:"text-sm text-gray-600 dark:text-gray-400"},se={class:"flex items-center gap-2 mt-1"},ae={class:"text-xs text-blue-600"},ne={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},oe={class:"flex gap-2"},ie={class:"mt-6"},re={key:0,class:"text-center py-4"},le={class:"text-gray-500"},ce={key:1,class:"space-y-2"},de={class:"flex items-center gap-3"},_e={class:"font-medium"},ue={class:"text-sm text-gray-500"},De=B({__name:"Index",setup(me){const{t:_}=K(),m=f([]),S=f([]),v=f({pending:0,processing:0,completed_today:0,failed_today:0}),J=f(!1),w=f(!1),p=f(""),T=f([]),$=O(()=>m.value.filter(n=>n.status==="pending").sort((n,i)=>{const e={urgent:4,high:3,normal:2,low:1},u=e[n.priority]||0,k=e[i.priority]||0;return u!==k?k-u:new Date(n.created_at).getTime()-new Date(i.created_at).getTime()})),F=O(()=>m.value.filter(n=>n.status==="processing")),X=n=>{switch(n){case"urgent":return"destructive";case"high":return"secondary";case"normal":return"outline";case"low":return"secondary";default:return"outline"}},q=n=>new Date(n).toLocaleTimeString(),b=async()=>{J.value=!0;try{const[n,i,e]=await Promise.all([fetch("/api/print-jobs/pending"),fetch("/api/print-jobs/history?limit=10"),fetch("/api/print-jobs/statistics")]);n.ok&&(m.value=await n.json()),i.ok&&(S.value=await i.json()),e.ok&&(v.value=await e.json())}catch(n){console.error("Failed to refresh jobs:",n)}finally{J.value=!1}},z=async n=>{var i;if(!p.value){alert("Please select a printer first");return}try{if((await fetch(`/api/print-jobs/${n.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||""},body:JSON.stringify({status:"processing",print_station_id:"MANUAL_STATION_"+Date.now(),printer_name:p.value})})).ok){const u=m.value.findIndex(k=>k.id===n.id);u!==-1&&(m.value[u].status="processing"),await D(n)}}catch(e){console.error("Failed to process print job:",e),alert("Failed to process print job: "+e)}},D=async n=>{try{console.log(`Printing label for asset ${n.asset.asset_tag} on printer ${p.value}`),await new Promise(i=>setTimeout(i,1e3)),console.log(`Successfully printed label for asset ${n.asset.asset_tag}`)}catch(i){throw console.error("Failed to print label:",i),i}},I=async n=>{var i;try{(await fetch(`/api/print-jobs/${n.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||""},body:JSON.stringify({status:"completed"})})).ok&&(m.value=m.value.filter(u=>u.id!==n.id),v.value.completed_today++,b())}catch(e){console.error("Failed to complete print job:",e)}},L=async n=>{var i;try{(await fetch(`/api/print-jobs/${n.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||""},body:JSON.stringify({status:"failed",error_message:"Print job failed"})})).ok&&(m.value=m.value.filter(u=>u.id!==n.id),v.value.failed_today++,b())}catch(e){console.error("Failed to fail print job:",e)}},V=async n=>{var i;try{(await fetch(`/api/print-jobs/${n.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||""}})).ok&&(m.value=m.value.filter(u=>u.id!==n.id))}catch(e){console.error("Failed to cancel print job:",e)}},E=async()=>{w.value=!0,T.value=[];try{if(console.log("Loading printers from JSPrintManager..."),!window.JSPM||!window.JSPM.JSPrintManager)throw new Error("JSPrintManager is not available");const n=await window.JSPM.JSPrintManager.getPrinters();if(console.log("Found printers:",n),n&&n.length>0){const i=n.map(e=>e.name||e.toString());T.value=i,!p.value&&i.length>0&&(p.value=i[0])}else console.warn("No printers found")}catch(n){console.error("Failed to load printers:",n),alert("Failed to load printers: "+n)}finally{w.value=!1}};return j(()=>{b(),E(),setInterval(b,1e4)}),(n,i)=>(l(),H(W,null,{header:r(()=>[t("div",Y,[t("div",null,[t("h2",Z,o(a(_)("print_station.title")),1),t("p",tt,o(a(_)("print_station.description")),1)]),t("div",et,[t("div",st,[s(d,{name:"Printer",class:"h-4 w-4 text-gray-500"}),G(t("select",{"onUpdate:modelValue":i[0]||(i[0]=e=>p.value=e),class:"text-sm border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1 bg-white dark:bg-gray-800"},[t("option",at,o(w.value?"Loading printers...":"Select Printer"),1),(l(!0),c(C,null,P(T.value,e=>(l(),c("option",{key:e,value:e},o(e),9,nt))),128))],512),[[Q,p.value]]),s(a(x),{size:"sm",variant:"outline",onClick:E,disabled:w.value},{default:r(()=>[s(d,{name:"RefreshCw",class:"h-3 w-3"})]),_:1},8,["disabled"])]),s(a(x),{onClick:b,disabled:J.value},{default:r(()=>[s(d,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),h(" "+o(a(_)("print_station.refresh")),1)]),_:1},8,["disabled"])])])]),default:r(()=>[t("div",ot,[t("div",it,[t("div",rt,[s(a(g),null,{default:r(()=>[s(a(y),{class:"p-6"},{default:r(()=>[t("div",lt,[t("div",ct,[t("div",dt,[s(d,{name:"Clock",class:"h-5 w-5"})])]),t("div",_t,[t("dt",ut,o(a(_)("print_station.pending_jobs")),1),t("dd",mt,o($.value.length),1)])])]),_:1})]),_:1}),s(a(g),null,{default:r(()=>[s(a(y),{class:"p-6"},{default:r(()=>[t("div",pt,[t("div",ft,[t("div",ht,[s(d,{name:"Printer",class:"h-5 w-5"})])]),t("div",gt,[t("dt",yt,o(a(_)("print_station.processing_jobs")),1),t("dd",xt,o(F.value.length),1)])])]),_:1})]),_:1}),s(a(g),null,{default:r(()=>[s(a(y),{class:"p-6"},{default:r(()=>[t("div",vt,[t("div",bt,[t("div",wt,[s(d,{name:"CheckCircle",class:"h-5 w-5"})])]),t("div",kt,[t("dt",Ct,o(a(_)("print_station.completed_today")),1),t("dd",Pt,o(v.value.completed_today||0),1)])])]),_:1})]),_:1}),s(a(g),null,{default:r(()=>[s(a(y),{class:"p-6"},{default:r(()=>[t("div",St,[t("div",Jt,[t("div",Tt,[s(d,{name:"XCircle",class:"h-5 w-5"})])]),t("div",$t,[t("dt",Ft,o(a(_)("print_station.failed_today")),1),t("dd",Nt,o(v.value.failed_today||0),1)])])]),_:1})]),_:1})]),t("div",At,[s(a(g),null,{default:r(()=>[s(a(N),null,{default:r(()=>[s(a(A),{class:"flex items-center gap-2"},{default:r(()=>[s(d,{name:"Clock",class:"h-5 w-5 text-yellow-600"}),h(" "+o(a(_)("print_station.pending_queue")),1)]),_:1})]),_:1}),s(a(y),null,{default:r(()=>[$.value.length===0?(l(),c("div",Mt,[s(d,{name:"Inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",Et,o(a(_)("print_station.no_pending_jobs")),1)])):(l(),c("div",Ot,[(l(!0),c(C,null,P($.value,e=>(l(),c("div",{key:e.id,class:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800"},[t("div",Rt,[t("div",Xt,[t("div",qt,[s(a(M),{variant:X(e.priority)},{default:r(()=>[h(o(e.priority),1)]),_:2},1032,["variant"]),t("span",zt,o(e.job_id),1)]),t("div",Dt,[t("p",It,o(e.asset.asset_tag),1),t("p",Lt,o(e.asset.model_name)+" - "+o(e.company.name),1),t("p",Vt,o(a(_)("print_station.requested_by"))+" "+o(e.user.name),1),e.comment?(l(),c("p",Bt," ğŸ’¬ "+o(e.comment),1)):R("",!0)])]),t("div",Kt,[s(a(x),{size:"sm",onClick:u=>z(e)},{default:r(()=>[s(d,{name:"Play",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(a(x),{size:"sm",variant:"outline",onClick:u=>V(e)},{default:r(()=>[s(d,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1}),s(a(g),null,{default:r(()=>[s(a(N),null,{default:r(()=>[s(a(A),{class:"flex items-center gap-2"},{default:r(()=>[s(d,{name:"Printer",class:"h-5 w-5 text-blue-600"}),h(" "+o(a(_)("print_station.processing_queue")),1)]),_:1})]),_:1}),s(a(y),null,{default:r(()=>[F.value.length===0?(l(),c("div",jt,[s(d,{name:"Printer",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",Ht,o(a(_)("print_station.no_processing_jobs")),1)])):(l(),c("div",Ut,[(l(!0),c(C,null,P(F.value,e=>(l(),c("div",{key:e.id,class:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800"},[t("div",Gt,[t("div",Qt,[t("div",Wt,[s(a(M),{variant:"secondary"},{default:r(()=>[h(o(e.priority),1)]),_:2},1024),t("span",Yt,o(e.job_id),1)]),t("div",Zt,[t("p",te,o(e.asset.asset_tag),1),t("p",ee,o(e.asset.model_name)+" - "+o(e.company.name),1),t("div",se,[i[1]||(i[1]=t("div",{class:"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full"},null,-1)),t("span",ae,o(a(_)("print_station.printing")),1)]),e.comment?(l(),c("p",ne," ğŸ’¬ "+o(e.comment),1)):R("",!0)])]),t("div",oe,[s(a(x),{size:"sm",variant:"outline",onClick:u=>I(e)},{default:r(()=>[s(d,{name:"Check",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(a(x),{size:"sm",variant:"destructive",onClick:u=>L(e)},{default:r(()=>[s(d,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1})]),t("div",ie,[s(a(g),null,{default:r(()=>[s(a(N),null,{default:r(()=>[s(a(A),null,{default:r(()=>[h(o(a(_)("print_station.recent_activity")),1)]),_:1})]),_:1}),s(a(y),null,{default:r(()=>[S.value.length===0?(l(),c("div",re,[t("p",le,o(a(_)("print_station.no_recent_activity")),1)])):(l(),c("div",ce,[(l(!0),c(C,null,P(S.value,e=>(l(),c("div",{key:e.id,class:"flex items-center justify-between p-2 rounded border"},[t("div",de,[s(d,{name:e.status==="completed"?"CheckCircle":"XCircle",class:U([e.status==="completed"?"text-green-600":"text-red-600","h-4 w-4"])},null,8,["name","class"]),t("span",_e,o(e.asset.asset_tag),1),s(a(M),{variant:e.status==="completed"?"default":"destructive",size:"sm"},{default:r(()=>[h(o(e.status),1)]),_:2},1032,["variant"])]),t("span",ue,o(q(e.completed_at||e.updated_at)),1)]))),128))]))]),_:1})]),_:1})])])])]),_:1}))}});export{De as default};
