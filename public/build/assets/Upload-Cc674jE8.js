import{d as se,u as le,c as E,q as x,O as ae,a as _,o as c,b as s,e,h as oe,w as o,f as t,m as f,t as l,n as B,i as k,g as u,p as re,F as N,r as R,v as ie,A as ne,s as P,y as de}from"./app-DGIGreJY.js";import{_ as ce}from"./AppLayout.vue_vue_type_script_setup_true_lang-DimQntjj.js";import{_ as z}from"./index-sJxlj3tB.js";import{_ as y,a as h}from"./CardContent.vue_vue_type_script_setup_true_lang-t541G_KA.js";import{_ as X}from"./CardDescription.vue_vue_type_script_setup_true_lang-rPPtjzhn.js";import{_ as w,a as C}from"./CardTitle.vue_vue_type_script_setup_true_lang-3Qa4jZu3.js";import{_ as m}from"./Icon.vue_vue_type_script_setup_true_lang-Bk64-dpn.js";import{_ as me}from"./Heading.vue_vue_type_script_setup_true_lang-C9OzxOIa.js";import"./useForwardExpose-DuCgMSzZ.js";import"./x-BI4DNfO6.js";import"./building-DECTHaJ0.js";import"./users-WBO_MY5g.js";import"./activity-DW7bmx8w.js";import"./arrow-left-7yfnpckm.js";import"./calendar-C7tUIkzM.js";import"./chevron-down-BiWqDAif.js";import"./search-C0U47eD-.js";import"./eye-EzUPfxAG.js";import"./user-CDnaV7uD.js";import"./loader-circle-DebFBKIt.js";import"./sun-BUSc98So.js";import"./play-DdeNlZRc.js";import"./plus-CDqRFvaH.js";import"./square-pen-CfUXzLSA.js";import"./trash-2-DbDHyvdT.js";import"./triangle-alert-Dqn2KWoP.js";const ue={class:"space-y-6"},pe={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},_e={class:"flex items-center justify-center space-x-4"},fe={class:"flex items-center"},ge={class:"ml-2 text-sm font-medium"},ve={class:"flex items-center"},ye={class:"ml-2 text-sm font-medium"},he={class:"flex items-center"},xe={class:"ml-2 text-sm font-medium"},be={key:0},ke={class:"max-w-sm"},we={value:""},Ce=["value"],Se={key:0},ze={key:0,class:"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},De={class:"flex items-center gap-2"},Fe={class:"text-sm"},Ie={class:"font-medium"},Te={key:0,class:"text-gray-600 ml-1"},$e={class:"flex items-center gap-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},je={class:"text-sm"},Ue={class:"font-medium"},Be={key:0,class:"text-gray-600 ml-1"},Ne={class:"space-y-1"},Oe={key:0,class:"space-y-4"},Ve={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},Ae={class:"text-sm text-gray-500 dark:text-gray-400"},Le={class:"text-xs text-gray-500 dark:text-gray-400"},Me={key:1,class:"space-y-4"},qe={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},Ee={class:"text-sm text-gray-500 dark:text-gray-400"},Re={class:"flex gap-2 justify-center"},Pe={class:"flex items-center gap-2 text-red-700 dark:text-red-200"},Xe={class:"font-medium"},Ke={class:"text-sm text-red-600 dark:text-red-300 mt-1"},Je={key:1},We={class:"space-y-4"},Ge={class:"w-full bg-gray-200 rounded-full h-2"},He={class:"text-sm text-gray-600 dark:text-gray-400 text-center"},Qe={key:2},Ye={class:"space-y-4"},Ze={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},et={class:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg"},tt={class:"text-2xl font-bold text-blue-600"},st={class:"text-sm text-blue-800 dark:text-blue-200"},lt={class:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg"},at={class:"text-2xl font-bold text-green-600"},ot={class:"text-sm text-green-800 dark:text-green-200"},rt={class:"bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg"},it={class:"text-2xl font-bold text-orange-600"},nt={class:"text-sm text-orange-800 dark:text-orange-200"},dt={class:"border border-green-200 bg-green-50 dark:bg-green-900/20 rounded-lg p-4"},ct={class:"flex items-start gap-2"},mt={class:"text-green-800 dark:text-green-200"},ut={key:3},pt={class:"space-y-4"},_t={class:"text-sm text-gray-600 dark:text-gray-400 text-center"},ft={key:4},gt={class:"space-y-4"},vt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},yt={class:"bg-green-100 dark:bg-green-800/20 p-4 rounded-lg"},ht={class:"text-2xl font-bold text-green-600"},xt={class:"text-sm text-green-800 dark:text-green-200"},bt={class:"bg-blue-100 dark:bg-blue-800/20 p-4 rounded-lg"},kt={class:"text-2xl font-bold text-blue-600"},wt={class:"text-sm text-blue-800 dark:text-blue-200"},Ct={class:"text-sm text-green-800 dark:text-green-200"},St={class:"flex justify-between"},zt={class:"flex gap-2"},Zt=se({__name:"Upload",props:{companies:{},currentCompany:{}},setup(K){var A,L,M,q;const{t:a}=le(),$=K,J=E(()=>[{title:a("nav.dashboard"),href:"/dashboard"},{title:a("employees.title"),href:"/employees"},{title:a("employees.import_csv"),href:"/employees/import"},{title:a("employees.upload_file"),href:"/employees/import/upload"}]),D=x(null),g=x(null),I=x(!1),j=x(!1),F=x(0),O=x(null),b=x([]),S=x(((L=(A=$.currentCompany)==null?void 0:A.id)==null?void 0:L.toString())||((q=(M=$.companies[0])==null?void 0:M.id)==null?void 0:q.toString())||""),T=E(()=>$.companies.find(r=>r.id.toString()===S.value)),i=ae({step:"upload",importId:null,importSummary:null}),W=r=>{const n=r.target;n.files&&n.files.length>0&&(g.value=n.files[0],U())},G=r=>{var n;r.preventDefault(),I.value=!1,(n=r.dataTransfer)!=null&&n.files&&r.dataTransfer.files.length>0&&(g.value=r.dataTransfer.files[0],U())},H=r=>{r.preventDefault(),I.value=!0},Q=r=>{r.preventDefault(),I.value=!1},U=()=>{O.value=null,b.value=[],i.step="upload"},Y=async()=>{var n;if(!g.value||!S.value)return;i.step="validating",j.value=!0,F.value=0;const r=setInterval(()=>{F.value=Math.min(F.value+10,90)},100);try{const d=new FormData;d.append("file",g.value),d.append("company_id",S.value);const p=await fetch(route("employees.import.process"),{method:"POST",body:d,headers:{"X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||""}});clearInterval(r),F.value=100;const v=await p.json();v.success?(O.value=v,i.importId=v.import_id,i.importSummary=v.summary,i.step="results"):(b.value=v.errors||[v.message],i.step="upload")}catch{clearInterval(r),b.value=[a("employees.file_processing_error")],i.step="upload"}finally{j.value=!1}},Z=async()=>{var r;if(i.importId){i.step="importing";try{const d=await(await fetch(route("employees.import.execute"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},body:JSON.stringify({import_id:i.importId})})).json();d.success?(i.step="complete",i.importSummary=d.summary,setTimeout(()=>{de.visit(route("employees.index"),{preserveState:!1})},3e3)):(b.value=[d.message],i.step="results")}catch{b.value=[a("employees.import_execution_error")],i.step="results"}}},ee=()=>{g.value=null,D.value&&(D.value.value=""),U()},V=r=>["text/csv","application/vnd.ms-excel","text/plain"].includes(r.type)||r.name.toLowerCase().endsWith(".csv"),te=r=>{if(r===0)return a("employees.file_size_zero");const n=1024,d=[a("employees.file_size_bytes"),a("employees.file_size_kb"),a("employees.file_size_mb"),a("employees.file_size_gb")],p=Math.floor(Math.log(r)/Math.log(n));return parseFloat((r/Math.pow(n,p)).toFixed(2))+" "+d[p]};return(r,n)=>(c(),_(N,null,[s(e(oe),{title:e(a)("employees.upload_file")},null,8,["title"]),s(ce,{breadcrumbs:J.value},{default:o(()=>[t("div",ue,[t("div",null,[s(me,{title:e(a)("employees.upload_file")},null,8,["title"]),t("p",pe,l(e(a)("employees.upload_csv_subtitle")),1)]),t("div",_e,[t("div",fe,[n[3]||(n[3]=t("div",{class:"flex items-center justify-center w-8 h-8 rounded-full bg-blue-600 text-white text-sm"}," 1 ",-1)),t("span",ge,l(e(a)("employees.upload_file")),1)]),n[4]||(n[4]=t("div",{class:"w-8 h-px bg-gray-300"},null,-1)),t("div",ve,[t("div",{class:B(["flex items-center justify-center w-8 h-8 rounded-full text-sm",i.step==="validating"||i.step==="results"||i.step==="importing"||i.step==="complete"?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"])}," 2 ",2),t("span",ye,l(e(a)("employees.validate_data")),1)]),n[5]||(n[5]=t("div",{class:"w-8 h-px bg-gray-300"},null,-1)),t("div",he,[t("div",{class:B(["flex items-center justify-center w-8 h-8 rounded-full text-sm",i.step==="importing"||i.step==="complete"?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"])}," 3 ",2),t("span",xe,l(e(a)("employees.import_data")),1)])]),i.step==="upload"?(c(),_("div",be,[r.companies.length>1?(c(),k(e(y),{key:0},{default:o(()=>[s(e(w),null,{default:o(()=>[s(e(C),{class:"flex items-center gap-2"},{default:o(()=>[s(m,{name:"Building",class:"h-5 w-5 text-blue-600"}),u(" "+l(e(a)("employees.select_company")),1)]),_:1}),s(e(X),null,{default:o(()=>[u(l(e(a)("employees.select_company_import_description")),1)]),_:1})]),_:1}),s(e(h),null,{default:o(()=>[t("div",ke,[re(t("select",{"onUpdate:modelValue":n[0]||(n[0]=d=>S.value=d),class:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},[t("option",we,l(e(a)("employees.select_company_placeholder")),1),(c(!0),_(N,null,R(r.companies,d=>(c(),_("option",{key:d.id,value:d.id.toString()},[u(l(d.name_en)+" ",1),d.name_ar?(c(),_("span",Se," ("+l(d.name_ar)+") ",1)):f("",!0)],8,Ce))),128))],512),[[ie,S.value]])]),T.value?(c(),_("div",ze,[t("div",De,[s(m,{name:"Building",class:"h-4 w-4 text-blue-600"}),t("div",Fe,[t("span",Ie,l(e(a)("employees.selected_company"))+":",1),u(" "+l(T.value.name_en)+" ",1),T.value.name_ar?(c(),_("span",Te," ("+l(T.value.name_ar)+") ",1)):f("",!0)])])])):f("",!0)]),_:1})]),_:1})):r.companies.length===1?(c(),k(e(y),{key:1},{default:o(()=>[s(e(h),{class:"pt-6"},{default:o(()=>[t("div",$e,[s(m,{name:"Building",class:"h-4 w-4 text-blue-600"}),t("div",je,[t("span",Ue,l(e(a)("employees.importing_to_company"))+":",1),u(" "+l(r.companies[0].name_en)+" ",1),r.companies[0].name_ar?(c(),_("span",Be," ("+l(r.companies[0].name_ar)+") ",1)):f("",!0)])])]),_:1})]),_:1})):f("",!0),b.value.length>0?(c(),k(e(y),{key:2,class:"border-red-200 bg-red-50 dark:bg-red-900/20"},{default:o(()=>[s(e(w),null,{default:o(()=>[s(e(C),{class:"flex items-center gap-2 text-red-800 dark:text-red-200"},{default:o(()=>[s(m,{name:"AlertCircle",class:"h-5 w-5"}),u(" "+l(e(a)("employees.validation_errors")),1)]),_:1})]),_:1}),s(e(h),null,{default:o(()=>[t("ul",Ne,[(c(!0),_(N,null,R(b.value,d=>(c(),_("li",{key:d,class:"text-sm text-red-700 dark:text-red-200"}," â€¢ "+l(d),1))),128))])]),_:1})]),_:1})):f("",!0),s(e(y),null,{default:o(()=>[s(e(w),null,{default:o(()=>[s(e(C),{class:"flex items-center gap-2"},{default:o(()=>[s(m,{name:"Upload",class:"h-5 w-5 text-blue-600"}),u(" "+l(e(a)("employees.upload_csv_file")),1)]),_:1}),s(e(X),null,{default:o(()=>[u(l(e(a)("employees.upload_csv_description")),1)]),_:1})]),_:1}),s(e(h),null,{default:o(()=>[t("div",{onDrop:G,onDragover:H,onDragleave:Q,class:B(["border-2 border-dashed rounded-lg p-8 text-center transition-colors cursor-pointer",I.value?"border-blue-400 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 hover:border-gray-400"]),onClick:n[2]||(n[2]=d=>{var p;return(p=D.value)==null?void 0:p.click()})},[t("input",{ref_key:"fileInput",ref:D,type:"file",accept:".csv",onChange:W,class:"hidden"},null,544),g.value?(c(),_("div",Me,[s(m,{name:"FileSpreadsheet",class:"mx-auto h-12 w-12 text-green-600"}),t("div",null,[t("p",qe,l(g.value.name),1),t("p",Ee,l(te(g.value.size)),1)]),t("div",Re,[s(e(z),{onClick:ee,variant:"outline",size:"sm"},{default:o(()=>[s(m,{name:"X",class:"mr-2 h-4 w-4"}),u(" "+l(e(a)("common.remove")),1)]),_:1}),s(e(z),{onClick:n[1]||(n[1]=d=>{var p;return(p=D.value)==null?void 0:p.click()}),variant:"outline",size:"sm"},{default:o(()=>[s(m,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),u(" "+l(e(a)("common.change")),1)]),_:1})])])):(c(),_("div",Oe,[s(m,{name:"Upload",class:"mx-auto h-12 w-12 text-gray-400"}),t("div",null,[t("p",Ve,l(e(a)("employees.drop_csv_file")),1),t("p",Ae,l(e(a)("employees.or_click_to_browse")),1)]),t("div",Le,l(e(a)("employees.max_file_size"))+": 10"+l(e(a)("employees.file_size_mb")),1)]))],34)]),_:1})]),_:1}),g.value&&!V(g.value)?(c(),k(e(y),{key:3,class:"border-red-200 bg-red-50 dark:bg-red-900/20"},{default:o(()=>[s(e(h),{class:"pt-6"},{default:o(()=>[t("div",Pe,[s(m,{name:"AlertCircle",class:"h-5 w-5"}),t("p",Xe,l(e(a)("employees.invalid_file_type")),1)]),t("p",Ke,l(e(a)("employees.csv_file_required")),1)]),_:1})]),_:1})):f("",!0)])):f("",!0),i.step==="validating"?(c(),_("div",Je,[s(e(y),null,{default:o(()=>[s(e(w),null,{default:o(()=>[s(e(C),{class:"flex items-center gap-2"},{default:o(()=>[s(m,{name:"Loader2",class:"h-5 w-5 animate-spin text-blue-600"}),u(" "+l(e(a)("employees.validating_file")),1)]),_:1})]),_:1}),s(e(h),null,{default:o(()=>[t("div",We,[t("div",Ge,[t("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:ne({width:`${F.value}%`})},null,4)]),t("p",He,l(e(a)("employees.processing_csv_file")),1)])]),_:1})]),_:1})])):f("",!0),i.step==="results"?(c(),_("div",Qe,[s(e(y),null,{default:o(()=>[s(e(w),null,{default:o(()=>[s(e(C),{class:"flex items-center gap-2"},{default:o(()=>[s(m,{name:"CheckCircle",class:"h-5 w-5 text-green-600"}),u(" "+l(e(a)("employees.validation_complete")),1)]),_:1})]),_:1}),s(e(h),null,{default:o(()=>{var d,p,v;return[t("div",Ye,[t("div",Ze,[t("div",et,[t("div",tt,l(((d=i.importSummary)==null?void 0:d.total_records)||0),1),t("div",st,l(e(a)("employees.total_records")),1)]),t("div",lt,[t("div",at,l(((p=i.importSummary)==null?void 0:p.new_records)||0),1),t("div",ot,l(e(a)("employees.new_records")),1)]),t("div",rt,[t("div",it,l(((v=i.importSummary)==null?void 0:v.update_records)||0),1),t("div",nt,l(e(a)("employees.update_records")),1)])]),t("div",dt,[t("div",ct,[s(m,{name:"CheckCircle",class:"h-4 w-4 text-green-600 mt-0.5"}),t("p",mt,l(e(a)("employees.validation_success_message")),1)])])])]}),_:1})]),_:1})])):f("",!0),i.step==="importing"?(c(),_("div",ut,[s(e(y),null,{default:o(()=>[s(e(w),null,{default:o(()=>[s(e(C),{class:"flex items-center gap-2"},{default:o(()=>[s(m,{name:"Loader2",class:"h-5 w-5 animate-spin text-blue-600"}),u(" "+l(e(a)("employees.importing_data")),1)]),_:1})]),_:1}),s(e(h),null,{default:o(()=>[t("div",pt,[n[6]||(n[6]=t("div",{class:"w-full bg-gray-200 rounded-full h-2"},[t("div",{class:"bg-blue-600 h-2 rounded-full animate-pulse"})],-1)),t("p",_t,l(e(a)("employees.importing_employees")),1)])]),_:1})]),_:1})])):f("",!0),i.step==="complete"?(c(),_("div",ft,[s(e(y),{class:"border-green-200 bg-green-50 dark:bg-green-900/20"},{default:o(()=>[s(e(w),null,{default:o(()=>[s(e(C),{class:"flex items-center gap-2 text-green-800 dark:text-green-200"},{default:o(()=>[s(m,{name:"CheckCircle",class:"h-5 w-5"}),u(" "+l(e(a)("employees.import_complete")),1)]),_:1})]),_:1}),s(e(h),null,{default:o(()=>{var d,p;return[t("div",gt,[t("div",vt,[t("div",yt,[t("div",ht,l(((d=i.importSummary)==null?void 0:d.created)||0),1),t("div",xt,l(e(a)("employees.created_employees")),1)]),t("div",bt,[t("div",kt,l(((p=i.importSummary)==null?void 0:p.updated)||0),1),t("div",wt,l(e(a)("employees.updated_employees")),1)])]),t("p",Ct,l(e(a)("employees.import_complete_message")),1)])]}),_:1})]),_:1})])):f("",!0),t("div",St,[s(e(z),{variant:"ghost",asChild:""},{default:o(()=>[s(e(P),{href:r.route("employees.import")},{default:o(()=>[s(m,{name:"ArrowLeft",class:"mr-2 rtl:mr-0 rtl:ml-2 h-4 w-4"}),u(" "+l(e(a)("common.back")),1)]),_:1},8,["href"])]),_:1}),t("div",zt,[i.step==="upload"?(c(),k(e(z),{key:0,onClick:Y,disabled:!g.value||!V(g.value)||!S.value||j.value},{default:o(()=>[s(m,{name:"Upload",class:"mr-2 rtl:mr-0 rtl:ml-2 h-4 w-4"}),u(" "+l(e(a)("employees.validate_file")),1)]),_:1},8,["disabled"])):f("",!0),i.step==="results"?(c(),k(e(z),{key:1,onClick:Z,class:"bg-green-600 hover:bg-green-700"},{default:o(()=>[s(m,{name:"Database",class:"mr-2 rtl:mr-0 rtl:ml-2 h-4 w-4"}),u(" "+l(e(a)("employees.start_import")),1)]),_:1})):f("",!0),i.step==="complete"?(c(),k(e(z),{key:2,asChild:"",class:"bg-blue-600 hover:bg-blue-700"},{default:o(()=>[s(e(P),{href:r.route("employees.index")},{default:o(()=>[s(m,{name:"Users",class:"mr-2 rtl:mr-0 rtl:ml-2 h-4 w-4"}),u(" "+l(e(a)("employees.view_employees")),1)]),_:1},8,["href"])]),_:1})):f("",!0)])])])]),_:1},8,["breadcrumbs"])],64))}});export{Zt as default};
