import{d as j,u as H,p as f,c as O,C as Z,i as U,o as l,w as r,f as t,b as a,e as n,t as i,h as g,a as d,F as k,r as P,l as z,n as G,m as Q,v as W}from"./app-Cl7B3qiy.js";import{_ as Y}from"./AppLayout.vue_vue_type_script_setup_true_lang-B2g_Sgs3.js";import{_ as v}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-TWlXryVj.js";import{_ as h,a as y}from"./CardContent.vue_vue_type_script_setup_true_lang-CQdmQzc6.js";import{_ as T,a as A}from"./CardTitle.vue_vue_type_script_setup_true_lang-720V64fJ.js";import{_ as M}from"./Badge.vue_vue_type_script_setup_true_lang-B3SqZaNH.js";import{_}from"./Icon.vue_vue_type_script_setup_true_lang-DfP0IAZk.js";import"./useForwardExpose-BkQZWhBd.js";import"./RovingFocusGroup-xIKDMdm1.js";import"./building-CBzVr3ng.js";import"./users-Ct4ipfyp.js";import"./activity-dI2CYocv.js";import"./arrow-left-DDxQBwBV.js";import"./calendar-BhWvf09J.js";import"./check-COlaITkq.js";import"./chevron-down-gLAPp9hU.js";import"./search-CAkFRaUT.js";import"./eye-lffpshec.js";import"./user-rFlrGnCc.js";import"./loader-circle-C6aZ7T4T.js";import"./sun-B59gcz8Z.js";import"./play-CCjXeEVr.js";import"./plus-DHKl0PhJ.js";import"./square-pen-DPtHmtOg.js";import"./trash-2-DD9HmGS7.js";import"./triangle-alert-COA-bXCs.js";const ee={class:"flex items-center justify-between"},te={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},se={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},ae={class:"flex items-center gap-4"},ne={class:"flex items-center gap-2"},ie={value:""},oe=["value"],re={class:"py-6"},le={class:"mx-auto max-w-7xl px-6 lg:px-8"},ce={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},de={class:"flex items-center"},_e={class:"flex-shrink-0"},ue={class:"flex h-8 w-8 items-center justify-center rounded-md bg-yellow-100 text-yellow-600"},me={class:"ml-4"},pe={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},fe={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},ge={class:"flex items-center"},he={class:"flex-shrink-0"},ye={class:"flex h-8 w-8 items-center justify-center rounded-md bg-blue-100 text-blue-600"},ve={class:"ml-4"},xe={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},we={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},be={class:"flex items-center"},ke={class:"flex-shrink-0"},Pe={class:"flex h-8 w-8 items-center justify-center rounded-md bg-green-100 text-green-600"},Ce={class:"ml-4"},Se={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Fe={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Je={class:"flex items-center"},$e={class:"flex-shrink-0"},Te={class:"flex h-8 w-8 items-center justify-center rounded-md bg-red-100 text-red-600"},Ae={class:"ml-4"},Me={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Ne={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},De={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Oe={key:0,class:"text-center py-8"},ze={class:"text-gray-500"},Ie={key:1,class:"space-y-4"},Xe={class:"flex items-center justify-between"},Ee={class:"flex-1"},Re={class:"flex items-center gap-2"},Le={class:"text-sm font-medium"},qe={class:"mt-2"},Ve={class:"font-semibold"},Be={class:"text-sm text-gray-600 dark:text-gray-400"},Ke={class:"text-xs text-gray-500 dark:text-gray-500"},je={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},He={class:"flex gap-2"},Ze={key:0,class:"text-center py-8"},Ue={class:"text-gray-500"},Ge={key:1,class:"space-y-4"},Qe={class:"flex items-center justify-between"},We={class:"flex-1"},Ye={class:"flex items-center gap-2"},et={class:"text-sm font-medium"},tt={class:"mt-2"},st={class:"font-semibold"},at={class:"text-sm text-gray-600 dark:text-gray-400"},nt={class:"flex items-center gap-2 mt-1"},it={class:"text-xs text-blue-600"},ot={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},rt={class:"flex gap-2"},lt={class:"mt-6"},ct={key:0,class:"text-center py-4"},dt={class:"text-gray-500"},_t={key:1,class:"space-y-2"},ut={class:"flex items-center gap-3"},mt={class:"font-medium"},pt={class:"text-sm text-gray-500"},qt=j({__name:"Index",setup(ft){const{t:c}=H(),p=f([]),C=f([]),x=f({pending:0,processing:0,completed_today:0,failed_today:0}),S=f(!1),F=f(!1),m=f(""),N=f([]),J=O(()=>p.value.filter(s=>s.status==="pending").sort((s,o)=>{const e={urgent:4,high:3,normal:2,low:1},u=e[s.priority]||0,b=e[o.priority]||0;return u!==b?b-u:new Date(s.created_at).getTime()-new Date(o.created_at).getTime()})),$=O(()=>p.value.filter(s=>s.status==="processing")),I=s=>{switch(s){case"urgent":return"destructive";case"high":return"secondary";case"normal":return"outline";case"low":return"secondary";default:return"outline"}},X=s=>new Date(s).toLocaleTimeString(),w=async()=>{S.value=!0;try{const[s,o,e]=await Promise.all([fetch("/api/print-jobs/pending"),fetch("/api/print-jobs/history?limit=10"),fetch("/api/print-jobs/statistics")]);s.ok&&(p.value=await s.json()),o.ok&&(C.value=await o.json()),e.ok&&(x.value=await e.json())}catch(s){console.error("Failed to refresh jobs:",s)}finally{S.value=!1}},E=async s=>{var o;if(!m.value){alert("Please select a printer first");return}try{if((await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"processing",print_station_id:"MANUAL_STATION_"+Date.now(),printer_name:m.value})})).ok){const u=p.value.findIndex(b=>b.id===s.id);u!==-1&&(p.value[u].status="processing"),await R(s)}}catch(e){console.error("Failed to process print job:",e),alert("Failed to process print job: "+e)}},R=async s=>{try{if(typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager){const o=L(s.asset),e=new window.JSPM.ClientPrintJob;e.clientPrinter=new window.JSPM.InstalledPrinter(m.value),e.printerCommands=o,await e.sendToClient(),console.log(`Printed label for asset ${s.asset.asset_tag} on printer ${m.value}`)}else throw new Error("JSPrintManager not available")}catch(o){throw console.error("Failed to print label:",o),o}},L=s=>`
^XA
^CF0,30
^FO50,50^FD${s.asset_tag}^FS
^CF0,20
^FO50,100^FD${s.model_name||"N/A"}^FS
^FO50,130^FD${s.serial_number||"N/A"}^FS
^FO50,160^FD${s.category||"N/A"}^FS
^XZ
    `.trim(),q=async s=>{var o;try{(await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"completed"})})).ok&&(p.value=p.value.filter(u=>u.id!==s.id),x.value.completed_today++,w())}catch(e){console.error("Failed to complete print job:",e)}},V=async s=>{var o;try{(await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"failed",error_message:"Print job failed"})})).ok&&(p.value=p.value.filter(u=>u.id!==s.id),x.value.failed_today++,w())}catch(e){console.error("Failed to fail print job:",e)}},B=async s=>{var o;try{(await fetch(`/api/print-jobs/${s.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}})).ok&&(p.value=p.value.filter(u=>u.id!==s.id))}catch(e){console.error("Failed to cancel print job:",e)}},D=async()=>{F.value=!0;try{if(typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager){await window.JSPM.JSPrintManager.start();const s=await window.JSPM.JSPrintManager.getPrinters();N.value=s;const o=s.find(e=>e.toLowerCase().includes("zdesigner"));o&&!m.value&&(m.value=o,console.log("Auto-selected ZDesigner printer:",o))}else console.warn("JSPrintManager not available")}catch(s){console.error("Failed to refresh printers:",s)}finally{F.value=!1}},K=()=>{console.log("Selected printer:",m.value),m.value&&localStorage.setItem("printStation_selectedPrinter",m.value)};return Z(()=>{const s=localStorage.getItem("printStation_selectedPrinter");s&&(m.value=s),w(),D(),setInterval(w,1e4)}),(s,o)=>(l(),U(Y,null,{header:r(()=>[t("div",ee,[t("div",null,[t("h2",te,i(n(c)("print_station.title")),1),t("p",se,i(n(c)("print_station.description")),1)]),t("div",ae,[t("div",ne,[a(_,{name:"Printer",class:"h-4 w-4 text-gray-500"}),Q(t("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>m.value=e),class:"text-sm border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1 bg-white dark:bg-gray-800",onChange:K},[t("option",ie,i(n(c)("print_station.select_printer")),1),(l(!0),d(k,null,P(N.value,e=>(l(),d("option",{key:e,value:e},i(e),9,oe))),128))],544),[[W,m.value]]),a(n(v),{size:"sm",variant:"outline",onClick:D,disabled:F.value},{default:r(()=>[a(_,{name:"RefreshCw",class:"h-3 w-3"})]),_:1},8,["disabled"])]),a(n(v),{onClick:w,disabled:S.value},{default:r(()=>[a(_,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),g(" "+i(n(c)("print_station.refresh")),1)]),_:1},8,["disabled"])])])]),default:r(()=>[t("div",re,[t("div",le,[t("div",ce,[a(n(h),null,{default:r(()=>[a(n(y),{class:"p-6"},{default:r(()=>[t("div",de,[t("div",_e,[t("div",ue,[a(_,{name:"Clock",class:"h-5 w-5"})])]),t("div",me,[t("dt",pe,i(n(c)("print_station.pending_jobs")),1),t("dd",fe,i(J.value.length),1)])])]),_:1})]),_:1}),a(n(h),null,{default:r(()=>[a(n(y),{class:"p-6"},{default:r(()=>[t("div",ge,[t("div",he,[t("div",ye,[a(_,{name:"Printer",class:"h-5 w-5"})])]),t("div",ve,[t("dt",xe,i(n(c)("print_station.processing_jobs")),1),t("dd",we,i($.value.length),1)])])]),_:1})]),_:1}),a(n(h),null,{default:r(()=>[a(n(y),{class:"p-6"},{default:r(()=>[t("div",be,[t("div",ke,[t("div",Pe,[a(_,{name:"CheckCircle",class:"h-5 w-5"})])]),t("div",Ce,[t("dt",Se,i(n(c)("print_station.completed_today")),1),t("dd",Fe,i(x.value.completed_today||0),1)])])]),_:1})]),_:1}),a(n(h),null,{default:r(()=>[a(n(y),{class:"p-6"},{default:r(()=>[t("div",Je,[t("div",$e,[t("div",Te,[a(_,{name:"XCircle",class:"h-5 w-5"})])]),t("div",Ae,[t("dt",Me,i(n(c)("print_station.failed_today")),1),t("dd",Ne,i(x.value.failed_today||0),1)])])]),_:1})]),_:1})]),t("div",De,[a(n(h),null,{default:r(()=>[a(n(T),null,{default:r(()=>[a(n(A),{class:"flex items-center gap-2"},{default:r(()=>[a(_,{name:"Clock",class:"h-5 w-5 text-yellow-600"}),g(" "+i(n(c)("print_station.pending_queue")),1)]),_:1})]),_:1}),a(n(y),null,{default:r(()=>[J.value.length===0?(l(),d("div",Oe,[a(_,{name:"Inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",ze,i(n(c)("print_station.no_pending_jobs")),1)])):(l(),d("div",Ie,[(l(!0),d(k,null,P(J.value,e=>(l(),d("div",{key:e.id,class:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800"},[t("div",Xe,[t("div",Ee,[t("div",Re,[a(n(M),{variant:I(e.priority)},{default:r(()=>[g(i(e.priority),1)]),_:2},1032,["variant"]),t("span",Le,i(e.job_id),1)]),t("div",qe,[t("p",Ve,i(e.asset.asset_tag),1),t("p",Be,i(e.asset.model_name)+" - "+i(e.company.name),1),t("p",Ke,i(n(c)("print_station.requested_by"))+" "+i(e.user.name),1),e.comment?(l(),d("p",je," ðŸ’¬ "+i(e.comment),1)):z("",!0)])]),t("div",He,[a(n(v),{size:"sm",onClick:u=>E(e)},{default:r(()=>[a(_,{name:"Play",class:"h-4 w-4"})]),_:2},1032,["onClick"]),a(n(v),{size:"sm",variant:"outline",onClick:u=>B(e)},{default:r(()=>[a(_,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1}),a(n(h),null,{default:r(()=>[a(n(T),null,{default:r(()=>[a(n(A),{class:"flex items-center gap-2"},{default:r(()=>[a(_,{name:"Printer",class:"h-5 w-5 text-blue-600"}),g(" "+i(n(c)("print_station.processing_queue")),1)]),_:1})]),_:1}),a(n(y),null,{default:r(()=>[$.value.length===0?(l(),d("div",Ze,[a(_,{name:"Printer",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",Ue,i(n(c)("print_station.no_processing_jobs")),1)])):(l(),d("div",Ge,[(l(!0),d(k,null,P($.value,e=>(l(),d("div",{key:e.id,class:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800"},[t("div",Qe,[t("div",We,[t("div",Ye,[a(n(M),{variant:"secondary"},{default:r(()=>[g(i(e.priority),1)]),_:2},1024),t("span",et,i(e.job_id),1)]),t("div",tt,[t("p",st,i(e.asset.asset_tag),1),t("p",at,i(e.asset.model_name)+" - "+i(e.company.name),1),t("div",nt,[o[1]||(o[1]=t("div",{class:"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full"},null,-1)),t("span",it,i(n(c)("print_station.printing")),1)]),e.comment?(l(),d("p",ot," ðŸ’¬ "+i(e.comment),1)):z("",!0)])]),t("div",rt,[a(n(v),{size:"sm",variant:"outline",onClick:u=>q(e)},{default:r(()=>[a(_,{name:"Check",class:"h-4 w-4"})]),_:2},1032,["onClick"]),a(n(v),{size:"sm",variant:"destructive",onClick:u=>V(e)},{default:r(()=>[a(_,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1})]),t("div",lt,[a(n(h),null,{default:r(()=>[a(n(T),null,{default:r(()=>[a(n(A),null,{default:r(()=>[g(i(n(c)("print_station.recent_activity")),1)]),_:1})]),_:1}),a(n(y),null,{default:r(()=>[C.value.length===0?(l(),d("div",ct,[t("p",dt,i(n(c)("print_station.no_recent_activity")),1)])):(l(),d("div",_t,[(l(!0),d(k,null,P(C.value,e=>(l(),d("div",{key:e.id,class:"flex items-center justify-between p-2 rounded border"},[t("div",ut,[a(_,{name:e.status==="completed"?"CheckCircle":"XCircle",class:G([e.status==="completed"?"text-green-600":"text-red-600","h-4 w-4"])},null,8,["name","class"]),t("span",mt,i(e.asset.asset_tag),1),a(n(M),{variant:e.status==="completed"?"default":"destructive",size:"sm"},{default:r(()=>[g(i(e.status),1)]),_:2},1032,["variant"])]),t("span",pt,i(X(e.completed_at||e.updated_at)),1)]))),128))]))]),_:1})]),_:1})])])])]),_:1}))}});export{qt as default};
