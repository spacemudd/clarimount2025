import{d as rt,u as lt,p as g,c as U,C as dt,G as ct,i as ut,o as c,w as r,f as t,a as u,l as P,b as a,t as i,e,h as m,m as G,z as _t,F as T,r as D,v as pt,n as Y}from"./app-BSKs9kyb.js";import{_ as mt}from"./AppLayout.vue_vue_type_script_setup_true_lang-gV_Uweek.js";import{_ as x}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C09Y8QSw.js";import{_ as w,a as b}from"./CardContent.vue_vue_type_script_setup_true_lang-CYp5oZ9R.js";import{_ as N,a as $}from"./CardTitle.vue_vue_type_script_setup_true_lang-CqSjzepR.js";import{_ as q}from"./Badge.vue_vue_type_script_setup_true_lang-CXZyt9Yi.js";import{_ as Z}from"./Label.vue_vue_type_script_setup_true_lang-Bs-FxAEo.js";import{_}from"./Icon.vue_vue_type_script_setup_true_lang-Bo_OXCk8.js";import"./useForwardExpose-6qYNyk4e.js";import"./RovingFocusGroup-BpzcSHHD.js";import"./building-CiecAx3m.js";import"./users-DWDZFv9g.js";import"./activity-B5loHG48.js";import"./arrow-left-BNxTk1Q7.js";import"./calendar-C7gGaCUU.js";import"./check-CwbLdCBg.js";import"./chevron-down-RMJZehqC.js";import"./search-D1YPnQwF.js";import"./eye-DS0RS9u6.js";import"./user-BkU-KgoD.js";import"./loader-circle-C12bf2oi.js";import"./sun-08nmbupo.js";import"./play-CcqXriNV.js";import"./plus-COW-q3Ql.js";import"./square-pen-C5MrGS6m.js";import"./trash-2-DEWc2Duq.js";import"./triangle-alert-AOX-N1ZK.js";const ft={class:"flex items-center justify-between"},gt={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},vt={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},ht={class:"flex items-center gap-4"},yt={class:"flex items-center gap-2"},xt={class:"text-sm font-medium"},wt={class:"py-6"},bt={class:"mx-auto max-w-7xl px-6 lg:px-8"},kt={key:0,class:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"},Ft={class:"flex items-center justify-between"},Pt={class:"flex items-center gap-3"},Ct={class:"font-medium text-blue-900 dark:text-blue-100"},St={key:0,class:"text-sm text-blue-700 dark:text-blue-300"},Jt={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},Et={class:"flex items-center"},It={class:"flex-shrink-0"},Mt={class:"flex h-8 w-8 items-center justify-center rounded-md bg-yellow-100 text-yellow-600"},Tt={class:"ml-4"},Dt={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Nt={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},$t={class:"flex items-center"},At={class:"flex-shrink-0"},Ot={class:"flex h-8 w-8 items-center justify-center rounded-md bg-blue-100 text-blue-600"},jt={class:"ml-4"},Lt={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},qt={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},zt={class:"flex items-center"},Bt={class:"flex-shrink-0"},Kt={class:"flex h-8 w-8 items-center justify-center rounded-md bg-green-100 text-green-600"},Rt={class:"ml-4"},Xt={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Vt={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Wt={class:"flex items-center"},Ht={class:"flex-shrink-0"},Ut={class:"flex h-8 w-8 items-center justify-center rounded-md bg-red-100 text-red-600"},Gt={class:"ml-4"},Yt={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Zt={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Qt={class:"mb-6"},te={class:"flex items-center justify-between"},ee={class:"font-medium"},se={class:"text-sm text-gray-600 dark:text-gray-400"},ae={key:0,class:"flex items-center space-x-2"},ne={key:1,class:"space-y-2"},ie={value:""},oe=["value"],re={key:2,class:"text-sm text-gray-600 dark:text-gray-400"},le={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},de={key:0,class:"text-center py-8"},ce={class:"text-gray-500"},ue={key:1,class:"space-y-4"},_e={class:"flex items-center justify-between"},pe={class:"flex-1"},me={class:"flex items-center gap-2"},fe={class:"text-sm font-medium"},ge={class:"mt-2"},ve={class:"font-semibold"},he={class:"text-sm text-gray-600 dark:text-gray-400"},ye={class:"text-xs text-gray-500 dark:text-gray-500"},xe={key:0,class:"flex gap-2"},we={key:0,class:"text-center py-8"},be={class:"text-gray-500"},ke={key:1,class:"space-y-4"},Fe={class:"flex items-center justify-between"},Pe={class:"flex-1"},Ce={class:"flex items-center gap-2"},Se={class:"text-sm font-medium"},Je={class:"mt-2"},Ee={class:"font-semibold"},Ie={class:"text-sm text-gray-600 dark:text-gray-400"},Me={class:"flex items-center gap-2 mt-1"},Te={class:"text-xs text-blue-600"},De={class:"flex gap-2"},Ne={class:"mt-6"},$e={key:0,class:"text-center py-4"},Ae={class:"text-gray-500"},Oe={key:1,class:"space-y-2"},je={class:"flex items-center gap-3"},Le={class:"font-medium"},qe={class:"text-sm text-gray-500"},fs=rt({__name:"Index",setup(ze){const{t:d}=lt(),f=g([]),A=g([]),C=g({pending:0,processing:0,completed_today:0,failed_today:0}),E=g(!1),k=g(!1),v=g(!1),h=g(null),I=g(!0),O=g(""),z=g([]),y=g("");let S=null,F=null;const M=U(()=>f.value.filter(n=>n.status==="pending").sort((n,o)=>{const s={urgent:4,high:3,normal:2,low:1},l=s[n.priority]||0,p=s[o.priority]||0;return l!==p?p-l:new Date(n.created_at).getTime()-new Date(o.created_at).getTime()})),j=U(()=>f.value.filter(n=>n.status==="processing")),Q=n=>{switch(n){case"urgent":return"destructive";case"high":return"secondary";case"normal":return"outline";case"low":return"secondary";default:return"outline"}},tt=n=>new Date(n).toLocaleTimeString(),J=async()=>{E.value=!0;try{const[n,o,s]=await Promise.all([fetch("/api/print-jobs/pending"),fetch("/api/print-jobs/history?limit=10"),fetch("/api/print-jobs/statistics")]);n.ok&&(f.value=await n.json()),o.ok&&(A.value=await o.json()),s.ok&&(C.value=await s.json())}catch(n){console.error("Failed to refresh jobs:",n)}finally{E.value=!1}},B=()=>{S||(k.value=!0,S=window.setInterval(J,2e3),console.log("Started polling for print jobs every 2 seconds"))},K=()=>{S&&(clearInterval(S),S=null),k.value=!1,console.log("Stopped polling for print jobs")},et=()=>{k.value?K():B()},R=async()=>{if(v.value)v.value=!1,h.value=null,F&&(clearInterval(F),F=null);else{if(!await H()){alert("JSPrintManager is not available. Please install and start JSPrintManager.");return}v.value=!0,st()}},st=()=>{F||(F=window.setInterval(async()=>{if(h.value)return;const n=M.value[0];n&&await X(n,!0)},1e3))},X=async(n,o=!1)=>{var s;try{if((await fetch(`/api/print-jobs/${n.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},body:JSON.stringify({status:"processing",print_station_id:"AUTO_STATION_"+Date.now()})})).ok){const p=f.value.findIndex(ot=>ot.id===n.id);p!==-1&&(f.value[p].status="processing"),o&&(h.value=n),await it(n)}}catch(l){console.error("Failed to process print job:",l)}},V=async n=>{var o,s;try{(await fetch(`/api/print-jobs/${n.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"completed"})})).ok&&(f.value=f.value.filter(p=>p.id!==n.id),C.value.completed_today++,((s=h.value)==null?void 0:s.id)===n.id&&(h.value=null),J())}catch(l){console.error("Failed to complete print job:",l)}},W=async n=>{var o,s;try{(await fetch(`/api/print-jobs/${n.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"failed",error_message:"Print job failed"})})).ok&&(f.value=f.value.filter(p=>p.id!==n.id),C.value.failed_today++,((s=h.value)==null?void 0:s.id)===n.id&&(h.value=null),J())}catch(l){console.error("Failed to fail print job:",l)}},at=async n=>{var o;try{(await fetch(`/api/print-jobs/${n.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}})).ok&&(f.value=f.value.filter(l=>l.id!==n.id))}catch(s){console.error("Failed to cancel print job:",s)}},L=n=>new Promise((o,s)=>{if(document.querySelector(`script[src="${n}"]`)){o();return}const p=document.createElement("script");p.src=n,p.onload=()=>o(),p.onerror=()=>s(new Error(`Failed to load script: ${n}`)),document.head.appendChild(p)}),nt=async()=>{try{y.value="Loading print libraries...",await L("/js/bluebird.min.js"),await L("/js/jquery-3.2.1.slim.min.js"),await L("/js/jsmanager/JSPrintManager.js"),y.value="Print libraries loaded successfully"}catch(n){throw console.error("Failed to load scripts:",n),y.value="Failed to load print libraries",n}},H=async()=>{try{return typeof window.JSPrintManager>"u"&&await nt(),typeof window.JSPrintManager>"u"?!1:(window.JSPrintManager.auto_reconnect=!0,window.JSPrintManager.start(),await new Promise((n,o)=>{const s=setTimeout(()=>o(new Error("Connection timeout")),5e3);window.JSPrintManager.WS.onStatusChanged=function(){window.JSPrintManager.websocket_status===window.WSStatus.Open?(clearTimeout(s),y.value="Connected to JSPrintManager",window.JSPrintManager.getPrinters().then(l=>{z.value=l}),n()):window.JSPrintManager.websocket_status===window.WSStatus.Closed?(clearTimeout(s),y.value="JSPrintManager not running",o(new Error("JSPrintManager not running"))):window.JSPrintManager.websocket_status===window.WSStatus.Blocked&&(clearTimeout(s),y.value="JSPrintManager blocked this website",o(new Error("JSPrintManager blocked")))}}),!0)}catch(n){return console.error("Failed to initialize JSPrintManager:",n),y.value="Failed to connect to JSPrintManager",!1}},it=async n=>{try{if(typeof window.JSPrintManager>"u")throw new Error("JSPrintManager not available");const o=n.print_data,s=new window.ClientPrintJob;I.value?s.clientPrinter=new window.DefaultPrinter:s.clientPrinter=new window.InstalledPrinter(O.value);let l="^XA";l+="^PW406",l+="^LL203",l+="^MD30",l+="^SD15",l+="^FO10,50^GFA,329,329,7,,,,,,K0F1C,J01E3E,I039F1C4,I079E10F,I07BF03E,I073E17E,00213E7FC,00607CFF8,00F87CFF,00F8F9F800C,00FCF8J08,007EF,003E6,03BEK03F,039FK07F,039FK07F,07CFK03F8,008F,I0F8I018,I07J03C,03DK03E68,07FCJ01C7,03FFJ01E7,03FF8I01F3,017FEI09F,I0FE0018F8,0043E003CF8,00F1I03C7C,00F80807C3C,0070700F838,0020F00F008,I03E00F3,I07E01F38,I07C01E78,I03801E3,L01E,L01C,L01,,,,,^FS",l+="^FO70,30^A0N,18,18^FDFAHAD NAWAF ALZEER HOLDING CO.^FS",l+=`^FO70,65^A0N,24,24^FD${o.asset_tag}^FS`,l+="^FO70,100^BY2,2,35",l+="^BCN,35,Y,N,N",l+=`^FD${o.serial_number||o.asset_tag}^FS`,l+="^FO320,50^BQN,2,4",l+=`^FDMM,${o.asset_tag}^FS`,l+=`^FO70,175^A0N,18,18^FD${new Date().toISOString().split("T")[0]}^FS`,l+="^XZ",s.printerCommands=l,s.sendToClient(),v.value&&setTimeout(()=>{V(n)},3e3)}catch(o){console.error("Failed to print asset label:",o),await W(n)}};return dt(()=>{J(),B(),H()}),ct(()=>{K(),F&&clearInterval(F)}),(n,o)=>(c(),ut(mt,null,{header:r(()=>[t("div",ft,[t("div",null,[t("h2",gt,i(e(d)("print_station.title")),1),t("p",vt,i(e(d)("print_station.description")),1)]),t("div",ht,[t("div",yt,[t("div",{class:Y(["h-3 w-3 rounded-full",k.value?"bg-green-500":"bg-red-500"])},null,2),t("span",xt,i(k.value?e(d)("print_station.polling_active"):e(d)("print_station.polling_stopped")),1)]),a(e(x),{onClick:et,disabled:E.value},{default:r(()=>[a(_,{name:k.value?"Pause":"Play",class:"mr-2 h-4 w-4"},null,8,["name"]),m(" "+i(k.value?e(d)("print_station.stop"):e(d)("print_station.start")),1)]),_:1},8,["disabled"]),a(e(x),{onClick:J,disabled:E.value},{default:r(()=>[a(_,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),m(" "+i(e(d)("print_station.refresh")),1)]),_:1},8,["disabled"])])])]),default:r(()=>[t("div",wt,[t("div",bt,[v.value?(c(),u("div",kt,[t("div",Ft,[t("div",Pt,[o[2]||(o[2]=t("div",{class:"animate-pulse h-3 w-3 bg-blue-500 rounded-full"},null,-1)),t("span",Ct,i(e(d)("print_station.auto_print_active")),1),h.value?(c(),u("span",St,i(e(d)("print_station.printing_job",{jobId:h.value.job_id})),1)):P("",!0)]),a(e(x),{variant:"outline",size:"sm",onClick:R},{default:r(()=>[m(i(e(d)("print_station.disable_auto_print")),1)]),_:1})])])):P("",!0),t("div",Jt,[a(e(w),null,{default:r(()=>[a(e(b),{class:"p-6"},{default:r(()=>[t("div",Et,[t("div",It,[t("div",Mt,[a(_,{name:"Clock",class:"h-5 w-5"})])]),t("div",Tt,[t("dt",Dt,i(e(d)("print_station.pending_jobs")),1),t("dd",Nt,i(M.value.length),1)])])]),_:1})]),_:1}),a(e(w),null,{default:r(()=>[a(e(b),{class:"p-6"},{default:r(()=>[t("div",$t,[t("div",At,[t("div",Ot,[a(_,{name:"Printer",class:"h-5 w-5"})])]),t("div",jt,[t("dt",Lt,i(e(d)("print_station.processing_jobs")),1),t("dd",qt,i(j.value.length),1)])])]),_:1})]),_:1}),a(e(w),null,{default:r(()=>[a(e(b),{class:"p-6"},{default:r(()=>[t("div",zt,[t("div",Bt,[t("div",Kt,[a(_,{name:"CheckCircle",class:"h-5 w-5"})])]),t("div",Rt,[t("dt",Xt,i(e(d)("print_station.completed_today")),1),t("dd",Vt,i(C.value.completed_today||0),1)])])]),_:1})]),_:1}),a(e(w),null,{default:r(()=>[a(e(b),{class:"p-6"},{default:r(()=>[t("div",Wt,[t("div",Ht,[t("div",Ut,[a(_,{name:"XCircle",class:"h-5 w-5"})])]),t("div",Gt,[t("dt",Yt,i(e(d)("print_station.failed_today")),1),t("dd",Zt,i(C.value.failed_today||0),1)])])]),_:1})]),_:1})]),t("div",Qt,[a(e(w),null,{default:r(()=>[a(e(N),null,{default:r(()=>[a(e($),null,{default:r(()=>[m(i(e(d)("print_station.auto_print_settings")),1)]),_:1})]),_:1}),a(e(b),{class:"space-y-4"},{default:r(()=>[t("div",te,[t("div",null,[t("h3",ee,i(e(d)("print_station.enable_auto_print")),1),t("p",se,i(e(d)("print_station.auto_print_description")),1)]),a(e(x),{onClick:R,variant:v.value?"destructive":"default"},{default:r(()=>[m(i(v.value?e(d)("print_station.disable"):e(d)("print_station.enable")),1)]),_:1},8,["variant"])]),v.value?P("",!0):(c(),u("div",ae,[G(t("input",{type:"checkbox",id:"useDefaultPrinter","onUpdate:modelValue":o[0]||(o[0]=s=>I.value=s),class:"rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},null,512),[[_t,I.value]]),a(e(Z),{for:"useDefaultPrinter",class:"font-medium"},{default:r(()=>[m(i(e(d)("print_station.use_default_printer")),1)]),_:1})])),!v.value&&!I.value?(c(),u("div",ne,[a(e(Z),{for:"installedPrinterName"},{default:r(()=>[m(i(e(d)("print_station.select_printer")),1)]),_:1}),G(t("select",{id:"installedPrinterName","onUpdate:modelValue":o[1]||(o[1]=s=>O.value=s),class:"w-full rounded-md border border-gray-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"},[t("option",ie,i(e(d)("print_station.select_printer_option")),1),(c(!0),u(T,null,D(z.value,s=>(c(),u("option",{key:s,value:s},i(s),9,oe))),128))],512),[[pt,O.value]])])):P("",!0),y.value?(c(),u("div",re,i(e(d)("print_station.status"))+": "+i(y.value),1)):P("",!0)]),_:1})]),_:1})]),t("div",le,[a(e(w),null,{default:r(()=>[a(e(N),null,{default:r(()=>[a(e($),{class:"flex items-center gap-2"},{default:r(()=>[a(_,{name:"Clock",class:"h-5 w-5 text-yellow-600"}),m(" "+i(e(d)("print_station.pending_queue")),1)]),_:1})]),_:1}),a(e(b),null,{default:r(()=>[M.value.length===0?(c(),u("div",de,[a(_,{name:"Inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",ce,i(e(d)("print_station.no_pending_jobs")),1)])):(c(),u("div",ue,[(c(!0),u(T,null,D(M.value,s=>(c(),u("div",{key:s.id,class:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800"},[t("div",_e,[t("div",pe,[t("div",me,[a(e(q),{variant:Q(s.priority)},{default:r(()=>[m(i(s.priority),1)]),_:2},1032,["variant"]),t("span",fe,i(s.job_id),1)]),t("div",ge,[t("p",ve,i(s.asset.asset_tag),1),t("p",he,i(s.asset.model_name)+" - "+i(s.company.name),1),t("p",ye,i(e(d)("print_station.requested_by"))+" "+i(s.user.name),1)])]),v.value?P("",!0):(c(),u("div",xe,[a(e(x),{size:"sm",onClick:l=>X(s)},{default:r(()=>[a(_,{name:"Play",class:"h-4 w-4"})]),_:2},1032,["onClick"]),a(e(x),{size:"sm",variant:"outline",onClick:l=>at(s)},{default:r(()=>[a(_,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])]))])]))),128))]))]),_:1})]),_:1}),a(e(w),null,{default:r(()=>[a(e(N),null,{default:r(()=>[a(e($),{class:"flex items-center gap-2"},{default:r(()=>[a(_,{name:"Printer",class:"h-5 w-5 text-blue-600"}),m(" "+i(e(d)("print_station.processing_queue")),1)]),_:1})]),_:1}),a(e(b),null,{default:r(()=>[j.value.length===0?(c(),u("div",we,[a(_,{name:"Printer",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",be,i(e(d)("print_station.no_processing_jobs")),1)])):(c(),u("div",ke,[(c(!0),u(T,null,D(j.value,s=>(c(),u("div",{key:s.id,class:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800"},[t("div",Fe,[t("div",Pe,[t("div",Ce,[a(e(q),{variant:"secondary"},{default:r(()=>[m(i(s.priority),1)]),_:2},1024),t("span",Se,i(s.job_id),1)]),t("div",Je,[t("p",Ee,i(s.asset.asset_tag),1),t("p",Ie,i(s.asset.model_name)+" - "+i(s.company.name),1),t("div",Me,[o[3]||(o[3]=t("div",{class:"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full"},null,-1)),t("span",Te,i(e(d)("print_station.printing")),1)])])]),t("div",De,[a(e(x),{size:"sm",variant:"outline",onClick:l=>V(s)},{default:r(()=>[a(_,{name:"Check",class:"h-4 w-4"})]),_:2},1032,["onClick"]),a(e(x),{size:"sm",variant:"destructive",onClick:l=>W(s)},{default:r(()=>[a(_,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1})]),t("div",Ne,[a(e(w),null,{default:r(()=>[a(e(N),null,{default:r(()=>[a(e($),null,{default:r(()=>[m(i(e(d)("print_station.recent_activity")),1)]),_:1})]),_:1}),a(e(b),null,{default:r(()=>[A.value.length===0?(c(),u("div",$e,[t("p",Ae,i(e(d)("print_station.no_recent_activity")),1)])):(c(),u("div",Oe,[(c(!0),u(T,null,D(A.value,s=>(c(),u("div",{key:s.id,class:"flex items-center justify-between p-2 rounded border"},[t("div",je,[a(_,{name:s.status==="completed"?"CheckCircle":"XCircle",class:Y([s.status==="completed"?"text-green-600":"text-red-600","h-4 w-4"])},null,8,["name","class"]),t("span",Le,i(s.asset.asset_tag),1),a(e(q),{variant:s.status==="completed"?"default":"destructive",size:"sm"},{default:r(()=>[m(i(s.status),1)]),_:2},1032,["variant"])]),t("span",qe,i(tt(s.completed_at||s.updated_at)),1)]))),128))]))]),_:1})]),_:1})])])])]),_:1}))}});export{fs as default};
