import{d as _e,u as fe,q as x,c as V,E as pe,i as S,o as r,w as a,f as n,b as s,m as g,a as _,e,n as I,g as c,t as o,s as ye,F as A,r as j,p as ve,z as ge,y as W}from"./app-1KIabcXq.js";import{g as he,_ as be}from"./AppLayout.vue_vue_type_script_setup_true_lang-Di1ucg1g.js";import{_ as p}from"./index-CwJR0htU.js";import{_ as Q}from"./Input.vue_vue_type_script_setup_true_lang-D1vk2Jl9.js";import{_ as B}from"./Badge.vue_vue_type_script_setup_true_lang-8iVtHDd9.js";import{_ as D,a as z}from"./CardContent.vue_vue_type_script_setup_true_lang-Dx2Iasj4.js";import{_ as T,a as U}from"./CardTitle.vue_vue_type_script_setup_true_lang-DLxcwCqf.js";import{_ as G,a as Y,b as Z,c as ee,d as te}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Dw6q89mD.js";import{_ as xe}from"./Checkbox.vue_vue_type_script_setup_true_lang-B-Oi3CeY.js";import{_ as se}from"./Label.vue_vue_type_script_setup_true_lang-owiMDJi-.js";import{_ as m}from"./Icon.vue_vue_type_script_setup_true_lang-4GsiKpcO.js";import{_ as we}from"./Heading.vue_vue_type_script_setup_true_lang-BEwRXv22.js";import"./useForwardExpose-cFFIN3iQ.js";import"./x-04VeQprZ.js";import"./building-CvbCUXPx.js";import"./users-CKnSU4By.js";import"./activity-B45mQqv1.js";import"./arrow-left-Dkh70pmG.js";import"./calendar-Cz1Wutts.js";import"./chevron-down-DtjAQYNc.js";import"./search-BsXRLbND.js";import"./eye-DZcKJkPI.js";import"./user-ByLTJ4UB.js";import"./loader-circle-DQdL0-pJ.js";import"./sun-0Xxn1Let.js";import"./play-DikWGMBQ.js";import"./plus-B1d4hc7X.js";import"./square-pen-CeA6RR10.js";import"./trash-2-BAPpfXrA.js";import"./triangle-alert-BoSpqyGP.js";const ke={class:"container mx-auto py-8"},Ce={class:"space-y-6"},$e={class:"space-y-2"},Se={class:"flex items-center justify-between"},Ae={class:"space-y-1"},je={class:"flex items-center gap-2"},De={class:"text-sm font-mono text-muted-foreground"},ze={class:"flex gap-2"},Te={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Ue={class:"space-y-3"},Fe={class:"flex items-center gap-3"},Ne={class:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center"},Pe={class:"font-medium"},Ee={class:"text-sm text-muted-foreground"},Be={class:"text-xs text-muted-foreground"},Le={key:0,class:"text-center py-8 text-muted-foreground"},Ve={class:"space-y-3"},Oe={class:"flex items-center gap-3"},qe={class:"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center"},Ie={class:"font-medium"},Re={class:"text-sm text-muted-foreground"},Me={class:"text-xs text-muted-foreground"},Xe=["placeholder"],He={key:1,class:"flex justify-end gap-4"},Je={class:"space-y-3"},Ke={class:"font-medium"},We={class:"text-sm text-muted-foreground"},Qe={class:"flex items-center gap-2"},Ge={class:"text-sm text-muted-foreground"},Ye={class:"space-y-3"},Ze={class:"flex-1"},et={class:"font-medium"},tt={class:"text-sm text-muted-foreground"},st={class:"text-xs text-amber-600 mt-1"},at={class:"flex items-center gap-2"},ot={class:"space-y-3"},lt={class:"font-medium"},nt={class:"text-sm text-muted-foreground"},dt={class:"flex items-center gap-2"},ut={class:"space-y-4"},rt={class:"max-h-96 overflow-y-auto"},ct={class:"space-y-2"},it=["onClick"],mt={class:"flex items-center gap-3"},_t={class:"h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center"},ft={key:0,class:"font-medium"},pt={key:1,class:"font-medium"},yt={key:2,class:"text-sm text-muted-foreground"},vt={class:"text-xs text-muted-foreground"},gt={key:3,class:"text-xs text-muted-foreground"},ht={key:4,class:"text-xs text-muted-foreground"},bt={key:0,class:"text-center py-8 text-muted-foreground"},xt={class:"space-y-4"},wt={class:"text-sm text-muted-foreground mt-1"},kt={key:0,class:"p-3 bg-gray-50 rounded-lg"},Ct={class:"font-medium"},$t={class:"text-sm text-muted-foreground"},ss=_e({__name:"CustodyManagement",props:{employee:{},currentAssets:{},availableAssets:{},recentCustodyChanges:{}},setup(ae){const{t:l}=fe(),y=ae,v=x(!1),h=x([...y.currentAssets]),L=x(""),F=x(!1),$=x(""),w=x([...y.availableAssets]),k=x(new Set),N=x(!1),C=x(null),P=x(null),oe=V(()=>[{title:l("nav.dashboard"),href:"/dashboard"},{title:l("employees.title"),href:"/employees"},{title:y.employee.full_name||"Employee",href:`/employees/${y.employee.id}`},{title:l("custody.update_custody"),href:`/employees/${y.employee.id}/custody`}]),O=V(()=>{const d=new Set(y.currentAssets.map(t=>t.id)),u=new Set(h.value.map(t=>t.id));if(d.size!==u.size)return!0;for(const t of d)if(!u.has(t))return!0;return!1}),R=V(()=>y.recentCustodyChanges.filter(d=>d.status==="pending"&&!d.document_path)),M=V(()=>y.recentCustodyChanges.filter(d=>d.status!=="pending"||d.document_path)),X=d=>{switch(d){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-yellow-100 text-yellow-800";case"terminated":return"bg-red-100 text-red-800";case"pending":return"bg-amber-100 text-amber-800";case"signed":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},le=d=>{h.value=h.value.filter(u=>u.id!==d.id)},ne=d=>{h.value=h.value.filter(u=>u.id!==d.id)},de=()=>{h.value=[...y.currentAssets],L.value=""},ue=d=>{const u=d.target;u.files&&u.files.length>0&&(P.value=u.files[0])},re=async()=>{if($.value.length<2){w.value=y.availableAssets;return}try{const u=await(await fetch(`/api/custody/available-assets?search=${encodeURIComponent($.value)}`)).json();w.value=u}catch(d){console.error("Asset search failed:",d),w.value=[]}},H=d=>{k.value.has(d.id)?k.value.delete(d.id):k.value.add(d.id)},ce=()=>{w.value.filter(u=>k.value.has(u.id)).forEach(u=>{h.value.find(t=>t.id===u.id)||h.value.push(u)}),k.value.clear(),F.value=!1,$.value="",w.value=y.availableAssets},ie=async()=>{var d;if(!O.value){alert(l("custody.no_changes_to_save"));return}v.value=!0;try{const u=(d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.content,t=route("employees.custody.store",y.employee.id),i={new_asset_ids:h.value.map(b=>b.id),changes_summary:L.value||""},f=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":u||"","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(i)}),E=f.headers.get("content-type");if(!E||!E.includes("application/json")){const b=await f.text();console.error("Non-JSON response received:",b),alert("Server returned non-JSON response. Check browser console for details.");return}if(f.ok){const b=await f.json();alert(l("custody.custody_updated_successfully")),W.visit(route("employees.custody.show",y.employee.id))}else{const b=await f.json();console.error("Server error:",b),alert(l("custody.failed_to_update_custody")+": "+(b.error||b.message||l("custody.unknown_error")))}}catch(u){console.error("Error updating custody:",u),alert(l("custody.failed_to_update_try_again"))}finally{v.value=!1}},q=d=>{window.open(route("custody.document",d.id),"_blank")},J=d=>{const u=window.open(route("custody.document",d.id),"_blank");u&&u.addEventListener("load",()=>{u.print()})},K=async d=>{C.value=d,N.value=!0},me=async()=>{var d;if(!P.value||!C.value){alert(l("custody.select_document_to_upload"));return}v.value=!0;try{const u=new FormData;u.append("document",P.value),u.append("type","signed");const t=await fetch(route("custody.upload",C.value.id),{method:"POST",body:u,headers:{"X-CSRF-TOKEN":((d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.content)||""}});if(t.ok){const i=await t.json();alert(l("custody.document_uploaded_successfully")),N.value=!1,C.value=null,P.value=null,W.reload()}else{const i=await t.json();alert(l("custody.failed_to_upload_document")+": "+(i.error||l("custody.unknown_error")))}}catch(u){console.error("Error uploading document:",u),alert(l("custody.failed_to_upload_try_again"))}finally{v.value=!1}};return pe(()=>{w.value=y.availableAssets}),(d,u)=>(r(),S(be,null,{default:a(()=>[n("div",ke,[n("div",Ce,[n("div",$e,[s(he,{breadcrumbs:oe.value},null,8,["breadcrumbs"]),n("div",Se,[n("div",Ae,[s(we,{title:`${e(l)("custody.update_custody")} - ${d.employee.full_name}`},null,8,["title"]),n("div",je,[s(e(B),{class:I(X(d.employee.employment_status))},{default:a(()=>[c(o(e(l)(`employees.status_${d.employee.employment_status}`)),1)]),_:1},8,["class"]),n("span",De,o(d.employee.employee_id),1)])]),n("div",ze,[s(e(p),{variant:"outline",asChild:""},{default:a(()=>[s(e(ye),{href:d.route("employees.show",d.employee.id)},{default:a(()=>[s(m,{name:"ArrowLeft",class:"mr-2 h-4 w-4"}),c(" "+o(e(l)("custody.back_to_employee")),1)]),_:1},8,["href"])]),_:1})])])]),n("div",Te,[s(e(D),null,{default:a(()=>[s(e(T),null,{default:a(()=>[s(e(U),{class:"flex items-center gap-2"},{default:a(()=>[s(m,{name:"Package",class:"h-5 w-5 text-blue-600"}),c(" "+o(e(l)("custody.current_custody"))+" ("+o(d.currentAssets.length)+") ",1)]),_:1})]),_:1}),s(e(z),null,{default:a(()=>[n("div",Ue,[(r(!0),_(A,null,j(d.currentAssets,t=>{var i;return r(),_("div",{key:t.id,class:"flex items-center justify-between p-3 border rounded-lg"},[n("div",Fe,[n("div",Ne,[s(m,{name:"Package",class:"h-4 w-4 text-blue-600"})]),n("div",null,[n("p",Pe,o(t.model_name||t.asset_tag),1),n("p",Ee,o(t.asset_tag),1),n("p",Be,o((i=t.assetCategory)==null?void 0:i.name),1)])]),s(e(p),{variant:"outline",size:"sm",onClick:f=>le(t),disabled:v.value},{default:a(()=>[s(m,{name:"Minus",class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"])])}),128)),d.currentAssets.length===0?(r(),_("div",Le,o(e(l)("custody.no_assets_assigned")),1)):g("",!0)])]),_:1})]),_:1}),s(e(D),null,{default:a(()=>[s(e(T),null,{default:a(()=>[s(e(U),{class:"flex items-center gap-2"},{default:a(()=>[s(m,{name:"Package",class:"h-5 w-5 text-green-600"}),c(" "+o(e(l)("custody.updated_custody"))+" ("+o(h.value.length)+") ",1)]),_:1})]),_:1}),s(e(z),null,{default:a(()=>[n("div",Ve,[(r(!0),_(A,null,j(h.value,t=>{var i;return r(),_("div",{key:t.id,class:"flex items-center justify-between p-3 border rounded-lg"},[n("div",Oe,[n("div",qe,[s(m,{name:"Package",class:"h-4 w-4 text-green-600"})]),n("div",null,[n("p",Ie,o(t.model_name||t.asset_tag),1),n("p",Re,o(t.asset_tag),1),n("p",Me,o((i=t.assetCategory)==null?void 0:i.name),1)])]),s(e(p),{variant:"outline",size:"sm",onClick:f=>ne(t),disabled:v.value},{default:a(()=>[s(m,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"])])}),128)),s(e(p),{variant:"outline",class:"w-full border-dashed",onClick:u[0]||(u[0]=t=>F.value=!0),disabled:v.value},{default:a(()=>[s(m,{name:"Plus",class:"mr-2 h-4 w-4"}),c(" "+o(e(l)("custody.add_asset")),1)]),_:1},8,["disabled"])])]),_:1})]),_:1})]),O.value?(r(),S(e(D),{key:0},{default:a(()=>[s(e(T),null,{default:a(()=>[s(e(U),{class:"flex items-center gap-2"},{default:a(()=>[s(m,{name:"FileText",class:"h-5 w-5 text-orange-600"}),c(" "+o(e(l)("custody.changes_summary")),1)]),_:1})]),_:1}),s(e(z),null,{default:a(()=>[n("div",null,[s(e(se),{for:"changes_summary",class:"mb-2"},{default:a(()=>[c(o(e(l)("custody.summary_optional")),1)]),_:1}),ve(n("textarea",{id:"changes_summary","onUpdate:modelValue":u[1]||(u[1]=t=>L.value=t),rows:"3",placeholder:e(l)("custody.summary_placeholder"),class:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},null,8,Xe),[[ge,L.value]])])]),_:1})]),_:1})):g("",!0),O.value?(r(),_("div",He,[s(e(p),{variant:"outline",onClick:de,disabled:v.value},{default:a(()=>[c(o(e(l)("custody.reset_changes")),1)]),_:1},8,["disabled"]),s(e(p),{onClick:ie,disabled:v.value},{default:a(()=>[s(m,{name:"Save",class:"mr-2 h-4 w-4"}),c(" "+o(v.value?e(l)("custody.saving"):e(l)("custody.save_custody_update")),1)]),_:1},8,["disabled"])])):g("",!0),d.recentCustodyChanges.length>0?(r(),S(e(D),{key:2},{default:a(()=>[s(e(T),null,{default:a(()=>[s(e(U),{class:"flex items-center gap-2"},{default:a(()=>[s(m,{name:"History",class:"h-5 w-5 text-gray-600"}),c(" "+o(e(l)("custody.recent_custody_changes")),1)]),_:1})]),_:1}),s(e(z),null,{default:a(()=>[n("div",Je,[(r(!0),_(A,null,j(d.recentCustodyChanges,t=>{var i;return r(),_("div",{key:t.id,class:"flex items-center justify-between p-3 border rounded-lg"},[n("div",null,[n("p",Ke,o(t.changes_summary||e(l)("custody.custody_updated")),1),n("p",We,o(new Date(t.created_at).toLocaleDateString())+" by "+o((i=t.updatedBy)==null?void 0:i.name),1)]),n("div",Qe,[s(e(B),{class:I(t.status==="completed"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800")},{default:a(()=>[c(o(e(l)("custody.status_"+t.status)),1)]),_:2},1032,["class"]),s(e(p),{variant:"outline",size:"sm",onClick:f=>J(t),title:e(l)("custody.print_document")},{default:a(()=>[s(m,{name:"Printer",class:"h-4 w-4"})]),_:2},1032,["onClick","title"]),s(e(p),{variant:"outline",size:"sm",onClick:f=>q(t),title:e(l)("custody.view_document")},{default:a(()=>[s(m,{name:"FileText",class:"h-4 w-4"})]),_:2},1032,["onClick","title"])])])}),128))])]),_:1})]),_:1})):g("",!0),R.value.length>0?(r(),S(e(D),{key:3},{default:a(()=>[s(e(T),null,{default:a(()=>[s(e(U),{class:"flex items-center gap-2"},{default:a(()=>[s(m,{name:"AlertCircle",class:"h-5 w-5 text-amber-600"}),c(" "+o(e(l)("custody.pending_custody_changes")),1)]),_:1}),n("p",Ge,o(e(l)("custody.pending_custody_changes_description")),1)]),_:1}),s(e(z),null,{default:a(()=>[n("div",Ye,[(r(!0),_(A,null,j(R.value,t=>{var i;return r(),_("div",{key:t.id,class:"flex items-center justify-between p-3 border rounded-lg bg-amber-50 border-amber-200"},[n("div",Ze,[n("p",et,o(t.changes_summary||e(l)("custody.custody_updated")),1),n("p",tt,o(new Date(t.created_at).toLocaleDateString())+" by "+o((i=t.updatedBy)==null?void 0:i.name),1),n("p",st,[s(m,{name:"Clock",class:"h-3 w-3 inline mr-1"}),c(" "+o(e(l)("custody.waiting_for_document")),1)])]),n("div",at,[s(e(B),{class:"bg-amber-100 text-amber-800"},{default:a(()=>[c(o(e(l)("custody.status_"+t.status)),1)]),_:2},1024),s(e(p),{variant:"outline",size:"sm",onClick:f=>q(t)},{default:a(()=>[s(m,{name:"FileText",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(e(p),{variant:"default",size:"sm",onClick:f=>K(t)},{default:a(()=>[s(m,{name:"Upload",class:"h-4 w-4 mr-1"}),c(" "+o(e(l)("custody.upload_document_button")),1)]),_:2},1032,["onClick"])])])}),128))])]),_:1})]),_:1})):g("",!0),M.value.length>0?(r(),S(e(D),{key:4},{default:a(()=>[s(e(T),null,{default:a(()=>[s(e(U),{class:"flex items-center gap-2"},{default:a(()=>[s(m,{name:"History",class:"h-5 w-5 text-gray-600"}),c(" "+o(e(l)("custody.other_custody_changes")),1)]),_:1})]),_:1}),s(e(z),null,{default:a(()=>[n("div",ot,[(r(!0),_(A,null,j(M.value,t=>{var i;return r(),_("div",{key:t.id,class:"flex items-center justify-between p-3 border rounded-lg"},[n("div",null,[n("p",lt,o(t.changes_summary||e(l)("custody.custody_updated")),1),n("p",nt,o(new Date(t.created_at).toLocaleDateString())+" by "+o((i=t.updatedBy)==null?void 0:i.name),1)]),n("div",dt,[s(e(B),{class:I(X(t.status))},{default:a(()=>[c(o(e(l)("custody.status_"+t.status)),1)]),_:2},1032,["class"]),s(e(p),{variant:"outline",size:"sm",onClick:f=>J(t),title:e(l)("custody.print_document")},{default:a(()=>[s(m,{name:"Printer",class:"h-4 w-4"})]),_:2},1032,["onClick","title"]),s(e(p),{variant:"outline",size:"sm",onClick:f=>q(t),title:e(l)("custody.view_document")},{default:a(()=>[s(m,{name:"FileText",class:"h-4 w-4"})]),_:2},1032,["onClick","title"]),t.status==="pending"?(r(),S(e(p),{key:0,variant:"default",size:"sm",onClick:f=>K(t)},{default:a(()=>[s(m,{name:"Upload",class:"h-4 w-4 mr-1"}),c(" "+o(e(l)("custody.upload_document_button")),1)]),_:2},1032,["onClick"])):g("",!0)])])}),128))])]),_:1})]),_:1})):g("",!0)])]),s(e(G),{open:F.value,"onUpdate:open":u[4]||(u[4]=t=>F.value=t)},{default:a(()=>[s(e(Y),{class:"max-w-4xl"},{default:a(()=>[s(e(Z),null,{default:a(()=>[s(e(ee),null,{default:a(()=>[c(o(e(l)("custody.select_assets_to_add")),1)]),_:1})]),_:1}),n("div",ut,[n("div",null,[s(e(Q),{modelValue:$.value,"onUpdate:modelValue":u[2]||(u[2]=t=>$.value=t),placeholder:e(l)("custody.search_assets_placeholder"),onInput:re},null,8,["modelValue","placeholder"])]),n("div",rt,[n("div",ct,[(r(!0),_(A,null,j(w.value,t=>{var i,f,E;return r(),_("div",{key:t.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:b=>H(t)},[n("div",mt,[s(e(xe),{checked:k.value.has(t.id),"onUpdate:checked":b=>H(t)},null,8,["checked","onUpdate:checked"]),n("div",_t,[s(m,{name:"Package",class:"h-4 w-4"})]),n("div",null,[t.model_name&&t.model_name!==t.asset_tag?(r(),_("p",ft,o(t.model_name),1)):(r(),_("p",pt,o(t.asset_tag),1)),t.model_name&&t.model_name!==t.asset_tag?(r(),_("p",yt,o(t.asset_tag),1)):g("",!0),n("p",vt,o((i=t.assetCategory)==null?void 0:i.name)+" - "+o((f=t.location)==null?void 0:f.name),1),t.serial_number?(r(),_("p",gt,o(e(l)("assets.serial_number"))+": "+o(t.serial_number),1)):g("",!0),(E=t.asset_template)!=null&&E.name?(r(),_("p",ht,o(e(l)("assets.template"))+": "+o(t.asset_template.name),1)):g("",!0)])]),s(e(B),{variant:"outline"},{default:a(()=>[c(o(e(l)(`assets.status_${t.status}`)),1)]),_:2},1024)],8,it)}),128)),w.value.length===0&&$.value?(r(),_("div",bt,o(e(l)("custody.no_available_assets_found")),1)):g("",!0)])])]),s(e(te),null,{default:a(()=>[s(e(p),{variant:"outline",onClick:u[3]||(u[3]=t=>F.value=!1)},{default:a(()=>[c(o(e(l)("common.cancel")),1)]),_:1}),s(e(p),{onClick:ce,disabled:k.value.size===0},{default:a(()=>[c(o(e(l)("custody.add_selected_assets",{count:k.value.size})),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),s(e(G),{open:N.value,"onUpdate:open":u[6]||(u[6]=t=>N.value=t)},{default:a(()=>[s(e(Y),{class:"max-w-md"},{default:a(()=>[s(e(Z),null,{default:a(()=>[s(e(ee),null,{default:a(()=>[c(o(e(l)("custody.upload_document_button")),1)]),_:1})]),_:1}),n("div",xt,[n("div",null,[s(e(se),{for:"document-upload"},{default:a(()=>[c(o(e(l)("custody.select_document")),1)]),_:1}),s(e(Q),{id:"document-upload",type:"file",accept:".pdf,.jpg,.jpeg,.png,.gif",onChange:ue,class:"mt-1"}),n("p",wt,o(e(l)("custody.upload_signed_document")),1)]),C.value?(r(),_("div",kt,[n("p",Ct,o(C.value.changes_summary||e(l)("custody.custody_change")),1),n("p",$t,o(new Date(C.value.created_at).toLocaleDateString()),1)])):g("",!0)]),s(e(te),null,{default:a(()=>[s(e(p),{variant:"outline",onClick:u[5]||(u[5]=t=>N.value=!1)},{default:a(()=>[c(o(e(l)("common.cancel")),1)]),_:1}),s(e(p),{onClick:me,disabled:!P.value||v.value},{default:a(()=>[c(o(v.value?e(l)("custody.uploading"):e(l)("custody.upload_document_button")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}});export{ss as default};
