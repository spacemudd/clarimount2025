var c=Object.defineProperty;var d=(s,n,t)=>n in s?c(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t;var o=(s,n,t)=>d(s,typeof n!="symbol"?n+"":n,t);const a=class a{constructor(){o(this,"statusCallbacks",[])}static getInstance(){return a.instance||(a.instance=new a),a.instance}loadScript(n){return new Promise((t,r)=>{if(document.querySelector(`script[src="${n}"]`)){t();return}const i=document.createElement("script");i.src=n,i.onload=()=>t(),i.onerror=()=>r(new Error(`Failed to load script: ${n}`)),document.head.appendChild(i)})}async loadRequiredScripts(){try{this.notifyStatusChange("Loading print libraries..."),await this.loadScript("/js/bluebird.min.js"),await this.loadScript("/js/jquery-3.2.1.slim.min.js"),await this.loadScript("/js/jsmanager/JSPrintManager.js"),this.notifyStatusChange("Print libraries loaded successfully")}catch(n){throw console.error("Failed to load scripts:",n),this.notifyStatusChange("Failed to load print libraries"),n}}async initializeJSPrintManager(){return typeof window.JSPM>"u"&&await this.loadRequiredScripts(),new Promise((n,t)=>{if(typeof window.JSPM<"u")window.JSPM.JSPrintManager.auto_reconnect=!0,window.JSPM.JSPrintManager.start(),window.JSPM.JSPrintManager.WS.onStatusChanged=()=>{this.jspmWSStatus()?(this.notifyStatusChange("Connected to JSPrintManager",[],!0),window.JSPM.JSPrintManager.getPrinters().then(r=>{this.notifyStatusChange("Connected to JSPrintManager",r,!0),n()}).catch(t)):(this.notifyStatusChange("JSPrintManager connection failed",[],!1),t(new Error("JSPrintManager connection failed")))};else{const r="JSPrintManager not loaded";this.notifyStatusChange(r,[],!1),t(new Error(r))}})}jspmWSStatus(){return window.JSPM.JSPrintManager.websocket_status==window.JSPM.WSStatus.Open?!0:window.JSPM.JSPrintManager.websocket_status==window.JSPM.WSStatus.Closed?(this.notifyStatusChange("JSPrintManager is not installed or not running! Download JSPM Client App from https://neodynamic.com/downloads/jspm",[],!1),!1):(window.JSPM.JSPrintManager.websocket_status==window.JSPM.WSStatus.Blocked&&this.notifyStatusChange("JSPM has blocked this website!",[],!1),!1)}async getAvailablePrinters(){return typeof window.JSPM<"u"&&this.jspmWSStatus()?await window.JSPM.JSPrintManager.getPrinters():[]}generateAssetLabelZPL(n){let t="^XA";return t+="^PW406",t+="^LL203",t+="^MD30",t+="^SD15",t+="^FO10,50^GFA,329,329,7,,,,,,K0F1C,J01E3E,I039F1C4,I079E10F,I07BF03E,I073E17E,00213E7FC,00607CFF8,00F87CFF,00F8F9F800C,00FCF8J08,007EF,003E6,03BEK03F,039FK07F,039FK07F,07CFK03F8,008F,I0F8I018,I07J03C,03DK03E68,07FCJ01C7,03FFJ01E7,03FF8I01F3,017FEI09F,I0FE0018F8,0043E003CF8,00F1I03C7C,00F80807C3C,0070700F838,0020F00F008,I03E00F3,I07E01F38,I07C01E78,I03801E3,L01E,L01C,L01,,,,,^FS",t+="^FO70,30^A0N,18,18^FDFAHAD NAWAF ALZEER HOLDING CO.^FS",t+=`^FO70,65^A0N,24,24^FD${n.asset_tag}^FS`,t+="^FO70,100^BY2,2,35",t+="^BCN,35,Y,N,N",t+=`^FD${n.serial_number||n.asset_tag}^FS`,t+="^FO320,50^BQN,2,4",t+=`^FDMM,${n.asset_tag}^FS`,t+=`^FO70,175^A0N,18,18^FD${new Date().toISOString().split("T")[0]}^FS`,t+="^XZ",t}async printAssetLabel(n,t=!1,r=""){if(!this.jspmWSStatus())throw new Error("JSPrintManager is not connected");if(!t&&!r)throw new Error("No printer selected");try{const e=new window.JSPM.ClientPrintJob;t?e.clientPrinter=new window.JSPM.DefaultPrinter:e.clientPrinter=new window.JSPM.InstalledPrinter(r);const i=this.generateAssetLabelZPL(n);e.printerCommands=i,e.sendToClient(),console.log(`Printed label for asset ${n.asset_tag}`)}catch(e){throw console.error("Print error:",e),e}}async printMultipleAssetLabels(n,t=!1,r=""){if(!this.jspmWSStatus())throw new Error("JSPrintManager is not connected");if(!t&&!r)throw new Error("No printer selected");try{const e=new window.JSPM.ClientPrintJob;t?e.clientPrinter=new window.JSPM.DefaultPrinter:e.clientPrinter=new window.JSPM.InstalledPrinter(r);let i="";n.forEach(S=>{i+=this.generateAssetLabelZPL(S)}),e.printerCommands=i,e.sendToClient(),console.log(`Printed ${n.length} labels`)}catch(e){throw console.error("Print error:",e),e}}onStatusChange(n){this.statusCallbacks.push(n)}offStatusChange(n){const t=this.statusCallbacks.indexOf(n);t>-1&&this.statusCallbacks.splice(t,1)}notifyStatusChange(n,t=[],r=!1){this.statusCallbacks.forEach(e=>{e({status:n,availablePrinters:t,isConnected:r})})}};o(a,"instance");let l=a;export{l as P};
