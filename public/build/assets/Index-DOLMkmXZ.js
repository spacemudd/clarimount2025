import{d as j,u as H,p as v,c as O,C as U,i as Z,o as c,w as l,f as t,b as s,e as n,t as o,h,a as d,F as k,r as C,l as L,n as G,m as Q,v as Y}from"./app-COEuzrRD.js";import{_ as ee}from"./AppLayout.vue_vue_type_script_setup_true_lang-Ct5cns0Q.js";import{_ as y}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-4jJb_-WM.js";import{_ as x,a as w}from"./CardContent.vue_vue_type_script_setup_true_lang-CgnwjQM9.js";import{_ as N,a as F}from"./CardTitle.vue_vue_type_script_setup_true_lang-DoKWherE.js";import{_ as z}from"./Badge.vue_vue_type_script_setup_true_lang-DfYG3TuL.js";import{_ as u}from"./Icon.vue_vue_type_script_setup_true_lang-T0ZPZK-r.js";import{P as te}from"./PrintService-B0MGNNQ7.js";import"./useForwardExpose-BheO8JaA.js";import"./RovingFocusGroup-Ci7d5tw1.js";import"./building-CKtq9jPr.js";import"./users-DWwMG2GQ.js";import"./activity-Cz0CdVk9.js";import"./arrow-left-CWVnQBvX.js";import"./calendar-U0w8TVRV.js";import"./check-Dpjf-7Rw.js";import"./chevron-down-C1xmO-Fr.js";import"./search-CNCRqgBa.js";import"./eye-B_6rmHDY.js";import"./user-B9vkwLXY.js";import"./loader-circle-g7z_WiLT.js";import"./sun-Dbhhukoh.js";import"./play-CP1TsOsV.js";import"./plus-kXMflnhn.js";import"./square-pen-DNXir1Re.js";import"./trash-2-D8oscHI7.js";import"./triangle-alert-ShptOfGv.js";const se={class:"flex items-center justify-between"},ne={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},ae={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},oe={class:"flex items-center gap-4"},ie={class:"flex items-center gap-2"},re={value:""},le=["value"],ce={class:"py-6"},de={class:"mx-auto max-w-7xl px-6 lg:px-8"},ue={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},_e={class:"flex items-center"},pe={class:"flex-shrink-0"},me={class:"flex h-8 w-8 items-center justify-center rounded-md bg-yellow-100 text-yellow-600"},fe={class:"ml-4"},ge={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},he={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},ve={class:"flex items-center"},ye={class:"flex-shrink-0"},xe={class:"flex h-8 w-8 items-center justify-center rounded-md bg-blue-100 text-blue-600"},we={class:"ml-4"},be={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Pe={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Se={class:"flex items-center"},ke={class:"flex-shrink-0"},Ce={class:"flex h-8 w-8 items-center justify-center rounded-md bg-green-100 text-green-600"},Je={class:"ml-4"},Me={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},$e={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Te={class:"flex items-center"},Ae={class:"flex-shrink-0"},Ne={class:"flex h-8 w-8 items-center justify-center rounded-md bg-red-100 text-red-600"},Fe={class:"ml-4"},ze={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},De={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Oe={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Le={key:0,class:"text-center py-8"},Ee={class:"text-gray-500"},Ie={key:1,class:"space-y-4"},Xe={class:"flex items-center justify-between"},qe={class:"flex-1"},We={class:"flex items-center gap-2"},Be={class:"text-sm font-medium"},Ve={class:"mt-2"},Re={class:"font-semibold"},Ke={class:"text-sm text-gray-600 dark:text-gray-400"},je={class:"text-xs text-gray-500 dark:text-gray-500"},He={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},Ue={class:"flex gap-2"},Ze={key:0,class:"text-center py-8"},Ge={class:"text-gray-500"},Qe={key:1,class:"space-y-4"},Ye={class:"flex items-center justify-between"},et={class:"flex-1"},tt={class:"flex items-center gap-2"},st={class:"text-sm font-medium"},nt={class:"mt-2"},at={class:"font-semibold"},ot={class:"text-sm text-gray-600 dark:text-gray-400"},it={class:"flex items-center gap-2 mt-1"},rt={class:"text-xs text-blue-600"},lt={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},ct={class:"flex gap-2"},dt={class:"mt-6"},ut={key:0,class:"text-center py-4"},_t={class:"text-gray-500"},pt={key:1,class:"space-y-2"},mt={class:"flex items-center gap-3"},ft={class:"font-medium"},gt={class:"text-sm text-gray-500"},Rt=j({__name:"Index",setup(ht){const{t:_}=H(),m=v([]),J=v([]),P=v({pending:0,processing:0,completed_today:0,failed_today:0}),M=v(!1),b=v(!1),p=v(""),g=v([]),$=te.getInstance(),T=O(()=>m.value.filter(a=>a.status==="pending").sort((a,i)=>{const e={urgent:4,high:3,normal:2,low:1},r=e[a.priority]||0,f=e[i.priority]||0;return r!==f?f-r:new Date(a.created_at).getTime()-new Date(i.created_at).getTime()})),A=O(()=>m.value.filter(a=>a.status==="processing")),E=a=>{switch(a){case"urgent":return"destructive";case"high":return"secondary";case"normal":return"outline";case"low":return"secondary";default:return"outline"}},I=a=>new Date(a).toLocaleTimeString(),S=async()=>{M.value=!0;try{const[a,i,e]=await Promise.all([fetch("/api/print-jobs/pending"),fetch("/api/print-jobs/history?limit=10"),fetch("/api/print-jobs/statistics")]);a.ok&&(m.value=await a.json()),i.ok&&(J.value=await i.json()),e.ok&&(P.value=await e.json())}catch(a){console.error("Failed to refresh jobs:",a)}finally{M.value=!1}},X=async a=>{var i;if(g.value.length===0){alert("No printers available. Please click the refresh button to load printers.");return}if(!p.value){const e=g.value.find(r=>r.toLowerCase().includes("zdesigner"));if(e)p.value=e,console.log("PrintStation: Auto-selected ZDesigner printer for printing:",e);else if(g.value.length>0)p.value=g.value[0],console.log("PrintStation: Auto-selected first available printer for printing:",g.value[0]);else{alert("Please select a printer first");return}}try{if((await fetch(`/api/print-jobs/${a.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||""},body:JSON.stringify({status:"processing",print_station_id:"MANUAL_STATION_"+Date.now(),printer_name:p.value})})).ok){const r=m.value.findIndex(f=>f.id===a.id);r!==-1&&(m.value[r].status="processing"),await q(a)}}catch(e){console.error("Failed to process print job:",e),alert("Failed to process print job: "+e)}},q=async a=>{try{console.log(`PrintStation: Printing label for asset ${a.asset.asset_tag} on printer ${p.value}`),await $.printAssetLabel(a.asset,!1,p.value),console.log(`PrintStation: Successfully printed label for asset ${a.asset.asset_tag}`)}catch(i){throw console.error("PrintStation: Failed to print label:",i),i}},W=async a=>{var i;try{(await fetch(`/api/print-jobs/${a.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||""},body:JSON.stringify({status:"completed"})})).ok&&(m.value=m.value.filter(r=>r.id!==a.id),P.value.completed_today++,S())}catch(e){console.error("Failed to complete print job:",e)}},B=async a=>{var i;try{(await fetch(`/api/print-jobs/${a.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||""},body:JSON.stringify({status:"failed",error_message:"Print job failed"})})).ok&&(m.value=m.value.filter(r=>r.id!==a.id),P.value.failed_today++,S())}catch(e){console.error("Failed to fail print job:",e)}},V=async a=>{var i;try{(await fetch(`/api/print-jobs/${a.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||""}})).ok&&(m.value=m.value.filter(r=>r.id!==a.id))}catch(e){console.error("Failed to cancel print job:",e)}},D=async(a=3,i=2e3)=>{b.value=!0,g.value=[];for(let e=1;e<=a;e++)try{console.log(`PrintStation: Loading printers attempt ${e}/${a}...`),e>1&&await new Promise(f=>setTimeout(f,i)),await $.initializeJSPrintManager();const r=await $.getAvailablePrinters();if(console.log(`PrintStation: Attempt ${e}: Found ${r.length} printers:`,r),r&&r.length>0){if(g.value=r,!p.value){const f=r.find(K=>K.toLowerCase().includes("zdesigner"));f?(p.value=f,console.log("PrintStation: Auto-selected ZDesigner printer:",f)):r.length>0&&(p.value=r[0],console.log("PrintStation: Auto-selected first available printer:",r[0]))}console.log("PrintStation: Printer loading successful!"),b.value=!1;return}else e<a?console.log(`PrintStation: Attempt ${e}: No printers found, retrying...`):console.log("PrintStation: No printers found after all attempts")}catch(r){console.error(`PrintStation: Printer loading attempt ${e} failed:`,r),e<a?console.log(`PrintStation: Retrying in ${i/1e3} seconds... (${e}/${a})`):(console.error("PrintStation: Failed to load printers after all attempts:",r),e===a&&console.error("PrintStation: JSPrintManager connection failed. Please ensure JSPrintManager is installed and running."))}b.value=!1},R=()=>{var a,i,e,r;console.log("=== PrintStation JSPrintManager Debug ==="),console.log("Window object:",typeof window),console.log("window.JSPM:",window.JSPM),console.log("window.JSPM.JSPrintManager:",(a=window.JSPM)==null?void 0:a.JSPrintManager),console.log("Available printers:",g.value),console.log("Selected printer:",p.value),console.log("Loading printers:",b.value),typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager?(console.log("JSPrintManager websocket status:",window.JSPM.JSPrintManager.websocket_status),console.log("WSStatus.Open:",(i=window.JSPM.WSStatus)==null?void 0:i.Open),console.log("WSStatus.Closed:",(e=window.JSPM.WSStatus)==null?void 0:e.Closed),console.log("WSStatus.Blocked:",(r=window.JSPM.WSStatus)==null?void 0:r.Blocked),alert("JSPrintManager is available! Check console for details.")):alert(`JSPrintManager is NOT available!

Please check:
1. JSPrintManager is installed
2. JSPrintManager service is running
3. Scripts are loaded properly`)};return U(()=>{S(),setTimeout(()=>{D()},2e3),setInterval(S,1e4)}),(a,i)=>(c(),Z(ee,null,{header:l(()=>[t("div",se,[t("div",null,[t("h2",ne,o(n(_)("print_station.title")),1),t("p",ae,o(n(_)("print_station.description")),1)]),t("div",oe,[t("div",ie,[s(u,{name:"Printer",class:"h-4 w-4 text-gray-500"}),Q(t("select",{"onUpdate:modelValue":i[0]||(i[0]=e=>p.value=e),class:"text-sm border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1 bg-white dark:bg-gray-800"},[t("option",re,o(b.value?"Loading printers...":"Select Printer"),1),(c(!0),d(k,null,C(g.value,e=>(c(),d("option",{key:e,value:e},o(e),9,le))),128))],512),[[Y,p.value]]),s(n(y),{size:"sm",variant:"outline",onClick:D,disabled:b.value},{default:l(()=>[s(u,{name:"RefreshCw",class:"h-3 w-3"})]),_:1},8,["disabled"]),s(n(y),{size:"sm",variant:"outline",onClick:R},{default:l(()=>i[1]||(i[1]=[h(" Debug ")])),_:1,__:[1]})]),s(n(y),{onClick:S,disabled:M.value},{default:l(()=>[s(u,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),h(" "+o(n(_)("print_station.refresh")),1)]),_:1},8,["disabled"])])])]),default:l(()=>[t("div",ce,[t("div",de,[t("div",ue,[s(n(x),null,{default:l(()=>[s(n(w),{class:"p-6"},{default:l(()=>[t("div",_e,[t("div",pe,[t("div",me,[s(u,{name:"Clock",class:"h-5 w-5"})])]),t("div",fe,[t("dt",ge,o(n(_)("print_station.pending_jobs")),1),t("dd",he,o(T.value.length),1)])])]),_:1})]),_:1}),s(n(x),null,{default:l(()=>[s(n(w),{class:"p-6"},{default:l(()=>[t("div",ve,[t("div",ye,[t("div",xe,[s(u,{name:"Printer",class:"h-5 w-5"})])]),t("div",we,[t("dt",be,o(n(_)("print_station.processing_jobs")),1),t("dd",Pe,o(A.value.length),1)])])]),_:1})]),_:1}),s(n(x),null,{default:l(()=>[s(n(w),{class:"p-6"},{default:l(()=>[t("div",Se,[t("div",ke,[t("div",Ce,[s(u,{name:"CheckCircle",class:"h-5 w-5"})])]),t("div",Je,[t("dt",Me,o(n(_)("print_station.completed_today")),1),t("dd",$e,o(P.value.completed_today||0),1)])])]),_:1})]),_:1}),s(n(x),null,{default:l(()=>[s(n(w),{class:"p-6"},{default:l(()=>[t("div",Te,[t("div",Ae,[t("div",Ne,[s(u,{name:"XCircle",class:"h-5 w-5"})])]),t("div",Fe,[t("dt",ze,o(n(_)("print_station.failed_today")),1),t("dd",De,o(P.value.failed_today||0),1)])])]),_:1})]),_:1})]),t("div",Oe,[s(n(x),null,{default:l(()=>[s(n(N),null,{default:l(()=>[s(n(F),{class:"flex items-center gap-2"},{default:l(()=>[s(u,{name:"Clock",class:"h-5 w-5 text-yellow-600"}),h(" "+o(n(_)("print_station.pending_queue")),1)]),_:1})]),_:1}),s(n(w),null,{default:l(()=>[T.value.length===0?(c(),d("div",Le,[s(u,{name:"Inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",Ee,o(n(_)("print_station.no_pending_jobs")),1)])):(c(),d("div",Ie,[(c(!0),d(k,null,C(T.value,e=>(c(),d("div",{key:e.id,class:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800"},[t("div",Xe,[t("div",qe,[t("div",We,[s(n(z),{variant:E(e.priority)},{default:l(()=>[h(o(e.priority),1)]),_:2},1032,["variant"]),t("span",Be,o(e.job_id),1)]),t("div",Ve,[t("p",Re,o(e.asset.asset_tag),1),t("p",Ke,o(e.asset.model_name)+" - "+o(e.company.name),1),t("p",je,o(n(_)("print_station.requested_by"))+" "+o(e.user.name),1),e.comment?(c(),d("p",He," ðŸ’¬ "+o(e.comment),1)):L("",!0)])]),t("div",Ue,[s(n(y),{size:"sm",onClick:r=>X(e)},{default:l(()=>[s(u,{name:"Play",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(n(y),{size:"sm",variant:"outline",onClick:r=>V(e)},{default:l(()=>[s(u,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1}),s(n(x),null,{default:l(()=>[s(n(N),null,{default:l(()=>[s(n(F),{class:"flex items-center gap-2"},{default:l(()=>[s(u,{name:"Printer",class:"h-5 w-5 text-blue-600"}),h(" "+o(n(_)("print_station.processing_queue")),1)]),_:1})]),_:1}),s(n(w),null,{default:l(()=>[A.value.length===0?(c(),d("div",Ze,[s(u,{name:"Printer",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",Ge,o(n(_)("print_station.no_processing_jobs")),1)])):(c(),d("div",Qe,[(c(!0),d(k,null,C(A.value,e=>(c(),d("div",{key:e.id,class:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800"},[t("div",Ye,[t("div",et,[t("div",tt,[s(n(z),{variant:"secondary"},{default:l(()=>[h(o(e.priority),1)]),_:2},1024),t("span",st,o(e.job_id),1)]),t("div",nt,[t("p",at,o(e.asset.asset_tag),1),t("p",ot,o(e.asset.model_name)+" - "+o(e.company.name),1),t("div",it,[i[2]||(i[2]=t("div",{class:"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full"},null,-1)),t("span",rt,o(n(_)("print_station.printing")),1)]),e.comment?(c(),d("p",lt," ðŸ’¬ "+o(e.comment),1)):L("",!0)])]),t("div",ct,[s(n(y),{size:"sm",variant:"outline",onClick:r=>W(e)},{default:l(()=>[s(u,{name:"Check",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(n(y),{size:"sm",variant:"destructive",onClick:r=>B(e)},{default:l(()=>[s(u,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1})]),t("div",dt,[s(n(x),null,{default:l(()=>[s(n(N),null,{default:l(()=>[s(n(F),null,{default:l(()=>[h(o(n(_)("print_station.recent_activity")),1)]),_:1})]),_:1}),s(n(w),null,{default:l(()=>[J.value.length===0?(c(),d("div",ut,[t("p",_t,o(n(_)("print_station.no_recent_activity")),1)])):(c(),d("div",pt,[(c(!0),d(k,null,C(J.value,e=>(c(),d("div",{key:e.id,class:"flex items-center justify-between p-2 rounded border"},[t("div",mt,[s(u,{name:e.status==="completed"?"CheckCircle":"XCircle",class:G([e.status==="completed"?"text-green-600":"text-red-600","h-4 w-4"])},null,8,["name","class"]),t("span",ft,o(e.asset.asset_tag),1),s(n(z),{variant:e.status==="completed"?"default":"destructive",size:"sm"},{default:l(()=>[h(o(e.status),1)]),_:2},1032,["variant"])]),t("span",gt,o(I(e.completed_at||e.updated_at)),1)]))),128))]))]),_:1})]),_:1})])])])]),_:1}))}});export{Rt as default};
