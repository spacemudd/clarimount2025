import{d as H,u as G,q as y,c as E,E as U,i as Q,o as u,w as r,f as t,t as i,e as a,b as s,p as Y,a as _,m as F,F as J,r as M,v as ee,g as w,n as te}from"./app-CHIjDZuZ.js";import{_ as se}from"./AppLayout.vue_vue_type_script_setup_true_lang-6s3i2-Li.js";import{_ as x}from"./index-BI5lX1Qb.js";import{_ as P,a as S}from"./CardContent.vue_vue_type_script_setup_true_lang-DlOkVb1m.js";import{_ as z,a as N}from"./CardTitle.vue_vue_type_script_setup_true_lang-DXsNoMDC.js";import{_ as L}from"./Badge.vue_vue_type_script_setup_true_lang-CRn8JKss.js";import{_ as g}from"./Icon.vue_vue_type_script_setup_true_lang-BJJ5fV1_.js";import{P as ne}from"./PrintService-Il55q5dY.js";import"./useForwardExpose-BwM4eZOZ.js";import"./x-BaaE6kpm.js";import"./building-C1-G0n3X.js";import"./users-DkzFubVR.js";import"./activity-B11j2qvV.js";import"./arrow-left-BC6c0Typ.js";import"./calendar-BPdmiXCZ.js";import"./chevron-down-B-Pvo_2T.js";import"./search-DFV3jbWM.js";import"./eye-kM4RYPQj.js";import"./user-Ba_S_03D.js";import"./loader-circle-BlLlK2RK.js";import"./sun-Bc_YScej.js";import"./play-hDMb51pb.js";import"./plus-Ba8neW1X.js";import"./square-pen-C-pva_bz.js";import"./trash-2-hWt_95z4.js";import"./triangle-alert-B2Tql2sf.js";const ae={class:"space-y-6"},oe={class:"flex items-center justify-between my-2"},ie={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},re={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},le={class:"flex items-center gap-4"},ce={class:"flex items-center gap-2"},de={class:"flex flex-col"},ue=["disabled"],_e={value:""},ge=["value"],pe={key:0,class:"text-xs text-gray-500 mt-1"},me={class:"mx-auto max-w-7xl px-6 lg:px-8"},fe={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},ve={class:"flex items-center"},he={class:"flex-shrink-0"},ye={class:"flex h-8 w-8 items-center justify-center rounded-md bg-yellow-100 text-yellow-600"},we={class:"ml-4"},xe={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Pe={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Se={class:"flex items-center"},be={class:"flex-shrink-0"},ke={class:"flex h-8 w-8 items-center justify-center rounded-md bg-blue-100 text-blue-600"},Je={class:"ml-4"},Me={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Ce={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},$e={class:"flex items-center"},Ae={class:"flex-shrink-0"},De={class:"flex h-8 w-8 items-center justify-center rounded-md bg-green-100 text-green-600"},Te={class:"ml-4"},Fe={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},ze={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Ne={class:"flex items-center"},Le={class:"flex-shrink-0"},qe={class:"flex h-8 w-8 items-center justify-center rounded-md bg-red-100 text-red-600"},Ee={class:"ml-4"},Oe={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Ie={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Re={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},We={key:0,class:"text-center py-8"},Xe={class:"text-gray-500"},Be={key:1,class:"space-y-4"},Ve={class:"flex items-center justify-between"},je={class:"flex-1"},Ke={class:"flex items-center gap-2"},Ze={class:"text-sm font-medium"},He={class:"mt-2"},Ge={class:"font-semibold"},Ue={class:"text-sm text-gray-600 dark:text-gray-400"},Qe={class:"text-xs text-gray-500 dark:text-gray-500"},Ye={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},et={class:"flex gap-2"},tt={key:0,class:"text-center py-8"},st={class:"text-gray-500"},nt={key:1,class:"space-y-4"},at={class:"flex items-center justify-between"},ot={class:"flex-1"},it={class:"flex items-center gap-2"},rt={class:"text-sm font-medium"},lt={class:"mt-2"},ct={class:"font-semibold"},dt={class:"text-sm text-gray-600 dark:text-gray-400"},ut={class:"flex items-center gap-2 mt-1"},_t={class:"text-xs text-blue-600"},gt={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},pt={class:"flex gap-2"},mt={class:"mt-6"},ft={key:0,class:"text-center py-4"},vt={class:"text-gray-500"},ht={key:1,class:"space-y-2"},yt={class:"flex items-center gap-3"},wt={class:"font-medium"},xt={class:"text-sm text-gray-500"},Ht=H({__name:"Index",setup(Pt){const{t:p}=G(),v=y([]),C=y([]),b=y({pending:0,processing:0,completed_today:0,failed_today:0}),$=y(!1),h=y(!1),m=y("Initializing..."),d=y(""),f=y([]),O=ne.getInstance(),A=E(()=>v.value.filter(o=>o.status==="pending").sort((o,n)=>{const e={urgent:4,high:3,normal:2,low:1},l=e[o.priority]||0,c=e[n.priority]||0;return l!==c?c-l:new Date(o.created_at).getTime()-new Date(n.created_at).getTime()})),D=E(()=>v.value.filter(o=>o.status==="processing")),I=o=>{switch(o){case"urgent":return"destructive";case"high":return"secondary";case"normal":return"outline";case"low":return"secondary";default:return"outline"}},R=o=>new Date(o).toLocaleTimeString(),k=async()=>{$.value=!0;try{const[o,n,e]=await Promise.all([fetch("/api/print-jobs/pending"),fetch("/api/print-jobs/history?limit=10"),fetch("/api/print-jobs/statistics")]);o.ok&&(v.value=await o.json()),n.ok&&(C.value=await n.json()),e.ok&&(b.value=await e.json())}catch(o){console.error("Failed to refresh jobs:",o)}finally{$.value=!1}},W=async o=>{var n;if(f.value.length===0){alert("No printers available. Please click the refresh button to load printers.");return}if(!d.value){const e=f.value.find(l=>l.toLowerCase().includes("zdesigner"));if(e)d.value=e,console.log("PrintStation: Auto-selected ZDesigner printer for printing:",e);else if(f.value.length>0)d.value=f.value[0],console.log("PrintStation: Auto-selected first available printer for printing:",f.value[0]);else{alert("Please select a printer first");return}}try{if((await fetch(`/api/print-jobs/${o.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||""},body:JSON.stringify({status:"processing",print_station_id:"MANUAL_STATION_"+Date.now(),printer_name:d.value})})).ok){const l=v.value.findIndex(c=>c.id===o.id);l!==-1&&(v.value[l].status="processing"),await X(o)}}catch(e){console.error("Failed to process print job:",e),alert("Failed to process print job: "+e)}},X=async o=>{try{console.log(`PrintStation: Printing label for asset ${o.asset.asset_tag} on printer ${d.value}`),await O.printAssetLabel(o.asset,!1,d.value),console.log(`PrintStation: Successfully printed label for asset ${o.asset.asset_tag}`)}catch(n){throw console.error("PrintStation: Failed to print label:",n),n}},B=async o=>{var n;try{(await fetch(`/api/print-jobs/${o.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||""},body:JSON.stringify({status:"completed"})})).ok&&(v.value=v.value.filter(l=>l.id!==o.id),b.value.completed_today++,k())}catch(e){console.error("Failed to complete print job:",e)}},V=async o=>{var n;try{(await fetch(`/api/print-jobs/${o.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||""},body:JSON.stringify({status:"failed",error_message:"Print job failed"})})).ok&&(v.value=v.value.filter(l=>l.id!==o.id),b.value.failed_today++,k())}catch(e){console.error("Failed to fail print job:",e)}},j=async o=>{var n;try{(await fetch(`/api/print-jobs/${o.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||""}})).ok&&(v.value=v.value.filter(l=>l.id!==o.id))}catch(e){console.error("Failed to cancel print job:",e)}},q=async()=>{h.value=!0,f.value=[],m.value="Connecting to JSPrintManager...";try{if(console.log("PrintStation: Starting simple printer loading..."),!window.JSPM||!window.JSPM.JSPrintManager)throw new Error("JSPrintManager not available in window object");m.value="JSPrintManager found, checking connection...";const o=window.JSPM.JSPrintManager.websocket_status;if(console.log("PrintStation: WebSocket status:",o),o===0){m.value="Connected! Getting printers...";const n=await window.JSPM.JSPrintManager.getPrinters();if(console.log("PrintStation: Direct query found printers:",n),n&&n.length>0){if(f.value=n,m.value=`Found ${n.length} printer(s)`,!d.value){const e=n.find(l=>l.toLowerCase().includes("zdesigner"));e?(d.value=e,console.log("PrintStation: Auto-selected ZDesigner printer:",e)):n.length>0&&(d.value=n[0],console.log("PrintStation: Auto-selected first printer:",n[0]))}}else m.value="Connected but no printers found"}else{m.value="Connecting...",console.log("PrintStation: Need to connect, status:",o),window.JSPM.JSPrintManager.auto_reconnect=!0,window.JSPM.JSPrintManager.start(),await new Promise(e=>setTimeout(e,2e3));const n=window.JSPM.JSPrintManager.websocket_status;if(console.log("PrintStation: After start(), new status:",n),n===0){m.value="Connected! Getting printers...";const e=await window.JSPM.JSPrintManager.getPrinters();if(console.log("PrintStation: After connection, found printers:",e),e&&e.length>0){if(f.value=e,m.value=`Found ${e.length} printer(s)`,!d.value){const l=e.find(c=>c.toLowerCase().includes("zdesigner"));l?(d.value=l,console.log("PrintStation: Auto-selected ZDesigner printer:",l)):e.length>0&&(d.value=e[0],console.log("PrintStation: Auto-selected first printer:",e[0]))}}else m.value="Connected but no printers found"}else throw new Error(`Failed to connect to JSPrintManager. Status: ${n}`)}}catch(o){console.error("PrintStation: Simple printer loading failed:",o),m.value="Failed to load printers"}finally{h.value=!1,console.log("PrintStation: Loading complete. Final state:"),console.log("- availablePrinters:",f.value),console.log("- selectedPrinter:",d.value),console.log("- loadingPrinters:",h.value)}},K=async()=>{var o,n,e,l;if(console.log("=== PrintStation JSPrintManager Debug ==="),console.log("Window object:",typeof window),console.log("window.JSPM:",window.JSPM),console.log("window.JSPM.JSPrintManager:",(o=window.JSPM)==null?void 0:o.JSPrintManager),console.log("Available printers:",f.value),console.log("Selected printer:",d.value),console.log("Loading printers:",h.value),console.log("Printer status:",m.value),typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager)if(console.log("JSPrintManager websocket status:",window.JSPM.JSPrintManager.websocket_status),console.log("WSStatus.Open:",(n=window.JSPM.WSStatus)==null?void 0:n.Open),console.log("WSStatus.Closed:",(e=window.JSPM.WSStatus)==null?void 0:e.Closed),console.log("WSStatus.Blocked:",(l=window.JSPM.WSStatus)==null?void 0:l.Blocked),window.JSPM.JSPrintManager.websocket_status===0){console.log("JSPrintManager is connected! Trying to get printers directly...");try{const c=await window.JSPM.JSPrintManager.getPrinters();if(console.log("Direct printer query result:",c),c&&c.length>0){if(f.value=c,h.value=!1,m.value=`Direct query: Found ${c.length} printer(s)`,!d.value){const T=c.find(Z=>Z.toLowerCase().includes("zdesigner"));T?(d.value=T,console.log("Debug: Auto-selected ZDesigner printer:",T)):c.length>0&&(d.value=c[0],console.log("Debug: Auto-selected first available printer:",c[0]))}alert(`JSPrintManager is connected and working!
Found ${c.length} printers.
Check console for details.`)}else alert(`JSPrintManager is connected but no printers found.
Check console for details.`)}catch(c){console.error("Direct printer query failed:",c),alert(`JSPrintManager is connected but failed to get printers.
Error: `+c)}}else alert(`JSPrintManager is available but not connected!
WebSocket status: `+window.JSPM.JSPrintManager.websocket_status);else alert(`JSPrintManager is NOT available!

Please check:
1. JSPrintManager is installed
2. JSPrintManager service is running
3. Scripts are loaded properly`)};return U(()=>{k(),setTimeout(()=>{q()},3e3),setInterval(k,1e4)}),(o,n)=>(u(),Q(se,null,{default:r(()=>[t("div",ae,[t("div",oe,[t("div",null,[t("h2",ie,i(a(p)("print_station.title")),1),t("p",re,i(a(p)("print_station.description")),1)]),t("div",le,[t("div",ce,[s(g,{name:"Printer",class:"h-4 w-4 text-gray-500"}),t("div",de,[Y(t("select",{"onUpdate:modelValue":n[0]||(n[0]=e=>d.value=e),class:"text-sm border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1 bg-white dark:bg-gray-800",disabled:h.value},[t("option",_e,i(h.value?"Loading printers...":f.value.length===0?"No printers found":"Select Printer"),1),(u(!0),_(J,null,M(f.value,e=>(u(),_("option",{key:e,value:e},i(e),9,ge))),128))],8,ue),[[ee,d.value]]),h.value||m.value!=="Initializing..."?(u(),_("span",pe,i(m.value),1)):F("",!0)]),s(a(x),{size:"sm",variant:"outline",onClick:q,disabled:h.value},{default:r(()=>[s(g,{name:"RefreshCw",class:"h-3 w-3"})]),_:1},8,["disabled"]),s(a(x),{size:"sm",variant:"outline",onClick:K},{default:r(()=>n[1]||(n[1]=[w(" Debug ",-1)])),_:1,__:[1]})]),s(a(x),{onClick:k,disabled:$.value},{default:r(()=>[s(g,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),w(" "+i(a(p)("print_station.refresh")),1)]),_:1},8,["disabled"])])]),t("div",me,[t("div",fe,[s(a(P),null,{default:r(()=>[s(a(S),{class:"p-6"},{default:r(()=>[t("div",ve,[t("div",he,[t("div",ye,[s(g,{name:"Clock",class:"h-5 w-5"})])]),t("div",we,[t("dt",xe,i(a(p)("print_station.pending_jobs")),1),t("dd",Pe,i(A.value.length),1)])])]),_:1})]),_:1}),s(a(P),null,{default:r(()=>[s(a(S),{class:"p-6"},{default:r(()=>[t("div",Se,[t("div",be,[t("div",ke,[s(g,{name:"Printer",class:"h-5 w-5"})])]),t("div",Je,[t("dt",Me,i(a(p)("print_station.processing_jobs")),1),t("dd",Ce,i(D.value.length),1)])])]),_:1})]),_:1}),s(a(P),null,{default:r(()=>[s(a(S),{class:"p-6"},{default:r(()=>[t("div",$e,[t("div",Ae,[t("div",De,[s(g,{name:"CheckCircle",class:"h-5 w-5"})])]),t("div",Te,[t("dt",Fe,i(a(p)("print_station.completed_today")),1),t("dd",ze,i(b.value.completed_today||0),1)])])]),_:1})]),_:1}),s(a(P),null,{default:r(()=>[s(a(S),{class:"p-6"},{default:r(()=>[t("div",Ne,[t("div",Le,[t("div",qe,[s(g,{name:"XCircle",class:"h-5 w-5"})])]),t("div",Ee,[t("dt",Oe,i(a(p)("print_station.failed_today")),1),t("dd",Ie,i(b.value.failed_today||0),1)])])]),_:1})]),_:1})]),t("div",Re,[s(a(P),null,{default:r(()=>[s(a(z),null,{default:r(()=>[s(a(N),{class:"flex items-center gap-2"},{default:r(()=>[s(g,{name:"Clock",class:"h-5 w-5 text-yellow-600"}),w(" "+i(a(p)("print_station.pending_queue")),1)]),_:1})]),_:1}),s(a(S),null,{default:r(()=>[A.value.length===0?(u(),_("div",We,[s(g,{name:"Inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",Xe,i(a(p)("print_station.no_pending_jobs")),1)])):(u(),_("div",Be,[(u(!0),_(J,null,M(A.value,e=>(u(),_("div",{key:e.id,class:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800"},[t("div",Ve,[t("div",je,[t("div",Ke,[s(a(L),{variant:I(e.priority)},{default:r(()=>[w(i(e.priority),1)]),_:2},1032,["variant"]),t("span",Ze,i(e.job_id),1)]),t("div",He,[t("p",Ge,i(e.asset.asset_tag),1),t("p",Ue,i(e.asset.model_name)+" - "+i(e.company.name),1),t("p",Qe,i(a(p)("print_station.requested_by"))+" "+i(e.user.name),1),e.comment?(u(),_("p",Ye," ðŸ’¬ "+i(e.comment),1)):F("",!0)])]),t("div",et,[s(a(x),{size:"sm",onClick:l=>W(e)},{default:r(()=>[s(g,{name:"Play",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(a(x),{size:"sm",variant:"outline",onClick:l=>j(e)},{default:r(()=>[s(g,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1}),s(a(P),null,{default:r(()=>[s(a(z),null,{default:r(()=>[s(a(N),{class:"flex items-center gap-2"},{default:r(()=>[s(g,{name:"Printer",class:"h-5 w-5 text-blue-600"}),w(" "+i(a(p)("print_station.processing_queue")),1)]),_:1})]),_:1}),s(a(S),null,{default:r(()=>[D.value.length===0?(u(),_("div",tt,[s(g,{name:"Printer",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",st,i(a(p)("print_station.no_processing_jobs")),1)])):(u(),_("div",nt,[(u(!0),_(J,null,M(D.value,e=>(u(),_("div",{key:e.id,class:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800"},[t("div",at,[t("div",ot,[t("div",it,[s(a(L),{variant:"secondary"},{default:r(()=>[w(i(e.priority),1)]),_:2},1024),t("span",rt,i(e.job_id),1)]),t("div",lt,[t("p",ct,i(e.asset.asset_tag),1),t("p",dt,i(e.asset.model_name)+" - "+i(e.company.name),1),t("div",ut,[n[2]||(n[2]=t("div",{class:"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full"},null,-1)),t("span",_t,i(a(p)("print_station.printing")),1)]),e.comment?(u(),_("p",gt," ðŸ’¬ "+i(e.comment),1)):F("",!0)])]),t("div",pt,[s(a(x),{size:"sm",variant:"outline",onClick:l=>B(e)},{default:r(()=>[s(g,{name:"Check",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(a(x),{size:"sm",variant:"destructive",onClick:l=>V(e)},{default:r(()=>[s(g,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1})]),t("div",mt,[s(a(P),null,{default:r(()=>[s(a(z),null,{default:r(()=>[s(a(N),null,{default:r(()=>[w(i(a(p)("print_station.recent_activity")),1)]),_:1})]),_:1}),s(a(S),null,{default:r(()=>[C.value.length===0?(u(),_("div",ft,[t("p",vt,i(a(p)("print_station.no_recent_activity")),1)])):(u(),_("div",ht,[(u(!0),_(J,null,M(C.value,e=>(u(),_("div",{key:e.id,class:"flex items-center justify-between p-2 rounded border"},[t("div",yt,[s(g,{name:e.status==="completed"?"CheckCircle":"XCircle",class:te([e.status==="completed"?"text-green-600":"text-red-600","h-4 w-4"])},null,8,["name","class"]),t("span",wt,i(e.asset.asset_tag),1),s(a(L),{variant:e.status==="completed"?"default":"destructive",size:"sm"},{default:r(()=>[w(i(e.status),1)]),_:2},1032,["variant"])]),t("span",xt,i(R(e.completed_at||e.updated_at)),1)]))),128))]))]),_:1})]),_:1})])])])]),_:1}))}});export{Ht as default};
