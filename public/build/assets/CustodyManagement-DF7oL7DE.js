import{d as _e,u as fe,q as h,c as O,D as pe,i as S,o as i,w as a,f as o,b as t,m as x,a as p,e,n as q,g as r,t as n,s as ye,F as A,r as j,p as ve,z as ge,y as W}from"./app-BXrKzvLN.js";import{g as he,_ as be}from"./AppLayout.vue_vue_type_script_setup_true_lang-DaRJsVNh.js";import{_ as f}from"./index-oTuGssnE.js";import{_ as Q}from"./Input.vue_vue_type_script_setup_true_lang-BCuFgQ0l.js";import{_ as E}from"./Badge.vue_vue_type_script_setup_true_lang-DtLBwGLQ.js";import{_ as D,a as z}from"./CardContent.vue_vue_type_script_setup_true_lang-DyKY7wJi.js";import{_ as T,a as U}from"./CardTitle.vue_vue_type_script_setup_true_lang-BneLXc-Y.js";import{_ as G,a as Y,b as Z,c as ee,d as te}from"./DialogTitle.vue_vue_type_script_setup_true_lang-B7efu8EJ.js";import{_ as xe}from"./Checkbox.vue_vue_type_script_setup_true_lang-DZnvx0io.js";import{_ as se}from"./Label.vue_vue_type_script_setup_true_lang-jpk8-4yg.js";import{_ as m}from"./Icon.vue_vue_type_script_setup_true_lang-DKJKdV5h.js";import{_ as we}from"./Heading.vue_vue_type_script_setup_true_lang-BCLZswfi.js";import"./useForwardExpose-W9iILB0G.js";import"./x-DhIxxX5O.js";import"./building-BI7hMlkJ.js";import"./users-M0XHIFGR.js";import"./activity-D_PrRM_H.js";import"./arrow-left-DynVa_2p.js";import"./calendar-BpDQPph8.js";import"./chevron-down-DFMuuyMl.js";import"./search-DvMXvNs3.js";import"./eye-BULOlcPe.js";import"./user-DnEz3ToP.js";import"./loader-circle-BP0asllC.js";import"./sun-leX6A77Z.js";import"./play-BwtsLJW2.js";import"./plus-DNlw4JNr.js";import"./square-pen-BfuBYkiM.js";import"./trash-2-ejZ3laI_.js";import"./triangle-alert-XsXEVLRv.js";const ke={class:"container mx-auto py-8"},Ce={class:"space-y-6"},$e={class:"space-y-2"},Se={class:"flex items-center justify-between"},Ae={class:"space-y-1"},je={class:"flex items-center gap-2"},De={class:"text-sm font-mono text-muted-foreground"},ze={class:"flex gap-2"},Te={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Ue={class:"space-y-3"},Fe={class:"flex items-center gap-3"},Ne={class:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center"},Pe={class:"font-medium"},Ee={class:"text-sm text-muted-foreground"},Be={class:"text-xs text-muted-foreground"},Le={key:0,class:"text-center py-8 text-muted-foreground"},Oe={class:"space-y-3"},Re={class:"flex items-center gap-3"},Ve={class:"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center"},qe={class:"font-medium"},Ie={class:"text-sm text-muted-foreground"},Me={class:"text-xs text-muted-foreground"},Xe=["placeholder"],He={key:1,class:"flex justify-end gap-4"},Je={class:"space-y-3"},Ke={class:"font-medium"},We={class:"text-sm text-muted-foreground"},Qe={class:"flex items-center gap-2"},Ge={class:"text-sm text-muted-foreground"},Ye={class:"space-y-3"},Ze={class:"flex-1"},et={class:"font-medium"},tt={class:"text-sm text-muted-foreground"},st={class:"text-xs text-amber-600 mt-1"},at={class:"flex items-center gap-2"},ot={class:"space-y-3"},lt={class:"font-medium"},nt={class:"text-sm text-muted-foreground"},dt={class:"flex items-center gap-2"},ut={class:"space-y-4"},rt={class:"max-h-96 overflow-y-auto"},ct={class:"space-y-2"},it=["onClick"],mt={class:"flex items-center gap-3"},_t={class:"h-8 w-8 rounded-full bg-gray-100 flex items-center justify-center"},ft={class:"font-medium"},pt={class:"text-sm text-muted-foreground"},yt={class:"text-xs text-muted-foreground"},vt={key:0,class:"text-center py-8 text-muted-foreground"},gt={class:"space-y-4"},ht={class:"text-sm text-muted-foreground mt-1"},bt={key:0,class:"p-3 bg-gray-50 rounded-lg"},xt={class:"font-medium"},wt={class:"text-sm text-muted-foreground"},Zt=_e({__name:"CustodyManagement",props:{employee:{},currentAssets:{},availableAssets:{},recentCustodyChanges:{}},setup(ae){const{t:l}=fe(),y=ae,v=h(!1),g=h([...y.currentAssets]),B=h(""),F=h(!1),$=h(""),w=h([...y.availableAssets]),k=h(new Set),N=h(!1),C=h(null),P=h(null),oe=O(()=>[{title:l("nav.dashboard"),href:"/dashboard"},{title:l("employees.title"),href:"/employees"},{title:y.employee.full_name||"Employee",href:`/employees/${y.employee.id}`},{title:l("custody.update_custody"),href:`/employees/${y.employee.id}/custody`}]),R=O(()=>{const d=new Set(y.currentAssets.map(s=>s.id)),u=new Set(g.value.map(s=>s.id));if(d.size!==u.size)return!0;for(const s of d)if(!u.has(s))return!0;return!1}),I=O(()=>y.recentCustodyChanges.filter(d=>d.status==="pending"&&!d.document_path)),M=O(()=>y.recentCustodyChanges.filter(d=>d.status!=="pending"||d.document_path)),X=d=>{switch(d){case"active":return"bg-green-100 text-green-800";case"inactive":return"bg-yellow-100 text-yellow-800";case"terminated":return"bg-red-100 text-red-800";case"pending":return"bg-amber-100 text-amber-800";case"signed":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},le=d=>{g.value=g.value.filter(u=>u.id!==d.id)},ne=d=>{g.value=g.value.filter(u=>u.id!==d.id)},de=()=>{g.value=[...y.currentAssets],B.value=""},ue=d=>{const u=d.target;u.files&&u.files.length>0&&(P.value=u.files[0])},re=async()=>{if($.value.length<2){w.value=y.availableAssets;return}try{const u=await(await fetch(`/api/custody/available-assets?search=${encodeURIComponent($.value)}`)).json();w.value=u}catch(d){console.error("Asset search failed:",d),w.value=[]}},H=d=>{k.value.has(d.id)?k.value.delete(d.id):k.value.add(d.id)},ce=()=>{w.value.filter(u=>k.value.has(u.id)).forEach(u=>{g.value.find(s=>s.id===u.id)||g.value.push(u)}),k.value.clear(),F.value=!1,$.value="",w.value=y.availableAssets},ie=async()=>{var d;if(!R.value){alert(l("custody.no_changes_to_save"));return}v.value=!0;try{const u=(d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.content,s=route("employees.custody.store",y.employee.id),c={new_asset_ids:g.value.map(b=>b.id),changes_summary:B.value||""},_=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":u||"","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(c)});console.log("Response status:",_.status),console.log("Response headers:",Object.fromEntries(_.headers.entries()));const L=_.headers.get("content-type");if(!L||!L.includes("application/json")){const b=await _.text();console.error("Non-JSON response received:",b),alert("Server returned non-JSON response. Check browser console for details.");return}if(_.ok){const b=await _.json();console.log("Success result:",b),alert(l("custody.custody_updated_successfully")),W.visit(route("employees.show",y.employee.id))}else{const b=await _.json();console.error("Server error:",b),alert(l("custody.failed_to_update_custody")+": "+(b.error||b.message||l("custody.unknown_error")))}}catch(u){console.error("Error updating custody:",u),alert(l("custody.failed_to_update_try_again"))}finally{v.value=!1}},V=d=>{window.open(route("custody.document",d.id),"_blank")},J=d=>{const u=window.open(route("custody.document",d.id),"_blank");u&&u.addEventListener("load",()=>{u.print()})},K=async d=>{C.value=d,N.value=!0},me=async()=>{var d;if(!P.value||!C.value){alert(l("custody.select_document_to_upload"));return}v.value=!0;try{const u=new FormData;u.append("document",P.value),u.append("type","signed");const s=await fetch(route("custody.upload",C.value.id),{method:"POST",body:u,headers:{"X-CSRF-TOKEN":((d=document.querySelector('meta[name="csrf-token"]'))==null?void 0:d.content)||""}});if(s.ok){const c=await s.json();alert(l("custody.document_uploaded_successfully")),N.value=!1,C.value=null,P.value=null,W.reload()}else{const c=await s.json();alert(l("custody.failed_to_upload_document")+": "+(c.error||l("custody.unknown_error")))}}catch(u){console.error("Error uploading document:",u),alert(l("custody.failed_to_upload_try_again"))}finally{v.value=!1}};return pe(()=>{w.value=y.availableAssets}),(d,u)=>(i(),S(be,null,{default:a(()=>[o("div",ke,[o("div",Ce,[o("div",$e,[t(he,{breadcrumbs:oe.value},null,8,["breadcrumbs"]),o("div",Se,[o("div",Ae,[t(we,{title:`${e(l)("custody.update_custody")} - ${d.employee.full_name}`},null,8,["title"]),o("div",je,[t(e(E),{class:q(X(d.employee.employment_status))},{default:a(()=>[r(n(e(l)(`employees.status_${d.employee.employment_status}`)),1)]),_:1},8,["class"]),o("span",De,n(d.employee.employee_id),1)])]),o("div",ze,[t(e(f),{variant:"outline",asChild:""},{default:a(()=>[t(e(ye),{href:d.route("employees.show",d.employee.id)},{default:a(()=>[t(m,{name:"ArrowLeft",class:"mr-2 h-4 w-4"}),r(" "+n(e(l)("custody.back_to_employee")),1)]),_:1},8,["href"])]),_:1})])])]),o("div",Te,[t(e(D),null,{default:a(()=>[t(e(T),null,{default:a(()=>[t(e(U),{class:"flex items-center gap-2"},{default:a(()=>[t(m,{name:"Package",class:"h-5 w-5 text-blue-600"}),r(" "+n(e(l)("custody.current_custody"))+" ("+n(d.currentAssets.length)+") ",1)]),_:1})]),_:1}),t(e(z),null,{default:a(()=>[o("div",Ue,[(i(!0),p(A,null,j(d.currentAssets,s=>{var c;return i(),p("div",{key:s.id,class:"flex items-center justify-between p-3 border rounded-lg"},[o("div",Fe,[o("div",Ne,[t(m,{name:"Package",class:"h-4 w-4 text-blue-600"})]),o("div",null,[o("p",Pe,n(s.model_name||s.asset_tag),1),o("p",Ee,n(s.asset_tag),1),o("p",Be,n((c=s.assetCategory)==null?void 0:c.name),1)])]),t(e(f),{variant:"outline",size:"sm",onClick:_=>le(s),disabled:v.value},{default:a(()=>[t(m,{name:"Minus",class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"])])}),128)),d.currentAssets.length===0?(i(),p("div",Le,n(e(l)("custody.no_assets_assigned")),1)):x("",!0)])]),_:1})]),_:1}),t(e(D),null,{default:a(()=>[t(e(T),null,{default:a(()=>[t(e(U),{class:"flex items-center gap-2"},{default:a(()=>[t(m,{name:"Package",class:"h-5 w-5 text-green-600"}),r(" "+n(e(l)("custody.updated_custody"))+" ("+n(g.value.length)+") ",1)]),_:1})]),_:1}),t(e(z),null,{default:a(()=>[o("div",Oe,[(i(!0),p(A,null,j(g.value,s=>{var c;return i(),p("div",{key:s.id,class:"flex items-center justify-between p-3 border rounded-lg"},[o("div",Re,[o("div",Ve,[t(m,{name:"Package",class:"h-4 w-4 text-green-600"})]),o("div",null,[o("p",qe,n(s.model_name||s.asset_tag),1),o("p",Ie,n(s.asset_tag),1),o("p",Me,n((c=s.assetCategory)==null?void 0:c.name),1)])]),t(e(f),{variant:"outline",size:"sm",onClick:_=>ne(s),disabled:v.value},{default:a(()=>[t(m,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick","disabled"])])}),128)),t(e(f),{variant:"outline",class:"w-full border-dashed",onClick:u[0]||(u[0]=s=>F.value=!0),disabled:v.value},{default:a(()=>[t(m,{name:"Plus",class:"mr-2 h-4 w-4"}),r(" "+n(e(l)("custody.add_asset")),1)]),_:1},8,["disabled"])])]),_:1})]),_:1})]),R.value?(i(),S(e(D),{key:0},{default:a(()=>[t(e(T),null,{default:a(()=>[t(e(U),{class:"flex items-center gap-2"},{default:a(()=>[t(m,{name:"FileText",class:"h-5 w-5 text-orange-600"}),r(" "+n(e(l)("custody.changes_summary")),1)]),_:1})]),_:1}),t(e(z),null,{default:a(()=>[o("div",null,[t(e(se),{for:"changes_summary",class:"mb-2"},{default:a(()=>[r(n(e(l)("custody.summary_optional")),1)]),_:1}),ve(o("textarea",{id:"changes_summary","onUpdate:modelValue":u[1]||(u[1]=s=>B.value=s),rows:"3",placeholder:e(l)("custody.summary_placeholder"),class:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"},null,8,Xe),[[ge,B.value]])])]),_:1})]),_:1})):x("",!0),R.value?(i(),p("div",He,[t(e(f),{variant:"outline",onClick:de,disabled:v.value},{default:a(()=>[r(n(e(l)("custody.reset_changes")),1)]),_:1},8,["disabled"]),t(e(f),{onClick:ie,disabled:v.value},{default:a(()=>[t(m,{name:"Save",class:"mr-2 h-4 w-4"}),r(" "+n(v.value?e(l)("custody.saving"):e(l)("custody.save_custody_update")),1)]),_:1},8,["disabled"])])):x("",!0),d.recentCustodyChanges.length>0?(i(),S(e(D),{key:2},{default:a(()=>[t(e(T),null,{default:a(()=>[t(e(U),{class:"flex items-center gap-2"},{default:a(()=>[t(m,{name:"History",class:"h-5 w-5 text-gray-600"}),r(" "+n(e(l)("custody.recent_custody_changes")),1)]),_:1})]),_:1}),t(e(z),null,{default:a(()=>[o("div",Je,[(i(!0),p(A,null,j(d.recentCustodyChanges,s=>{var c;return i(),p("div",{key:s.id,class:"flex items-center justify-between p-3 border rounded-lg"},[o("div",null,[o("p",Ke,n(s.changes_summary||e(l)("custody.custody_updated")),1),o("p",We,n(new Date(s.created_at).toLocaleDateString())+" by "+n((c=s.updatedBy)==null?void 0:c.name),1)]),o("div",Qe,[t(e(E),{class:q(s.status==="completed"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800")},{default:a(()=>[r(n(e(l)("custody.status_"+s.status)),1)]),_:2},1032,["class"]),t(e(f),{variant:"outline",size:"sm",onClick:_=>J(s),title:e(l)("custody.print_document")},{default:a(()=>[t(m,{name:"Printer",class:"h-4 w-4"})]),_:2},1032,["onClick","title"]),t(e(f),{variant:"outline",size:"sm",onClick:_=>V(s),title:e(l)("custody.view_document")},{default:a(()=>[t(m,{name:"FileText",class:"h-4 w-4"})]),_:2},1032,["onClick","title"])])])}),128))])]),_:1})]),_:1})):x("",!0),I.value.length>0?(i(),S(e(D),{key:3},{default:a(()=>[t(e(T),null,{default:a(()=>[t(e(U),{class:"flex items-center gap-2"},{default:a(()=>[t(m,{name:"AlertCircle",class:"h-5 w-5 text-amber-600"}),r(" "+n(e(l)("custody.pending_custody_changes")),1)]),_:1}),o("p",Ge,n(e(l)("custody.pending_custody_changes_description")),1)]),_:1}),t(e(z),null,{default:a(()=>[o("div",Ye,[(i(!0),p(A,null,j(I.value,s=>{var c;return i(),p("div",{key:s.id,class:"flex items-center justify-between p-3 border rounded-lg bg-amber-50 border-amber-200"},[o("div",Ze,[o("p",et,n(s.changes_summary||e(l)("custody.custody_updated")),1),o("p",tt,n(new Date(s.created_at).toLocaleDateString())+" by "+n((c=s.updatedBy)==null?void 0:c.name),1),o("p",st,[t(m,{name:"Clock",class:"h-3 w-3 inline mr-1"}),r(" "+n(e(l)("custody.waiting_for_document")),1)])]),o("div",at,[t(e(E),{class:"bg-amber-100 text-amber-800"},{default:a(()=>[r(n(e(l)("custody.status_"+s.status)),1)]),_:2},1024),t(e(f),{variant:"outline",size:"sm",onClick:_=>V(s)},{default:a(()=>[t(m,{name:"FileText",class:"h-4 w-4"})]),_:2},1032,["onClick"]),t(e(f),{variant:"default",size:"sm",onClick:_=>K(s)},{default:a(()=>[t(m,{name:"Upload",class:"h-4 w-4 mr-1"}),r(" "+n(e(l)("custody.upload_document_button")),1)]),_:2},1032,["onClick"])])])}),128))])]),_:1})]),_:1})):x("",!0),M.value.length>0?(i(),S(e(D),{key:4},{default:a(()=>[t(e(T),null,{default:a(()=>[t(e(U),{class:"flex items-center gap-2"},{default:a(()=>[t(m,{name:"History",class:"h-5 w-5 text-gray-600"}),r(" "+n(e(l)("custody.other_custody_changes")),1)]),_:1})]),_:1}),t(e(z),null,{default:a(()=>[o("div",ot,[(i(!0),p(A,null,j(M.value,s=>{var c;return i(),p("div",{key:s.id,class:"flex items-center justify-between p-3 border rounded-lg"},[o("div",null,[o("p",lt,n(s.changes_summary||e(l)("custody.custody_updated")),1),o("p",nt,n(new Date(s.created_at).toLocaleDateString())+" by "+n((c=s.updatedBy)==null?void 0:c.name),1)]),o("div",dt,[t(e(E),{class:q(X(s.status))},{default:a(()=>[r(n(e(l)("custody.status_"+s.status)),1)]),_:2},1032,["class"]),t(e(f),{variant:"outline",size:"sm",onClick:_=>J(s),title:e(l)("custody.print_document")},{default:a(()=>[t(m,{name:"Printer",class:"h-4 w-4"})]),_:2},1032,["onClick","title"]),t(e(f),{variant:"outline",size:"sm",onClick:_=>V(s),title:e(l)("custody.view_document")},{default:a(()=>[t(m,{name:"FileText",class:"h-4 w-4"})]),_:2},1032,["onClick","title"]),s.status==="pending"?(i(),S(e(f),{key:0,variant:"default",size:"sm",onClick:_=>K(s)},{default:a(()=>[t(m,{name:"Upload",class:"h-4 w-4 mr-1"}),r(" "+n(e(l)("custody.upload_document_button")),1)]),_:2},1032,["onClick"])):x("",!0)])])}),128))])]),_:1})]),_:1})):x("",!0)])]),t(e(G),{open:F.value,"onUpdate:open":u[4]||(u[4]=s=>F.value=s)},{default:a(()=>[t(e(Y),{class:"max-w-4xl"},{default:a(()=>[t(e(Z),null,{default:a(()=>[t(e(ee),null,{default:a(()=>[r(n(e(l)("custody.select_assets_to_add")),1)]),_:1})]),_:1}),o("div",ut,[o("div",null,[t(e(Q),{modelValue:$.value,"onUpdate:modelValue":u[2]||(u[2]=s=>$.value=s),placeholder:e(l)("custody.search_assets_placeholder"),onInput:re},null,8,["modelValue","placeholder"])]),o("div",rt,[o("div",ct,[(i(!0),p(A,null,j(w.value,s=>{var c,_;return i(),p("div",{key:s.id,class:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:L=>H(s)},[o("div",mt,[t(e(xe),{checked:k.value.has(s.id),"onUpdate:checked":L=>H(s)},null,8,["checked","onUpdate:checked"]),o("div",_t,[t(m,{name:"Package",class:"h-4 w-4"})]),o("div",null,[o("p",ft,n(s.model_name||s.asset_tag),1),o("p",pt,n(s.asset_tag),1),o("p",yt,n((c=s.assetCategory)==null?void 0:c.name)+" - "+n((_=s.location)==null?void 0:_.name),1)])]),t(e(E),{variant:"outline"},{default:a(()=>[r(n(s.status),1)]),_:2},1024)],8,it)}),128)),w.value.length===0&&$.value?(i(),p("div",vt,n(e(l)("custody.no_available_assets_found")),1)):x("",!0)])])]),t(e(te),null,{default:a(()=>[t(e(f),{variant:"outline",onClick:u[3]||(u[3]=s=>F.value=!1)},{default:a(()=>[r(n(e(l)("common.cancel")),1)]),_:1}),t(e(f),{onClick:ce,disabled:k.value.size===0},{default:a(()=>[r(n(e(l)("custody.add_selected_assets",{count:k.value.size})),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),t(e(G),{open:N.value,"onUpdate:open":u[6]||(u[6]=s=>N.value=s)},{default:a(()=>[t(e(Y),{class:"max-w-md"},{default:a(()=>[t(e(Z),null,{default:a(()=>[t(e(ee),null,{default:a(()=>[r(n(e(l)("custody.upload_document_button")),1)]),_:1})]),_:1}),o("div",gt,[o("div",null,[t(e(se),{for:"document-upload"},{default:a(()=>[r(n(e(l)("custody.select_document")),1)]),_:1}),t(e(Q),{id:"document-upload",type:"file",accept:".pdf,.jpg,.jpeg,.png,.gif",onChange:ue,class:"mt-1"}),o("p",ht,n(e(l)("custody.upload_signed_document")),1)]),C.value?(i(),p("div",bt,[o("p",xt,n(C.value.changes_summary||e(l)("custody.custody_change")),1),o("p",wt,n(new Date(C.value.created_at).toLocaleDateString()),1)])):x("",!0)]),t(e(te),null,{default:a(()=>[t(e(f),{variant:"outline",onClick:u[5]||(u[5]=s=>N.value=!1)},{default:a(()=>[r(n(e(l)("common.cancel")),1)]),_:1}),t(e(f),{onClick:me,disabled:!P.value||v.value},{default:a(()=>[r(n(v.value?e(l)("custody.uploading"):e(l)("custody.upload_document_button")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"])]),_:1}))}});export{Zt as default};
