import{d as W,u as G,p as f,c as E,C as Q,i as Y,o as d,w as r,f as t,b as n,e as a,t as i,h,a as _,F as S,r as J,l as I,n as z,m as ee,v as te}from"./app-zM4mTImB.js";import{_ as se}from"./AppLayout.vue_vue_type_script_setup_true_lang-kQY0CZ_D.js";import{_ as w}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-dmJVm7v_.js";import{_ as y,a as x}from"./CardContent.vue_vue_type_script_setup_true_lang-BrSyjK1O.js";import{_ as A,a as $}from"./CardTitle.vue_vue_type_script_setup_true_lang-CB6xqZ2w.js";import{_ as N}from"./Badge.vue_vue_type_script_setup_true_lang-DuCvB78e.js";import{_ as u}from"./Icon.vue_vue_type_script_setup_true_lang-DeNPnbDb.js";import"./useForwardExpose-Dsd361ig.js";import"./RovingFocusGroup-FPPax93x.js";import"./building-Sl7bxnnu.js";import"./users-B-fayjHh.js";import"./activity-2Y0Vlg0s.js";import"./arrow-left-GARIT4k7.js";import"./calendar-BdX0gAEK.js";import"./check-DWqFYrfU.js";import"./chevron-down-CDd4RrO7.js";import"./search-BR5pWTD1.js";import"./eye-zbhrNt8z.js";import"./user-C4rBnB-f.js";import"./loader-circle-DfsWmzwl.js";import"./sun-C7_SDTHm.js";import"./play-DXV63ja6.js";import"./plus-DikcPJVZ.js";import"./square-pen-DPi54BVo.js";import"./trash-2-CHnEV89n.js";import"./triangle-alert-Bc6prVKh.js";const ne={class:"flex items-center justify-between"},ae={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},oe={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},ie={class:"flex items-center gap-4"},re={class:"flex items-center gap-2"},le={class:"flex items-center gap-1"},de=["title"],ce=["disabled"],_e={value:""},ue=["value"],me={class:"py-6"},pe={class:"mx-auto max-w-7xl px-6 lg:px-8"},ge={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},fe={class:"flex items-center"},he={class:"flex-shrink-0"},ve={class:"flex h-8 w-8 items-center justify-center rounded-md bg-yellow-100 text-yellow-600"},we={class:"ml-4"},ye={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},xe={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Pe={class:"flex items-center"},be={class:"flex-shrink-0"},Se={class:"flex h-8 w-8 items-center justify-center rounded-md bg-blue-100 text-blue-600"},Je={class:"ml-4"},ke={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Me={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Ce={class:"flex items-center"},Fe={class:"flex-shrink-0"},Te={class:"flex h-8 w-8 items-center justify-center rounded-md bg-green-100 text-green-600"},Ae={class:"ml-4"},$e={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Ne={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Oe={class:"flex items-center"},De={class:"flex-shrink-0"},Ee={class:"flex h-8 w-8 items-center justify-center rounded-md bg-red-100 text-red-600"},Ie={class:"ml-4"},ze={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Xe={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Re={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Le={key:0,class:"text-center py-8"},qe={class:"text-gray-500"},je={key:1,class:"space-y-4"},Ve={class:"flex items-center justify-between"},Be={class:"flex-1"},Ke={class:"flex items-center gap-2"},He={class:"text-sm font-medium"},Ze={class:"mt-2"},Ue={class:"font-semibold"},We={class:"text-sm text-gray-600 dark:text-gray-400"},Ge={class:"text-xs text-gray-500 dark:text-gray-500"},Qe={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},Ye={class:"flex gap-2"},et={key:0,class:"text-center py-8"},tt={class:"text-gray-500"},st={key:1,class:"space-y-4"},nt={class:"flex items-center justify-between"},at={class:"flex-1"},ot={class:"flex items-center gap-2"},it={class:"text-sm font-medium"},rt={class:"mt-2"},lt={class:"font-semibold"},dt={class:"text-sm text-gray-600 dark:text-gray-400"},ct={class:"flex items-center gap-2 mt-1"},_t={class:"text-xs text-blue-600"},ut={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},mt={class:"flex gap-2"},pt={class:"mt-6"},gt={key:0,class:"text-center py-4"},ft={class:"text-gray-500"},ht={key:1,class:"space-y-2"},vt={class:"flex items-center gap-3"},wt={class:"font-medium"},yt={class:"text-sm text-gray-500"},Zt=W({__name:"Index",setup(xt){const{t:c}=G(),p=f([]),k=f([]),P=f({pending:0,processing:0,completed_today:0,failed_today:0}),M=f(!1),C=f(!1),m=f(""),O=f([]),g=f("loading"),F=E(()=>p.value.filter(s=>s.status==="pending").sort((s,o)=>{const e={urgent:4,high:3,normal:2,low:1},l=e[s.priority]||0,v=e[o.priority]||0;return l!==v?v-l:new Date(s.created_at).getTime()-new Date(o.created_at).getTime()})),T=E(()=>p.value.filter(s=>s.status==="processing")),X=s=>{switch(s){case"urgent":return"destructive";case"high":return"secondary";case"normal":return"outline";case"low":return"secondary";default:return"outline"}},R=s=>new Date(s).toLocaleTimeString(),b=async()=>{M.value=!0;try{const[s,o,e]=await Promise.all([fetch("/api/print-jobs/pending"),fetch("/api/print-jobs/history?limit=10"),fetch("/api/print-jobs/statistics")]);s.ok&&(p.value=await s.json()),o.ok&&(k.value=await o.json()),e.ok&&(P.value=await e.json())}catch(s){console.error("Failed to refresh jobs:",s)}finally{M.value=!1}},L=async s=>{var o;if(!m.value){alert("Please select a printer first");return}try{if((await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"processing",print_station_id:"MANUAL_STATION_"+Date.now(),printer_name:m.value})})).ok){const l=p.value.findIndex(v=>v.id===s.id);l!==-1&&(p.value[l].status="processing"),await q(s)}}catch(e){console.error("Failed to process print job:",e),alert("Failed to process print job: "+e)}},q=async s=>{try{if(typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager){const o=j(s.asset),e=new window.JSPM.ClientPrintJob;e.clientPrinter=new window.JSPM.InstalledPrinter(m.value),e.printerCommands=o,await e.sendToClient(),console.log(`Printed label for asset ${s.asset.asset_tag} on printer ${m.value}`)}else throw new Error("JSPrintManager not available")}catch(o){throw console.error("Failed to print label:",o),o}},j=s=>`
^XA
^CF0,30
^FO50,50^FD${s.asset_tag}^FS
^CF0,20
^FO50,100^FD${s.model_name||"N/A"}^FS
^FO50,130^FD${s.serial_number||"N/A"}^FS
^FO50,160^FD${s.category||"N/A"}^FS
^XZ
    `.trim(),V=async s=>{var o;try{(await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"completed"})})).ok&&(p.value=p.value.filter(l=>l.id!==s.id),P.value.completed_today++,b())}catch(e){console.error("Failed to complete print job:",e)}},B=async s=>{var o;try{(await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"failed",error_message:"Print job failed"})})).ok&&(p.value=p.value.filter(l=>l.id!==s.id),P.value.failed_today++,b())}catch(e){console.error("Failed to fail print job:",e)}},K=async s=>{var o;try{(await fetch(`/api/print-jobs/${s.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}})).ok&&(p.value=p.value.filter(l=>l.id!==s.id))}catch(e){console.error("Failed to cancel print job:",e)}},D=async()=>{C.value=!0;try{if(await H(),typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager){await window.JSPM.JSPrintManager.start(),console.log("JSPrintManager started successfully"),g.value="connected";const s=await window.JSPM.JSPrintManager.getPrinters();O.value=s,console.log("Available printers:",s);const o=s.find(e=>e.toLowerCase().includes("zdesigner"));o&&!m.value?(m.value=o,console.log("Auto-selected ZDesigner printer:",o)):s.length>0&&!m.value&&(m.value=s[0],console.log("Auto-selected first available printer:",s[0]))}else console.error("JSPrintManager not available after waiting"),g.value="not-available",alert("JSPrintManager is not available. Please make sure JSPrintManager is installed and running on this computer.")}catch(s){console.error("Failed to refresh printers:",s),g.value="error",alert("Failed to connect to JSPrintManager: "+(s instanceof Error?s.message:String(s)))}finally{C.value=!1}},H=()=>new Promise((s,o)=>{let e=0;const l=50,v=()=>{e++,typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager?s():e>=l?o(new Error("JSPrintManager not loaded after 5 seconds")):setTimeout(v,100)};v()}),Z=()=>{console.log("Selected printer:",m.value),m.value&&localStorage.setItem("printStation_selectedPrinter",m.value)},U=()=>{var s,o,e;console.log("=== JSPrintManager Test ==="),console.log("Window object:",typeof window),console.log("window.JSPM:",window.JSPM),console.log("window.JSPM.JSPrintManager:",(s=window.JSPM)==null?void 0:s.JSPrintManager),console.log("window.JSPM.ClientPrintJob:",(o=window.JSPM)==null?void 0:o.ClientPrintJob),console.log("window.JSPM.InstalledPrinter:",(e=window.JSPM)==null?void 0:e.InstalledPrinter),typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager?alert("JSPrintManager is available! âœ…"):alert(`JSPrintManager is NOT available! âŒ

Please check:
1. JSPrintManager is installed
2. JSPrintManager service is running
3. Scripts are loaded properly`)};return Q(()=>{const s=localStorage.getItem("printStation_selectedPrinter");s&&(m.value=s),b(),console.log("Window object:",typeof window),console.log("JSPM available:",typeof window<"u"&&window.JSPM),console.log("JSPrintManager available:",typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager),setTimeout(()=>{console.log("After timeout - JSPM available:",typeof window<"u"&&window.JSPM),console.log("After timeout - JSPrintManager available:",typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager),D()},2e3),setInterval(b,1e4)}),(s,o)=>(d(),Y(se,null,{header:r(()=>[t("div",ne,[t("div",null,[t("h2",ae,i(a(c)("print_station.title")),1),t("p",oe,i(a(c)("print_station.description")),1)]),t("div",ie,[t("div",re,[t("div",le,[n(u,{name:"Printer",class:"h-4 w-4 text-gray-500"}),t("div",{class:z({"h-2 w-2 rounded-full":!0,"bg-green-500":g.value==="connected","bg-red-500":g.value==="error"||g.value==="not-available","bg-yellow-500":g.value==="loading"}),title:g.value==="connected"?"JSPrintManager Connected":g.value==="error"?"JSPrintManager Error":g.value==="not-available"?"JSPrintManager Not Available":"Connecting to JSPrintManager..."},null,10,de)]),ee(t("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>m.value=e),class:"text-sm border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1 bg-white dark:bg-gray-800",onChange:Z,disabled:g.value!=="connected"},[t("option",_e,i(a(c)("print_station.select_printer")),1),(d(!0),_(S,null,J(O.value,e=>(d(),_("option",{key:e,value:e},i(e),9,ue))),128))],40,ce),[[te,m.value]]),n(a(w),{size:"sm",variant:"outline",onClick:D,disabled:C.value},{default:r(()=>[n(u,{name:"RefreshCw",class:"h-3 w-3"})]),_:1},8,["disabled"]),n(a(w),{size:"sm",variant:"outline",onClick:U},{default:r(()=>o[1]||(o[1]=[h(" Test ")])),_:1,__:[1]})]),n(a(w),{onClick:b,disabled:M.value},{default:r(()=>[n(u,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),h(" "+i(a(c)("print_station.refresh")),1)]),_:1},8,["disabled"])])])]),default:r(()=>[t("div",me,[t("div",pe,[t("div",ge,[n(a(y),null,{default:r(()=>[n(a(x),{class:"p-6"},{default:r(()=>[t("div",fe,[t("div",he,[t("div",ve,[n(u,{name:"Clock",class:"h-5 w-5"})])]),t("div",we,[t("dt",ye,i(a(c)("print_station.pending_jobs")),1),t("dd",xe,i(F.value.length),1)])])]),_:1})]),_:1}),n(a(y),null,{default:r(()=>[n(a(x),{class:"p-6"},{default:r(()=>[t("div",Pe,[t("div",be,[t("div",Se,[n(u,{name:"Printer",class:"h-5 w-5"})])]),t("div",Je,[t("dt",ke,i(a(c)("print_station.processing_jobs")),1),t("dd",Me,i(T.value.length),1)])])]),_:1})]),_:1}),n(a(y),null,{default:r(()=>[n(a(x),{class:"p-6"},{default:r(()=>[t("div",Ce,[t("div",Fe,[t("div",Te,[n(u,{name:"CheckCircle",class:"h-5 w-5"})])]),t("div",Ae,[t("dt",$e,i(a(c)("print_station.completed_today")),1),t("dd",Ne,i(P.value.completed_today||0),1)])])]),_:1})]),_:1}),n(a(y),null,{default:r(()=>[n(a(x),{class:"p-6"},{default:r(()=>[t("div",Oe,[t("div",De,[t("div",Ee,[n(u,{name:"XCircle",class:"h-5 w-5"})])]),t("div",Ie,[t("dt",ze,i(a(c)("print_station.failed_today")),1),t("dd",Xe,i(P.value.failed_today||0),1)])])]),_:1})]),_:1})]),t("div",Re,[n(a(y),null,{default:r(()=>[n(a(A),null,{default:r(()=>[n(a($),{class:"flex items-center gap-2"},{default:r(()=>[n(u,{name:"Clock",class:"h-5 w-5 text-yellow-600"}),h(" "+i(a(c)("print_station.pending_queue")),1)]),_:1})]),_:1}),n(a(x),null,{default:r(()=>[F.value.length===0?(d(),_("div",Le,[n(u,{name:"Inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",qe,i(a(c)("print_station.no_pending_jobs")),1)])):(d(),_("div",je,[(d(!0),_(S,null,J(F.value,e=>(d(),_("div",{key:e.id,class:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800"},[t("div",Ve,[t("div",Be,[t("div",Ke,[n(a(N),{variant:X(e.priority)},{default:r(()=>[h(i(e.priority),1)]),_:2},1032,["variant"]),t("span",He,i(e.job_id),1)]),t("div",Ze,[t("p",Ue,i(e.asset.asset_tag),1),t("p",We,i(e.asset.model_name)+" - "+i(e.company.name),1),t("p",Ge,i(a(c)("print_station.requested_by"))+" "+i(e.user.name),1),e.comment?(d(),_("p",Qe," ðŸ’¬ "+i(e.comment),1)):I("",!0)])]),t("div",Ye,[n(a(w),{size:"sm",onClick:l=>L(e)},{default:r(()=>[n(u,{name:"Play",class:"h-4 w-4"})]),_:2},1032,["onClick"]),n(a(w),{size:"sm",variant:"outline",onClick:l=>K(e)},{default:r(()=>[n(u,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1}),n(a(y),null,{default:r(()=>[n(a(A),null,{default:r(()=>[n(a($),{class:"flex items-center gap-2"},{default:r(()=>[n(u,{name:"Printer",class:"h-5 w-5 text-blue-600"}),h(" "+i(a(c)("print_station.processing_queue")),1)]),_:1})]),_:1}),n(a(x),null,{default:r(()=>[T.value.length===0?(d(),_("div",et,[n(u,{name:"Printer",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),t("p",tt,i(a(c)("print_station.no_processing_jobs")),1)])):(d(),_("div",st,[(d(!0),_(S,null,J(T.value,e=>(d(),_("div",{key:e.id,class:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800"},[t("div",nt,[t("div",at,[t("div",ot,[n(a(N),{variant:"secondary"},{default:r(()=>[h(i(e.priority),1)]),_:2},1024),t("span",it,i(e.job_id),1)]),t("div",rt,[t("p",lt,i(e.asset.asset_tag),1),t("p",dt,i(e.asset.model_name)+" - "+i(e.company.name),1),t("div",ct,[o[2]||(o[2]=t("div",{class:"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full"},null,-1)),t("span",_t,i(a(c)("print_station.printing")),1)]),e.comment?(d(),_("p",ut," ðŸ’¬ "+i(e.comment),1)):I("",!0)])]),t("div",mt,[n(a(w),{size:"sm",variant:"outline",onClick:l=>V(e)},{default:r(()=>[n(u,{name:"Check",class:"h-4 w-4"})]),_:2},1032,["onClick"]),n(a(w),{size:"sm",variant:"destructive",onClick:l=>B(e)},{default:r(()=>[n(u,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1})]),t("div",pt,[n(a(y),null,{default:r(()=>[n(a(A),null,{default:r(()=>[n(a($),null,{default:r(()=>[h(i(a(c)("print_station.recent_activity")),1)]),_:1})]),_:1}),n(a(x),null,{default:r(()=>[k.value.length===0?(d(),_("div",gt,[t("p",ft,i(a(c)("print_station.no_recent_activity")),1)])):(d(),_("div",ht,[(d(!0),_(S,null,J(k.value,e=>(d(),_("div",{key:e.id,class:"flex items-center justify-between p-2 rounded border"},[t("div",vt,[n(u,{name:e.status==="completed"?"CheckCircle":"XCircle",class:z([e.status==="completed"?"text-green-600":"text-red-600","h-4 w-4"])},null,8,["name","class"]),t("span",wt,i(e.asset.asset_tag),1),n(a(N),{variant:e.status==="completed"?"default":"destructive",size:"sm"},{default:r(()=>[h(i(e.status),1)]),_:2},1032,["variant"])]),t("span",yt,i(R(e.completed_at||e.updated_at)),1)]))),128))]))]),_:1})]),_:1})])])])]),_:1}))}});export{Zt as default};
