import{d as q,u as M,p as b,c as T,C as R,bV as y,G as z,i as L,o as u,w as r,f as e,b as s,e as t,t as i,h as x,a as m,F as A,r as N,n as V}from"./app-CVRJmPTH.js";import{_ as B}from"./AppLayout.vue_vue_type_script_setup_true_lang-D3gvI3Og.js";import{I as d,_ as v}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Cdl8Ijz2.js";import{_ as f,a as h}from"./CardContent.vue_vue_type_script_setup_true_lang-vPHZTDc4.js";import{_ as J,a as O}from"./CardTitle.vue_vue_type_script_setup_true_lang-DBZMskcE.js";import{_ as j}from"./Badge.vue_vue_type_script_setup_true_lang-CnlsbIG6.js";import"./useForwardExpose-ALsy-CuN.js";import"./RovingFocusGroup-D4uoV-3z.js";import"./building-BBQz6b4O.js";import"./users-BXF1wPcw.js";const K={class:"flex items-center justify-between"},H={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},G={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},U={class:"flex items-center gap-4"},Z={class:"flex items-center gap-2"},Q={class:"text-sm font-medium"},W={class:"py-6"},Y={class:"mx-auto max-w-7xl px-6 lg:px-8"},ee={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},te={class:"flex items-center"},se={class:"flex-shrink-0"},ne={class:"flex h-8 w-8 items-center justify-center rounded-md bg-yellow-100 text-yellow-600"},ae={class:"ml-4"},oe={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},ie={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},re={class:"flex items-center"},le={class:"flex-shrink-0"},ce={class:"flex h-8 w-8 items-center justify-center rounded-md bg-blue-100 text-blue-600"},de={class:"ml-4"},_e={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},ue={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},me={class:"flex items-center"},pe={class:"flex-shrink-0"},fe={class:"flex h-8 w-8 items-center justify-center rounded-md bg-green-100 text-green-600"},he={class:"ml-4"},ge={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},ye={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},xe={class:"flex items-center"},ve={class:"flex-shrink-0"},be={class:"flex h-8 w-8 items-center justify-center rounded-md bg-red-100 text-red-600"},we={class:"ml-4"},ke={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Ce={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Fe={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},$e={key:0,class:"text-center py-8"},Se={class:"text-gray-500"},Pe={key:1,class:"space-y-4"},Te={class:"flex items-center justify-between"},Ae={class:"flex-1"},Ne={class:"flex items-center gap-2"},Je={class:"text-sm font-medium"},Oe={class:"mt-2"},je={class:"font-semibold"},De={class:"text-sm text-gray-600 dark:text-gray-400"},Xe={class:"text-xs text-gray-500 dark:text-gray-500"},Ee={class:"flex gap-2"},Ie={key:0,class:"text-center py-8"},qe={class:"text-gray-500"},Me={key:1,class:"space-y-4"},Re={class:"flex items-center justify-between"},ze={class:"flex-1"},Le={class:"flex items-center gap-2"},Ve={class:"text-sm font-medium"},Be={class:"mt-2"},Ke={class:"font-semibold"},He={class:"text-sm text-gray-600 dark:text-gray-400"},Ge={class:"flex items-center gap-2 mt-1"},Ue={class:"text-xs text-blue-600"},Ze={class:"flex gap-2"},lt=q({__name:"Index",props:{pusherConfig:{}},setup(Qe){const{t:c}=M(),_=b([]),p=b({pending:0,processing:0,completed_today:0,failed_today:0}),w=b(!1),g=b(!1),k=T(()=>_.value.filter(a=>a.status==="pending")),C=T(()=>_.value.filter(a=>a.status==="processing")),D=a=>{switch(a){case"urgent":return"destructive";case"high":return"secondary";case"normal":return"outline";case"low":return"secondary";default:return"outline"}},S=async()=>{w.value=!0;try{const o=await(await fetch("/api/print-jobs/pending")).json();_.value=o;const l=await(await fetch("/api/print-jobs/statistics")).json();p.value=l}catch(a){console.error("Failed to refresh jobs:",a)}finally{w.value=!1}},X=async a=>{var o;try{if((await fetch(`/api/print-jobs/${a.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"processing",print_station_id:"STATION_"+Date.now()})})).ok){const l=_.value.findIndex($=>$.id===a.id);l!==-1&&(_.value[l].status="processing"),await I(a)}}catch(n){console.error("Failed to process print job:",n)}},P=async a=>{var o;try{(await fetch(`/api/print-jobs/${a.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"completed"})})).ok&&(_.value=_.value.filter(l=>l.id!==a.id),p.value.completed_today++)}catch(n){console.error("Failed to complete print job:",n)}},F=async a=>{var o;try{(await fetch(`/api/print-jobs/${a.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"failed",error_message:"Print job failed manually"})})).ok&&(_.value=_.value.filter(l=>l.id!==a.id),p.value.failed_today++)}catch(n){console.error("Failed to fail print job:",n)}},E=async a=>{var o;try{(await fetch(`/api/print-jobs/${a.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}})).ok&&(_.value=_.value.filter(l=>l.id!==a.id))}catch(n){console.error("Failed to cancel print job:",n)}},I=async a=>{try{if(typeof window.JSPrintManager>"u"){console.error("JSPrintManager is not available"),await F(a);return}const o=a.print_data,n=`
Asset Tag: ${o.asset_tag}
Model: ${o.model_name}
Serial: ${o.serial_number}
Company: ${o.company_name}
Location: ${o.location_name}
        `.trim(),l=new window.JSPrintManager.ClientPrintJob;l.clientPrinter=new window.JSPrintManager.DefaultPrinter;const $=`
^XA
^FO50,50^A0N,30,30^FDAsset Tag: ${o.asset_tag}^FS
^FO50,100^A0N,25,25^FDModel: ${o.model_name}^FS
^FO50,150^A0N,25,25^FDSerial: ${o.serial_number}^FS
^FO50,200^A0N,25,25^FDCompany: ${o.company_name}^FS
^FO50,250^A0N,25,25^FDLocation: ${o.location_name}^FS
^XZ
        `;l.printerCommands=$,l.sendToClient(),setTimeout(()=>{P(a)},2e3)}catch(o){console.error("Failed to print asset label:",o),await F(a)}};return R(()=>{S(),y.channel("print-station").listen(".print-job.created",a=>{console.log("New print job received:",a),_.value.unshift(a),p.value.pending++}),y.connector.pusher.connection.bind("connected",()=>{g.value=!0,console.log("Connected to Pusher")}),y.connector.pusher.connection.bind("disconnected",()=>{g.value=!1,console.log("Disconnected from Pusher")}),g.value=y.connector.pusher.connection.state==="connected"}),z(()=>{y.leaveChannel("print-station")}),(a,o)=>(u(),L(B,null,{header:r(()=>[e("div",K,[e("div",null,[e("h2",H,i(t(c)("print_station.title")),1),e("p",G,i(t(c)("print_station.description")),1)]),e("div",U,[e("div",Z,[e("div",{class:V(["h-3 w-3 rounded-full",g.value?"bg-green-500":"bg-red-500"])},null,2),e("span",Q,i(g.value?t(c)("print_station.connected"):t(c)("print_station.disconnected")),1)]),s(t(v),{onClick:S,disabled:w.value},{default:r(()=>[s(t(d),{name:"RefreshCw",class:"mr-2 h-4 w-4"}),x(" "+i(t(c)("print_station.refresh")),1)]),_:1},8,["disabled"])])])]),default:r(()=>[e("div",W,[e("div",Y,[e("div",ee,[s(t(f),null,{default:r(()=>[s(t(h),{class:"p-6"},{default:r(()=>[e("div",te,[e("div",se,[e("div",ne,[s(t(d),{name:"Clock",class:"h-5 w-5"})])]),e("div",ae,[e("dt",oe,i(t(c)("print_station.pending_jobs")),1),e("dd",ie,i(k.value.length),1)])])]),_:1})]),_:1}),s(t(f),null,{default:r(()=>[s(t(h),{class:"p-6"},{default:r(()=>[e("div",re,[e("div",le,[e("div",ce,[s(t(d),{name:"Play",class:"h-5 w-5"})])]),e("div",de,[e("dt",_e,i(t(c)("print_station.processing_jobs")),1),e("dd",ue,i(C.value.length),1)])])]),_:1})]),_:1}),s(t(f),null,{default:r(()=>[s(t(h),{class:"p-6"},{default:r(()=>[e("div",me,[e("div",pe,[e("div",fe,[s(t(d),{name:"CheckCircle",class:"h-5 w-5"})])]),e("div",he,[e("dt",ge,i(t(c)("print_station.completed_today")),1),e("dd",ye,i(p.value.completed_today||0),1)])])]),_:1})]),_:1}),s(t(f),null,{default:r(()=>[s(t(h),{class:"p-6"},{default:r(()=>[e("div",xe,[e("div",ve,[e("div",be,[s(t(d),{name:"XCircle",class:"h-5 w-5"})])]),e("div",we,[e("dt",ke,i(t(c)("print_station.failed_today")),1),e("dd",Ce,i(p.value.failed_today||0),1)])])]),_:1})]),_:1})]),e("div",Fe,[s(t(f),null,{default:r(()=>[s(t(J),null,{default:r(()=>[s(t(O),{class:"flex items-center gap-2"},{default:r(()=>[s(t(d),{name:"Clock",class:"h-5 w-5 text-yellow-600"}),x(" "+i(t(c)("print_station.pending_queue")),1)]),_:1})]),_:1}),s(t(h),null,{default:r(()=>[k.value.length===0?(u(),m("div",$e,[s(t(d),{name:"Inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e("p",Se,i(t(c)("print_station.no_pending_jobs")),1)])):(u(),m("div",Pe,[(u(!0),m(A,null,N(k.value,n=>(u(),m("div",{key:n.id,class:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800"},[e("div",Te,[e("div",Ae,[e("div",Ne,[s(t(j),{variant:D(n.priority)},{default:r(()=>[x(i(n.priority),1)]),_:2},1032,["variant"]),e("span",Je,i(n.job_id),1)]),e("div",Oe,[e("p",je,i(n.asset.asset_tag),1),e("p",De,i(n.asset.model_name)+" - "+i(n.company.name),1),e("p",Xe,i(t(c)("print_station.requested_by"))+" "+i(n.user.name),1)])]),e("div",Ee,[s(t(v),{size:"sm",onClick:l=>X(n)},{default:r(()=>[s(t(d),{name:"Play",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(t(v),{size:"sm",variant:"outline",onClick:l=>E(n)},{default:r(()=>[s(t(d),{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1}),s(t(f),null,{default:r(()=>[s(t(J),null,{default:r(()=>[s(t(O),{class:"flex items-center gap-2"},{default:r(()=>[s(t(d),{name:"Play",class:"h-5 w-5 text-blue-600"}),x(" "+i(t(c)("print_station.processing_queue")),1)]),_:1})]),_:1}),s(t(h),null,{default:r(()=>[C.value.length===0?(u(),m("div",Ie,[s(t(d),{name:"Printer",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e("p",qe,i(t(c)("print_station.no_processing_jobs")),1)])):(u(),m("div",Me,[(u(!0),m(A,null,N(C.value,n=>(u(),m("div",{key:n.id,class:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800"},[e("div",Re,[e("div",ze,[e("div",Le,[s(t(j),{variant:"secondary"},{default:r(()=>[x(i(n.priority),1)]),_:2},1024),e("span",Ve,i(n.job_id),1)]),e("div",Be,[e("p",Ke,i(n.asset.asset_tag),1),e("p",He,i(n.asset.model_name)+" - "+i(n.company.name),1),e("div",Ge,[o[0]||(o[0]=e("div",{class:"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full"},null,-1)),e("span",Ue,i(t(c)("print_station.printing")),1)])])]),e("div",Ze,[s(t(v),{size:"sm",variant:"outline",onClick:l=>P(n)},{default:r(()=>[s(t(d),{name:"Check",class:"h-4 w-4"})]),_:2},1032,["onClick"]),s(t(v),{size:"sm",variant:"destructive",onClick:l=>F(n)},{default:r(()=>[s(t(d),{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1})])])])]),_:1}))}});export{lt as default};
