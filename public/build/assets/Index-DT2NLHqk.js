import{d as W,u as Z,p as g,c as D,C as Q,G as Y,i as ee,o as l,w as r,f as e,b as a,e as n,t as i,h,a as d,F as S,r as C,l as R,n as X,m as te,v as se}from"./app-DFVgWCkx.js";import{_ as ae}from"./AppLayout.vue_vue_type_script_setup_true_lang-G2xkCzkK.js";import{_ as v}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DQjej2aa.js";import{_ as y,a as x}from"./CardContent.vue_vue_type_script_setup_true_lang-DkarBMUd.js";import{_ as N,a as I}from"./CardTitle.vue_vue_type_script_setup_true_lang-0QZ5wm5a.js";import{_ as z}from"./Badge.vue_vue_type_script_setup_true_lang-B0wWqnah.js";import{_}from"./Icon.vue_vue_type_script_setup_true_lang-DAfC8VIY.js";import{P as ne}from"./PrintService-Dd0Ir3zw.js";import"./useForwardExpose-DQAHBzTQ.js";import"./RovingFocusGroup-BuNmoLFK.js";import"./building-CJ_gtJWe.js";import"./users-D5H9dsQ6.js";import"./activity-CTh6op6H.js";import"./arrow-left-D-CgoINj.js";import"./calendar-zn9DZyAu.js";import"./check-KD_lMWVF.js";import"./chevron-down-DtEbGzWS.js";import"./search-Bi0yOOKR.js";import"./eye-CiNE1K3X.js";import"./user-rYSnwasi.js";import"./loader-circle-Bcvdrurn.js";import"./sun-DEXdV5hM.js";import"./play-BhX0HrXQ.js";import"./plus-CGIMXuMg.js";import"./square-pen-CChd76Ao.js";import"./trash-2-DlpSSIfR.js";import"./triangle-alert-DuqgnofP.js";const ie={class:"flex items-center justify-between"},oe={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},re={class:"mt-1 text-sm text-gray-600 dark:text-gray-400"},le={class:"flex items-center gap-4"},ce={class:"flex items-center gap-2"},de={class:"flex items-center gap-1"},_e=["title"],ue=["disabled"],me={value:""},pe=["value"],fe={class:"py-6"},ge={class:"mx-auto max-w-7xl px-6 lg:px-8"},he={class:"mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},ve={class:"flex items-center"},ye={class:"flex-shrink-0"},xe={class:"flex h-8 w-8 items-center justify-center rounded-md bg-yellow-100 text-yellow-600"},we={class:"ml-4"},be={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},ke={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Pe={class:"flex items-center"},Se={class:"flex-shrink-0"},Ce={class:"flex h-8 w-8 items-center justify-center rounded-md bg-blue-100 text-blue-600"},Je={class:"ml-4"},Me={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},Te={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},$e={class:"flex items-center"},Ae={class:"flex-shrink-0"},Fe={class:"flex h-8 w-8 items-center justify-center rounded-md bg-green-100 text-green-600"},Ne={class:"ml-4"},Ie={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},ze={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Ee={class:"flex items-center"},Oe={class:"flex-shrink-0"},De={class:"flex h-8 w-8 items-center justify-center rounded-md bg-red-100 text-red-600"},Re={class:"ml-4"},Xe={class:"text-sm font-medium text-gray-500 dark:text-gray-400"},qe={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Le={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Ve={key:0,class:"text-center py-8"},je={class:"text-gray-500"},Be={key:1,class:"space-y-4"},Ke={class:"flex items-center justify-between"},He={class:"flex-1"},Ue={class:"flex items-center gap-2"},Ge={class:"text-sm font-medium"},We={class:"mt-2"},Ze={class:"font-semibold"},Qe={class:"text-sm text-gray-600 dark:text-gray-400"},Ye={class:"text-xs text-gray-500 dark:text-gray-500"},et={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},tt={class:"flex gap-2"},st={key:0,class:"text-center py-8"},at={class:"text-gray-500"},nt={key:1,class:"space-y-4"},it={class:"flex items-center justify-between"},ot={class:"flex-1"},rt={class:"flex items-center gap-2"},lt={class:"text-sm font-medium"},ct={class:"mt-2"},dt={class:"font-semibold"},_t={class:"text-sm text-gray-600 dark:text-gray-400"},ut={class:"flex items-center gap-2 mt-1"},mt={class:"text-xs text-blue-600"},pt={key:0,class:"text-xs text-blue-600 dark:text-blue-400 mt-1"},ft={class:"flex gap-2"},gt={class:"mt-6"},ht={key:0,class:"text-center py-4"},vt={class:"text-gray-500"},yt={key:1,class:"space-y-2"},xt={class:"flex items-center gap-3"},wt={class:"font-medium"},bt={class:"text-sm text-gray-500"},Zt=W({__name:"Index",setup(kt){const{t:c}=Z(),p=g([]),J=g([]),w=g({pending:0,processing:0,completed_today:0,failed_today:0}),M=g(!1),T=g(!1),m=g(""),$=g([]),f=g("loading"),b=ne.getInstance(),A=D(()=>p.value.filter(s=>s.status==="pending").sort((s,o)=>{const t={urgent:4,high:3,normal:2,low:1},u=t[s.priority]||0,P=t[o.priority]||0;return u!==P?P-u:new Date(s.created_at).getTime()-new Date(o.created_at).getTime()})),F=D(()=>p.value.filter(s=>s.status==="processing")),q=s=>{switch(s){case"urgent":return"destructive";case"high":return"secondary";case"normal":return"outline";case"low":return"secondary";default:return"outline"}},L=s=>new Date(s).toLocaleTimeString(),k=async()=>{M.value=!0;try{const[s,o,t]=await Promise.all([fetch("/api/print-jobs/pending"),fetch("/api/print-jobs/history?limit=10"),fetch("/api/print-jobs/statistics")]);s.ok&&(p.value=await s.json()),o.ok&&(J.value=await o.json()),t.ok&&(w.value=await t.json())}catch(s){console.error("Failed to refresh jobs:",s)}finally{M.value=!1}},V=async s=>{var o;if(!m.value){alert("Please select a printer first");return}try{if((await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"processing",print_station_id:"MANUAL_STATION_"+Date.now(),printer_name:m.value})})).ok){const u=p.value.findIndex(P=>P.id===s.id);u!==-1&&(p.value[u].status="processing"),await j(s)}}catch(t){console.error("Failed to process print job:",t),alert("Failed to process print job: "+t)}},j=async s=>{try{await b.printAssetLabel(s.asset,!1,m.value),console.log(`Printed label for asset ${s.asset.asset_tag} on printer ${m.value}`)}catch(o){throw console.error("Failed to print label:",o),o}},B=async s=>{var o;try{(await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"completed"})})).ok&&(p.value=p.value.filter(u=>u.id!==s.id),w.value.completed_today++,k())}catch(t){console.error("Failed to complete print job:",t)}},K=async s=>{var o;try{(await fetch(`/api/print-jobs/${s.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({status:"failed",error_message:"Print job failed"})})).ok&&(p.value=p.value.filter(u=>u.id!==s.id),w.value.failed_today++,k())}catch(t){console.error("Failed to fail print job:",t)}},H=async s=>{var o;try{(await fetch(`/api/print-jobs/${s.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}})).ok&&(p.value=p.value.filter(u=>u.id!==s.id))}catch(t){console.error("Failed to cancel print job:",t)}},E=async()=>{T.value=!0;try{await b.initializeJSPrintManager();const s=await b.getAvailablePrinters();$.value=s;const o=s.find(t=>t.toLowerCase().includes("zdesigner"));o&&!m.value?(m.value=o,console.log("Auto-selected ZDesigner printer:",o)):s.length>0&&!m.value&&(m.value=s[0],console.log("Auto-selected first available printer:",s[0]))}catch(s){console.error("Failed to refresh printers:",s),alert("Failed to connect to JSPrintManager: "+(s instanceof Error?s.message:String(s)))}finally{T.value=!1}},U=()=>{console.log("Selected printer:",m.value),m.value&&localStorage.setItem("printStation_selectedPrinter",m.value)},G=()=>{var s,o,t;console.log("=== JSPrintManager Test ==="),console.log("Window object:",typeof window),console.log("window.JSPM:",window.JSPM),console.log("window.JSPM.JSPrintManager:",(s=window.JSPM)==null?void 0:s.JSPrintManager),console.log("window.JSPM.ClientPrintJob:",(o=window.JSPM)==null?void 0:o.ClientPrintJob),console.log("window.JSPM.InstalledPrinter:",(t=window.JSPM)==null?void 0:t.InstalledPrinter),typeof window<"u"&&window.JSPM&&window.JSPM.JSPrintManager?alert("JSPrintManager is available! âœ…"):alert(`JSPrintManager is NOT available! âŒ

Please check:
1. JSPrintManager is installed
2. JSPrintManager service is running
3. Scripts are loaded properly`)},O=s=>{console.log("Print service status:",s),s.isConnected?(f.value="connected",$.value=s.availablePrinters):f.value="error"};return Q(()=>{const s=localStorage.getItem("printStation_selectedPrinter");s&&(m.value=s),b.onStatusChange(O),k(),setTimeout(()=>{E()},2e3),setInterval(k,1e4)}),Y(()=>{b.offStatusChange(O)}),(s,o)=>(l(),ee(ae,null,{header:r(()=>[e("div",ie,[e("div",null,[e("h2",oe,i(n(c)("print_station.title")),1),e("p",re,i(n(c)("print_station.description")),1)]),e("div",le,[e("div",ce,[e("div",de,[a(_,{name:"Printer",class:"h-4 w-4 text-gray-500"}),e("div",{class:X({"h-2 w-2 rounded-full":!0,"bg-green-500":f.value==="connected","bg-red-500":f.value==="error"||f.value==="not-available","bg-yellow-500":f.value==="loading"}),title:f.value==="connected"?"JSPrintManager Connected":f.value==="error"?"JSPrintManager Error":f.value==="not-available"?"JSPrintManager Not Available":"Connecting to JSPrintManager..."},null,10,_e)]),te(e("select",{"onUpdate:modelValue":o[0]||(o[0]=t=>m.value=t),class:"text-sm border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1 bg-white dark:bg-gray-800",onChange:U,disabled:f.value!=="connected"},[e("option",me,i(n(c)("print_station.select_printer")),1),(l(!0),d(S,null,C($.value,t=>(l(),d("option",{key:t,value:t},i(t),9,pe))),128))],40,ue),[[se,m.value]]),a(n(v),{size:"sm",variant:"outline",onClick:E,disabled:T.value},{default:r(()=>[a(_,{name:"RefreshCw",class:"h-3 w-3"})]),_:1},8,["disabled"]),a(n(v),{size:"sm",variant:"outline",onClick:G},{default:r(()=>o[1]||(o[1]=[h(" Test ")])),_:1,__:[1]})]),a(n(v),{onClick:k,disabled:M.value},{default:r(()=>[a(_,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),h(" "+i(n(c)("print_station.refresh")),1)]),_:1},8,["disabled"])])])]),default:r(()=>[e("div",fe,[e("div",ge,[e("div",he,[a(n(y),null,{default:r(()=>[a(n(x),{class:"p-6"},{default:r(()=>[e("div",ve,[e("div",ye,[e("div",xe,[a(_,{name:"Clock",class:"h-5 w-5"})])]),e("div",we,[e("dt",be,i(n(c)("print_station.pending_jobs")),1),e("dd",ke,i(A.value.length),1)])])]),_:1})]),_:1}),a(n(y),null,{default:r(()=>[a(n(x),{class:"p-6"},{default:r(()=>[e("div",Pe,[e("div",Se,[e("div",Ce,[a(_,{name:"Printer",class:"h-5 w-5"})])]),e("div",Je,[e("dt",Me,i(n(c)("print_station.processing_jobs")),1),e("dd",Te,i(F.value.length),1)])])]),_:1})]),_:1}),a(n(y),null,{default:r(()=>[a(n(x),{class:"p-6"},{default:r(()=>[e("div",$e,[e("div",Ae,[e("div",Fe,[a(_,{name:"CheckCircle",class:"h-5 w-5"})])]),e("div",Ne,[e("dt",Ie,i(n(c)("print_station.completed_today")),1),e("dd",ze,i(w.value.completed_today||0),1)])])]),_:1})]),_:1}),a(n(y),null,{default:r(()=>[a(n(x),{class:"p-6"},{default:r(()=>[e("div",Ee,[e("div",Oe,[e("div",De,[a(_,{name:"XCircle",class:"h-5 w-5"})])]),e("div",Re,[e("dt",Xe,i(n(c)("print_station.failed_today")),1),e("dd",qe,i(w.value.failed_today||0),1)])])]),_:1})]),_:1})]),e("div",Le,[a(n(y),null,{default:r(()=>[a(n(N),null,{default:r(()=>[a(n(I),{class:"flex items-center gap-2"},{default:r(()=>[a(_,{name:"Clock",class:"h-5 w-5 text-yellow-600"}),h(" "+i(n(c)("print_station.pending_queue")),1)]),_:1})]),_:1}),a(n(x),null,{default:r(()=>[A.value.length===0?(l(),d("div",Ve,[a(_,{name:"Inbox",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e("p",je,i(n(c)("print_station.no_pending_jobs")),1)])):(l(),d("div",Be,[(l(!0),d(S,null,C(A.value,t=>(l(),d("div",{key:t.id,class:"border rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900/10 border-yellow-200 dark:border-yellow-800"},[e("div",Ke,[e("div",He,[e("div",Ue,[a(n(z),{variant:q(t.priority)},{default:r(()=>[h(i(t.priority),1)]),_:2},1032,["variant"]),e("span",Ge,i(t.job_id),1)]),e("div",We,[e("p",Ze,i(t.asset.asset_tag),1),e("p",Qe,i(t.asset.model_name)+" - "+i(t.company.name),1),e("p",Ye,i(n(c)("print_station.requested_by"))+" "+i(t.user.name),1),t.comment?(l(),d("p",et," ðŸ’¬ "+i(t.comment),1)):R("",!0)])]),e("div",tt,[a(n(v),{size:"sm",onClick:u=>V(t)},{default:r(()=>[a(_,{name:"Play",class:"h-4 w-4"})]),_:2},1032,["onClick"]),a(n(v),{size:"sm",variant:"outline",onClick:u=>H(t)},{default:r(()=>[a(_,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1}),a(n(y),null,{default:r(()=>[a(n(N),null,{default:r(()=>[a(n(I),{class:"flex items-center gap-2"},{default:r(()=>[a(_,{name:"Printer",class:"h-5 w-5 text-blue-600"}),h(" "+i(n(c)("print_station.processing_queue")),1)]),_:1})]),_:1}),a(n(x),null,{default:r(()=>[F.value.length===0?(l(),d("div",st,[a(_,{name:"Printer",class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e("p",at,i(n(c)("print_station.no_processing_jobs")),1)])):(l(),d("div",nt,[(l(!0),d(S,null,C(F.value,t=>(l(),d("div",{key:t.id,class:"border rounded-lg p-4 bg-blue-50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-800"},[e("div",it,[e("div",ot,[e("div",rt,[a(n(z),{variant:"secondary"},{default:r(()=>[h(i(t.priority),1)]),_:2},1024),e("span",lt,i(t.job_id),1)]),e("div",ct,[e("p",dt,i(t.asset.asset_tag),1),e("p",_t,i(t.asset.model_name)+" - "+i(t.company.name),1),e("div",ut,[o[2]||(o[2]=e("div",{class:"animate-spin h-3 w-3 border-2 border-blue-600 border-t-transparent rounded-full"},null,-1)),e("span",mt,i(n(c)("print_station.printing")),1)]),t.comment?(l(),d("p",pt," ðŸ’¬ "+i(t.comment),1)):R("",!0)])]),e("div",ft,[a(n(v),{size:"sm",variant:"outline",onClick:u=>B(t)},{default:r(()=>[a(_,{name:"Check",class:"h-4 w-4"})]),_:2},1032,["onClick"]),a(n(v),{size:"sm",variant:"destructive",onClick:u=>K(t)},{default:r(()=>[a(_,{name:"X",class:"h-4 w-4"})]),_:2},1032,["onClick"])])])]))),128))]))]),_:1})]),_:1})]),e("div",gt,[a(n(y),null,{default:r(()=>[a(n(N),null,{default:r(()=>[a(n(I),null,{default:r(()=>[h(i(n(c)("print_station.recent_activity")),1)]),_:1})]),_:1}),a(n(x),null,{default:r(()=>[J.value.length===0?(l(),d("div",ht,[e("p",vt,i(n(c)("print_station.no_recent_activity")),1)])):(l(),d("div",yt,[(l(!0),d(S,null,C(J.value,t=>(l(),d("div",{key:t.id,class:"flex items-center justify-between p-2 rounded border"},[e("div",xt,[a(_,{name:t.status==="completed"?"CheckCircle":"XCircle",class:X([t.status==="completed"?"text-green-600":"text-red-600","h-4 w-4"])},null,8,["name","class"]),e("span",wt,i(t.asset.asset_tag),1),a(n(z),{variant:t.status==="completed"?"default":"destructive",size:"sm"},{default:r(()=>[h(i(t.status),1)]),_:2},1032,["variant"])]),e("span",bt,i(L(t.completed_at||t.updated_at)),1)]))),128))]))]),_:1})]),_:1})])])])]),_:1}))}});export{Zt as default};
