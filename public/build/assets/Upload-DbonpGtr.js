import{d as K,u as W,c as X,p as h,L as G,a as g,o as u,b as s,e,g as J,w as o,f as t,l as f,t as l,n as j,i as T,F as A,r as H,h as p,y as Q,S as L,W as Y}from"./app-BVT6YeFM.js";import{_ as Z}from"./AppLayout.vue_vue_type_script_setup_true_lang-BsGYvWPE.js";import{_ as x}from"./index-BYqGtWoD.js";import{_ as b,a as k}from"./CardContent.vue_vue_type_script_setup_true_lang-85_oLy5R.js";import{_ as ee}from"./CardDescription.vue_vue_type_script_setup_true_lang-a0Tw6-Q6.js";import{_ as S,a as D}from"./CardTitle.vue_vue_type_script_setup_true_lang-CWE3sQRW.js";import{_ as m}from"./Icon.vue_vue_type_script_setup_true_lang-B-XK9d7g.js";import{_ as te}from"./Heading.vue_vue_type_script_setup_true_lang-Bw8RvFnj.js";import"./useForwardExpose-C2NcwnCE.js";import"./RovingFocusGroup-0sxDy683.js";import"./building-BOzxtJhy.js";import"./users-DMOAcLKC.js";import"./activity-CWtu_6Ik.js";import"./arrow-left-Box-L0sV.js";import"./calendar-BHYxAT_F.js";import"./check-Baoo_N5b.js";import"./chevron-down-CE4EerYJ.js";import"./search-D11WeuRW.js";import"./eye-CnFEgJIZ.js";import"./user-C7nY3yyz.js";import"./loader-circle-waWwqALa.js";import"./sun-CjFvj5hK.js";import"./play-BdpnDrir.js";import"./plus-wj5nKmwB.js";import"./square-pen-BNGVMHs8.js";import"./trash-2-DqVaXkJf.js";import"./triangle-alert-Dc44FXIG.js";const se={class:"space-y-6"},le={class:"text-sm text-gray-600 dark:text-gray-400 mt-1"},ae={class:"flex items-center justify-center space-x-4"},re={class:"flex items-center"},oe={class:"ml-2 text-sm font-medium"},ie={class:"flex items-center"},ne={class:"ml-2 text-sm font-medium"},de={class:"flex items-center"},ce={class:"ml-2 text-sm font-medium"},me={key:0},ue={key:0,class:"border border-red-200 bg-red-50 dark:bg-red-900/20 rounded-lg p-4"},pe={class:"flex items-start gap-2"},_e={class:"list-disc list-inside space-y-1"},ge={key:0,class:"space-y-4"},fe={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},ve={class:"text-sm text-gray-500 dark:text-gray-400"},ye={key:1,class:"space-y-4"},he={class:"text-lg font-medium text-gray-900 dark:text-gray-100"},xe={class:"text-sm text-gray-500 dark:text-gray-400"},be={class:"flex gap-2 justify-center"},ke={class:"flex items-center gap-2 text-red-700 dark:text-red-200"},we={class:"font-medium"},Ce={class:"text-sm text-red-600 dark:text-red-300 mt-1"},Se={key:1},De={class:"space-y-4"},Fe={class:"w-full bg-gray-200 rounded-full h-2"},Te={class:"text-sm text-gray-600 dark:text-gray-400 text-center"},Ie={key:2},$e={class:"space-y-4"},je={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Be={class:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg"},ze={class:"text-2xl font-bold text-blue-600"},Ae={class:"text-sm text-blue-800 dark:text-blue-200"},Le={class:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg"},Ne={class:"text-2xl font-bold text-green-600"},Me={class:"text-sm text-green-800 dark:text-green-200"},Oe={class:"bg-orange-50 dark:bg-orange-900/20 p-4 rounded-lg"},Ue={class:"text-2xl font-bold text-orange-600"},Ve={class:"text-sm text-orange-800 dark:text-orange-200"},Pe={class:"border border-green-200 bg-green-50 dark:bg-green-900/20 rounded-lg p-4"},qe={class:"flex items-start gap-2"},Ee={class:"text-green-800 dark:text-green-200"},Re={key:3},Ke={class:"space-y-4"},We={class:"text-sm text-gray-600 dark:text-gray-400 text-center"},Xe={key:4},Ge={class:"space-y-4"},Je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},He={class:"bg-green-100 dark:bg-green-800/20 p-4 rounded-lg"},Qe={class:"text-2xl font-bold text-green-600"},Ye={class:"text-sm text-green-800 dark:text-green-200"},Ze={class:"bg-blue-100 dark:bg-blue-800/20 p-4 rounded-lg"},et={class:"text-2xl font-bold text-blue-600"},tt={class:"text-sm text-blue-800 dark:text-blue-200"},st={class:"text-sm text-green-800 dark:text-green-200"},lt={class:"flex justify-between"},at={class:"flex gap-2"},zt=K({__name:"Upload",props:{company:{}},setup(rt){const{t:a}=W(),N=X(()=>[{title:a("nav.dashboard"),href:"/dashboard"},{title:a("employees.title"),href:"/employees"},{title:a("employees.import_csv"),href:"/employees/import"},{title:a("employees.upload_file"),href:"/employees/import/upload"}]),w=h(null),_=h(null),F=h(!1),I=h(!1),C=h(0),B=h(null),y=h([]),r=G({step:"upload",importId:null,importSummary:null}),M=n=>{const i=n.target;i.files&&i.files.length>0&&(_.value=i.files[0],$())},O=n=>{var i;n.preventDefault(),F.value=!1,(i=n.dataTransfer)!=null&&i.files&&n.dataTransfer.files.length>0&&(_.value=n.dataTransfer.files[0],$())},U=n=>{n.preventDefault(),F.value=!0},V=n=>{n.preventDefault(),F.value=!1},$=()=>{B.value=null,y.value=[],r.step="upload"},P=async()=>{var i;if(!_.value)return;r.step="validating",I.value=!0,C.value=0;const n=setInterval(()=>{C.value=Math.min(C.value+10,90)},100);try{const d=new FormData;d.append("file",_.value);const c=await fetch(route("employees.import.process"),{method:"POST",body:d,headers:{"X-CSRF-TOKEN":((i=document.querySelector('meta[name="csrf-token"]'))==null?void 0:i.getAttribute("content"))||""}});clearInterval(n),C.value=100;const v=await c.json();v.success?(B.value=v,r.importId=v.import_id,r.importSummary=v.summary,r.step="results"):(y.value=v.errors||[v.message],r.step="upload")}catch{clearInterval(n),y.value=["An error occurred while processing the file. Please try again."],r.step="upload"}finally{I.value=!1}},q=async()=>{var n;if(r.importId){r.step="importing";try{const d=await(await fetch(route("employees.import.execute"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||""},body:JSON.stringify({import_id:r.importId})})).json();d.success?(r.step="complete",r.importSummary=d.summary,setTimeout(()=>{Y.visit(route("employees.index"),{preserveState:!1})},3e3)):(y.value=[d.message],r.step="results")}catch{y.value=["An error occurred during import. Please try again."],r.step="results"}}},E=()=>{_.value=null,w.value&&(w.value.value=""),$()},z=n=>["text/csv","application/vnd.ms-excel","text/plain"].includes(n.type)||n.name.toLowerCase().endsWith(".csv"),R=n=>{if(n===0)return"0 Bytes";const i=1024,d=["Bytes","KB","MB","GB"],c=Math.floor(Math.log(n)/Math.log(i));return parseFloat((n/Math.pow(i,c)).toFixed(2))+" "+d[c]};return(n,i)=>(u(),g(A,null,[s(e(J),{title:e(a)("employees.upload_file")},null,8,["title"]),s(Z,{breadcrumbs:N.value},{default:o(()=>[t("div",se,[t("div",null,[s(te,{title:e(a)("employees.upload_file")},null,8,["title"]),t("p",le,l(e(a)("employees.upload_file_subtitle")),1)]),t("div",ae,[t("div",re,[i[2]||(i[2]=t("div",{class:"flex items-center justify-center w-8 h-8 rounded-full bg-blue-600 text-white text-sm"}," 1 ",-1)),t("span",oe,l(e(a)("employees.upload_file")),1)]),i[3]||(i[3]=t("div",{class:"w-8 h-px bg-gray-300"},null,-1)),t("div",ie,[t("div",{class:j(["flex items-center justify-center w-8 h-8 rounded-full text-sm",r.step==="validating"||r.step==="results"||r.step==="importing"||r.step==="complete"?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"])}," 2 ",2),t("span",ne,l(e(a)("employees.validate_data")),1)]),i[4]||(i[4]=t("div",{class:"w-8 h-px bg-gray-300"},null,-1)),t("div",de,[t("div",{class:j(["flex items-center justify-center w-8 h-8 rounded-full text-sm",r.step==="importing"||r.step==="complete"?"bg-blue-600 text-white":"bg-gray-300 text-gray-600"])}," 3 ",2),t("span",ce,l(e(a)("employees.import_data")),1)])]),r.step==="upload"?(u(),g("div",me,[y.value.length>0?(u(),g("div",ue,[t("div",pe,[s(m,{name:"AlertCircle",class:"h-4 w-4 text-red-600 mt-0.5"}),t("div",null,[t("ul",_e,[(u(!0),g(A,null,H(y.value,d=>(u(),g("li",{key:d,class:"text-red-700 dark:text-red-200"},l(d),1))),128))])])])])):f("",!0),s(e(b),null,{default:o(()=>[s(e(S),null,{default:o(()=>[s(e(D),null,{default:o(()=>[p(l(e(a)("employees.select_csv_file")),1)]),_:1}),s(e(ee),null,{default:o(()=>[p(l(e(a)("employees.csv_file_requirements")),1)]),_:1})]),_:1}),s(e(k),null,{default:o(()=>[t("div",{class:j(["border-2 border-dashed rounded-lg p-8 text-center transition-colors",F.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 hover:border-gray-400"]),onDrop:O,onDragover:U,onDragleave:V},[t("input",{ref_key:"fileInput",ref:w,type:"file",accept:".csv,text/csv",onChange:M,class:"hidden"},null,544),_.value?(u(),g("div",ye,[s(m,{name:"FileSpreadsheet",class:"mx-auto h-12 w-12 text-green-600"}),t("div",null,[t("p",he,l(_.value.name),1),t("p",xe,l(R(_.value.size)),1)]),t("div",be,[s(e(x),{onClick:E,variant:"outline",size:"sm"},{default:o(()=>[s(m,{name:"X",class:"mr-2 h-4 w-4"}),p(" "+l(e(a)("common.remove")),1)]),_:1}),s(e(x),{onClick:i[1]||(i[1]=d=>{var c;return(c=w.value)==null?void 0:c.click()}),variant:"outline",size:"sm"},{default:o(()=>[s(m,{name:"RefreshCw",class:"mr-2 h-4 w-4"}),p(" "+l(e(a)("common.change")),1)]),_:1})])])):(u(),g("div",ge,[s(m,{name:"Upload",class:"mx-auto h-12 w-12 text-gray-400"}),t("div",null,[t("p",fe,l(e(a)("employees.drop_csv_file")),1),t("p",ve,l(e(a)("employees.or_click_to_browse")),1)]),s(e(x),{onClick:i[0]||(i[0]=d=>{var c;return(c=w.value)==null?void 0:c.click()}),variant:"outline"},{default:o(()=>[s(m,{name:"FileSpreadsheet",class:"mr-2 h-4 w-4"}),p(" "+l(e(a)("employees.browse_files")),1)]),_:1})]))],34)]),_:1})]),_:1}),_.value&&!z(_.value)?(u(),T(e(b),{key:1,class:"border-red-200 bg-red-50 dark:bg-red-900/20"},{default:o(()=>[s(e(k),{class:"pt-6"},{default:o(()=>[t("div",ke,[s(m,{name:"AlertCircle",class:"h-5 w-5"}),t("p",we,l(e(a)("employees.invalid_file_type")),1)]),t("p",Ce,l(e(a)("employees.csv_file_required")),1)]),_:1})]),_:1})):f("",!0)])):f("",!0),r.step==="validating"?(u(),g("div",Se,[s(e(b),null,{default:o(()=>[s(e(S),null,{default:o(()=>[s(e(D),{class:"flex items-center gap-2"},{default:o(()=>[s(m,{name:"Loader2",class:"h-5 w-5 animate-spin text-blue-600"}),p(" "+l(e(a)("employees.validating_file")),1)]),_:1})]),_:1}),s(e(k),null,{default:o(()=>[t("div",De,[t("div",Fe,[t("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Q({width:`${C.value}%`})},null,4)]),t("p",Te,l(e(a)("employees.processing_csv_file")),1)])]),_:1})]),_:1})])):f("",!0),r.step==="results"?(u(),g("div",Ie,[s(e(b),null,{default:o(()=>[s(e(S),null,{default:o(()=>[s(e(D),{class:"flex items-center gap-2"},{default:o(()=>[s(m,{name:"CheckCircle",class:"h-5 w-5 text-green-600"}),p(" "+l(e(a)("employees.validation_complete")),1)]),_:1})]),_:1}),s(e(k),null,{default:o(()=>{var d,c,v;return[t("div",$e,[t("div",je,[t("div",Be,[t("div",ze,l(((d=r.importSummary)==null?void 0:d.total_records)||0),1),t("div",Ae,l(e(a)("employees.total_records")),1)]),t("div",Le,[t("div",Ne,l(((c=r.importSummary)==null?void 0:c.new_records)||0),1),t("div",Me,l(e(a)("employees.new_records")),1)]),t("div",Oe,[t("div",Ue,l(((v=r.importSummary)==null?void 0:v.update_records)||0),1),t("div",Ve,l(e(a)("employees.update_records")),1)])]),t("div",Pe,[t("div",qe,[s(m,{name:"CheckCircle",class:"h-4 w-4 text-green-600 mt-0.5"}),t("p",Ee,l(e(a)("employees.validation_success_message")),1)])])])]}),_:1})]),_:1})])):f("",!0),r.step==="importing"?(u(),g("div",Re,[s(e(b),null,{default:o(()=>[s(e(S),null,{default:o(()=>[s(e(D),{class:"flex items-center gap-2"},{default:o(()=>[s(m,{name:"Loader2",class:"h-5 w-5 animate-spin text-blue-600"}),p(" "+l(e(a)("employees.importing_data")),1)]),_:1})]),_:1}),s(e(k),null,{default:o(()=>[t("div",Ke,[i[5]||(i[5]=t("div",{class:"w-full bg-gray-200 rounded-full h-2"},[t("div",{class:"bg-blue-600 h-2 rounded-full animate-pulse"})],-1)),t("p",We,l(e(a)("employees.importing_employees")),1)])]),_:1})]),_:1})])):f("",!0),r.step==="complete"?(u(),g("div",Xe,[s(e(b),{class:"border-green-200 bg-green-50 dark:bg-green-900/20"},{default:o(()=>[s(e(S),null,{default:o(()=>[s(e(D),{class:"flex items-center gap-2 text-green-800 dark:text-green-200"},{default:o(()=>[s(m,{name:"CheckCircle",class:"h-5 w-5"}),p(" "+l(e(a)("employees.import_complete")),1)]),_:1})]),_:1}),s(e(k),null,{default:o(()=>{var d,c;return[t("div",Ge,[t("div",Je,[t("div",He,[t("div",Qe,l(((d=r.importSummary)==null?void 0:d.created)||0),1),t("div",Ye,l(e(a)("employees.created_employees")),1)]),t("div",Ze,[t("div",et,l(((c=r.importSummary)==null?void 0:c.updated)||0),1),t("div",tt,l(e(a)("employees.updated_employees")),1)])]),t("p",st,l(e(a)("employees.import_complete_message")),1)])]}),_:1})]),_:1})])):f("",!0),t("div",lt,[s(e(x),{variant:"ghost",asChild:""},{default:o(()=>[s(e(L),{href:n.route("employees.import")},{default:o(()=>[s(m,{name:"ArrowLeft",class:"mr-2 rtl:mr-0 rtl:ml-2 h-4 w-4"}),p(" "+l(e(a)("common.back")),1)]),_:1},8,["href"])]),_:1}),t("div",at,[r.step==="upload"?(u(),T(e(x),{key:0,onClick:P,disabled:!_.value||!z(_.value)||I.value},{default:o(()=>[s(m,{name:"Upload",class:"mr-2 rtl:mr-0 rtl:ml-2 h-4 w-4"}),p(" "+l(e(a)("employees.validate_file")),1)]),_:1},8,["disabled"])):f("",!0),r.step==="results"?(u(),T(e(x),{key:1,onClick:q,class:"bg-green-600 hover:bg-green-700"},{default:o(()=>[s(m,{name:"Database",class:"mr-2 rtl:mr-0 rtl:ml-2 h-4 w-4"}),p(" "+l(e(a)("employees.start_import")),1)]),_:1})):f("",!0),r.step==="complete"?(u(),T(e(x),{key:2,asChild:"",class:"bg-blue-600 hover:bg-blue-700"},{default:o(()=>[s(e(L),{href:n.route("employees.index")},{default:o(()=>[s(m,{name:"Users",class:"mr-2 rtl:mr-0 rtl:ml-2 h-4 w-4"}),p(" "+l(e(a)("employees.view_employees")),1)]),_:1},8,["href"])]),_:1})):f("",!0)])])])]),_:1},8,["breadcrumbs"])],64))}});export{zt as default};
